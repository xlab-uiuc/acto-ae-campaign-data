1.679666921545147e+09	INFO	controller-runtime.metrics	Metrics server is starting to listen	{"addr": ":8080"}
1.6796669216431196e+09	INFO	setup	starting manager
1.679666921643685e+09	INFO	Starting server	{"path": "/metrics", "kind": "metrics", "addr": "[::]:8080"}
I0324 14:08:41.643741       1 leaderelection.go:248] attempting to acquire leader lease redis-operator/6cab913b.redis.opstreelabs.in...
1.6796669216436846e+09	INFO	Starting server	{"kind": "health probe", "addr": "[::]:8081"}
I0324 14:09:02.336123       1 leaderelection.go:258] successfully acquired lease redis-operator/6cab913b.redis.opstreelabs.in
1.6796669423362072e+09	DEBUG	events	Normal	{"object": {"kind":"ConfigMap","namespace":"redis-operator","name":"6cab913b.redis.opstreelabs.in","uid":"6b29ccb6-2c52-4c71-8bae-8578f1e8e682","apiVersion":"v1","resourceVersion":"948"}, "reason": "LeaderElection", "message": "redis-operator-54fb85ff56-hcr4x_6f87860b-cf6b-4000-ac41-7c23217de7ad became leader"}
1.679666942336496e+09	DEBUG	events	Normal	{"object": {"kind":"Lease","namespace":"redis-operator","name":"6cab913b.redis.opstreelabs.in","uid":"f69a0a0b-1e7e-4f36-964e-babc27884c95","apiVersion":"coordination.k8s.io/v1","resourceVersion":"949"}, "reason": "LeaderElection", "message": "redis-operator-54fb85ff56-hcr4x_6f87860b-cf6b-4000-ac41-7c23217de7ad became leader"}
1.6796669423366306e+09	INFO	controller.redis	Starting EventSource	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "Redis", "source": "kind source: *v1beta1.Redis"}
1.6796669423366914e+09	INFO	controller.redis	Starting Controller	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "Redis"}
1.6796669423366535e+09	INFO	controller.rediscluster	Starting EventSource	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "RedisCluster", "source": "kind source: *v1beta1.RedisCluster"}
1.6796669423367295e+09	INFO	controller.rediscluster	Starting Controller	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "RedisCluster"}
E0324 14:09:02.344750       1 event.go:267] Server rejected event '&v1.Event{TypeMeta:v1.TypeMeta{Kind:"", APIVersion:""}, ObjectMeta:v1.ObjectMeta{Name:"6cab913b.redis.opstreelabs.in.174f602f4ee88882", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string(nil), Annotations:map[string]string(nil), OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, InvolvedObject:v1.ObjectReference{Kind:"ConfigMap", Namespace:"redis-operator", Name:"6cab913b.redis.opstreelabs.in", UID:"6b29ccb6-2c52-4c71-8bae-8578f1e8e682", APIVersion:"v1", ResourceVersion:"948", FieldPath:""}, Reason:"LeaderElection", Message:"redis-operator-54fb85ff56-hcr4x_6f87860b-cf6b-4000-ac41-7c23217de7ad became leader", Source:v1.EventSource{Component:"redis-operator-54fb85ff56-hcr4x_6f87860b-cf6b-4000-ac41-7c23217de7ad", Host:""}, FirstTimestamp:time.Date(2023, time.March, 24, 14, 9, 2, 336075906, time.Local), LastTimestamp:time.Date(2023, time.March, 24, 14, 9, 2, 336075906, time.Local), Count:1, Type:"Normal", EventTime:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Series:(*v1.EventSeries)(nil), Action:"", Related:(*v1.ObjectReference)(nil), ReportingController:"", ReportingInstance:""}': 'events is forbidden: User "system:serviceaccount:redis-operator:redis-operator" cannot create resource "events" in API group "" in the namespace "redis-operator"' (will not retry!)
E0324 14:09:02.345923       1 event.go:267] Server rejected event '&v1.Event{TypeMeta:v1.TypeMeta{Kind:"", APIVersion:""}, ObjectMeta:v1.ObjectMeta{Name:"6cab913b.redis.opstreelabs.in.174f602f4ee8fc78", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string(nil), Annotations:map[string]string(nil), OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, InvolvedObject:v1.ObjectReference{Kind:"Lease", Namespace:"redis-operator", Name:"6cab913b.redis.opstreelabs.in", UID:"f69a0a0b-1e7e-4f36-964e-babc27884c95", APIVersion:"coordination.k8s.io/v1", ResourceVersion:"949", FieldPath:""}, Reason:"LeaderElection", Message:"redis-operator-54fb85ff56-hcr4x_6f87860b-cf6b-4000-ac41-7c23217de7ad became leader", Source:v1.EventSource{Component:"redis-operator-54fb85ff56-hcr4x_6f87860b-cf6b-4000-ac41-7c23217de7ad", Host:""}, FirstTimestamp:time.Date(2023, time.March, 24, 14, 9, 2, 336105592, time.Local), LastTimestamp:time.Date(2023, time.March, 24, 14, 9, 2, 336105592, time.Local), Count:1, Type:"Normal", EventTime:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Series:(*v1.EventSeries)(nil), Action:"", Related:(*v1.ObjectReference)(nil), ReportingController:"", ReportingInstance:""}': 'events is forbidden: User "system:serviceaccount:redis-operator:redis-operator" cannot create resource "events" in API group "" in the namespace "redis-operator"' (will not retry!)
1.6796669424428968e+09	INFO	controller.rediscluster	Starting workers	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "RedisCluster", "worker count": 1}
1.6796669424428947e+09	INFO	controller.redis	Starting workers	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "Redis", "worker count": 1}
1.6796669424431567e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
MATT IS HERE: patchStatefulSet
1.6796669426456568e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.679666942751542e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVlFv4zYM/i98duK6bdrGb13jDcWubWBnNwyHImBk5iycLPkkyrsg8H8f5DhpWnS9DtjDbk+xKJIiv+8TlS1gIz+SddJoSAGbxsVtAhF8kbqEFApGprVXBTFEUBNjiYyQbgG1NowsjXZhaamUbmwax5ZI4cqNZUjI1hNEr+46Ri0o+JDjkVDeMVnoIlC4ItUnxaZ5sT9ShCXZfcqlI/bNkjdNSLTPEYE1KhgG5y4CjfXLo55ShU3XYF9Mn3ZkGrLIJmyaPzXZnNZkSQtykH56gdmut9c6jNtkRYwBTmE0W6MUWUgDJgeA8xB3cyj8lTohAi+D69XkrLyk03I0vVwno/MprUcrvDofTac4ubgU56fJlKB77CJwDYkdKY2SAh2kZxE4UiRCT+kWamRRffjXcQ5Hk22loPu38GaqG4VMfSU/qKSOUA7cotRkd+Ig3fa/A5XzLC9ui0V2f5Mts/vrnz5kM4igReVp30wXHbzzbHZbLK9ns/zIqa8rjWNlBKrKOE4vzi6nx2FFln/M8uXdwyw7insC4Mhx8dv8b/0eI5A1fg62rx43Y2niAeB4V0N7MT4dT2Bwm3ul5kZJsYEUbtf3hueWHOkwKpRsSZNzc2tWPdH0bY9WXWOQ/idYoasggtg7G6+kjitCxZWoSHwZuwqCktcolbe0qCy5yqgS0kkEUkuWqGakcFOQMLp0kCaTCBqy0pTPTCxrMp4Ptsn3hoElLOV/tXJLznjbj6EtKFlL7r9E4yGF5CSp+yFdGxsYSU6v7iT0UV89uXe4dhG0Rvma7ozXvJNzHT7nyBWkEPc39U0Aw/z5X9+BEX1rjGWyaTI+ec9NGE59Hgzf5fLk/Vy+6todOgnFFSQsDYwOBV3fLB5+zf44RuYfmh6DYHxTIlPBFpk+byDdHkR0o1DWi2HWD2L6Qaf925J/egpQCHLuzpR9v5ATlr9byfQQCn18wfkxlY6N3Yku+eX5RSyD8WepyG0cU92fxsg+hHW7136/BGxRKlwpyg8P/0l09C/gpOv+CgAA//9QSwcI+y7ffgkDAADxCQAAUEsBAhQAFAAIAAgAAAAAAPsu334JAwAA8QkAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAAD8DAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T14:08:38Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"853d7e2d-97f1-49ef-ba84-99a567c4219e"}],"resourceVersion":"788","uid":"d26d56b7-45a3-463b-8251-eb4cbdfe929e"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","imagePullSecrets":[{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"}],"restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T14:08:38Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"853d7e2d-97f1-49ef-ba84-99a567c4219e"}],"resourceVersion":"788"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"imagePullSecrets":[{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"853d7e2d-97f1-49ef-ba84-99a567c4219e"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"imagePullSecrets":[{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6796669427578678e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6796669430473325e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.679666943054141e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6796669431438756e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6796669431496003e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6796669431496382e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6796669431541946e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
1.6796669432474742e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVt9v20YM/l/4LFtWGiex3rJYG4I1iSF5HYYiMOgTXR16ulPveGoNQ//7cPKPKkG2ZA8D1j1Z4pG8j99H0toBNvIDWSeNhhSwaVzcJhDBZ6lLSKFgZNp4VRBDBDUxlsgI6Q5Qa8PI0mgXXi2V0o1N49gSKVy7sQwJ2XqC6MVTx6gFBR9yPBLKOyYLXQQK16T6pNg0z85HG6OU+Ur2mHTliH2z4m0TUh2zRGCNCoaTexeBxvr5dcN04dg12EPqU49MQxbZhEPzVZPNaUOWtCAH6cdnzO0rfKnOuE3WxBhIFUazNUqRhTQwc6I5D3E3J/AvIIUIvAyuV9N35SWdlaPZ5SYZnc9oM1rj1floNsPpxaU4P0tmBN1jF4FrSOylaZQU6CB9F4EjRSLUlO6gRhbV+3+F7XA92VYKuv971pnqRiFTj+cHbq8B30FllJrsvk1It/3vQdRFlhe3xTK7v8lW2f31T++zOUTQovJ0LKiLTt55Nr8tVtfzeT5w6pGlcayMQFUZx+nFu8vZMKzI8g9Zvrp7mGeDuO8kDByXvy3+0u8xAlnjp2D74nE7liY+kBzvMbQX47PxFA5uC6/UwigptpDC7ebe8MKSIx1Wh5ItaXJuYc26F5u+HdmqawxD8BHW6CqIIPbOxmup44pQcSUqEp/HroLQ0xuUyltaVpZcZVQJ6TQCqSVLVHNSuC1IGF06SJNpBA1ZaconJpY1Gc8n2/T1xWAJS/lfxW7JGW/7lbQDJWvJ/ZNoPKSQTJK6X9u1sUGT5OzqTkIf9cWTe4NrF0FrlK/pznjN+4auw+MCuYIU4n5eX6EwbKP/9RyM6FtjLJNNk/HkLdNwuPVpMLyq5uTtar7o2p0qCeAKEpYOmh4AXd8sH37N/hgy8w9Nj6FlfFMiU8EWmT5tId2d2uhGoayXh51/aKcfeOu/1vjf/xRQCHLuzpR91ZATlr9byfQQ4D4+U34oqGNj962X/PJ0IMtg/FkqclvHVPe3MbIPYd3+C+D4CtiiVLhWlJ8+BibR4Mtg0nV/BgAA//9QSwcIAWwTGAwDAAALCgAAUEsBAhQAFAAIAAgAAAAAAAFsExgMAwAACwoAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAAEIDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T14:08:38Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"853d7e2d-97f1-49ef-ba84-99a567c4219e"}],"resourceVersion":"819","uid":"c9a10491-54bf-4e17-87eb-b1272fe18118"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","imagePullSecrets":[{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"}],"restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T14:08:38Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"853d7e2d-97f1-49ef-ba84-99a567c4219e"}],"resourceVersion":"819"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"imagePullSecrets":[{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"853d7e2d-97f1-49ef-ba84-99a567c4219e"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"imagePullSecrets":[{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"},{"name":"ACTOKEY"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6796669432526083e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6796669432556486e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6796669433476472e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6796669433505826e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6796669433545225e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6796669433552077e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6796669435436544e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6796669436436155e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6796669436436808e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "0", "Expected.Replicas": 3}

