1.6796638311451383e+09	INFO	controller-runtime.metrics	Metrics server is starting to listen	{"addr": ":8080"}
1.6796638311456583e+09	INFO	setup	starting manager
1.679663831243164e+09	INFO	Starting server	{"kind": "health probe", "addr": "[::]:8081"}
I0324 13:17:11.243236       1 leaderelection.go:248] attempting to acquire leader lease redis-operator/6cab913b.redis.opstreelabs.in...
1.6796638312431338e+09	INFO	Starting server	{"path": "/metrics", "kind": "metrics", "addr": "[::]:8080"}
I0324 13:17:37.572923       1 leaderelection.go:258] successfully acquired lease redis-operator/6cab913b.redis.opstreelabs.in
1.679663857573258e+09	INFO	controller.redis	Starting EventSource	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "Redis", "source": "kind source: *v1beta1.Redis"}
1.6796638575733073e+09	INFO	controller.rediscluster	Starting EventSource	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "RedisCluster", "source": "kind source: *v1beta1.RedisCluster"}
1.6796638575733716e+09	INFO	controller.redis	Starting Controller	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "Redis"}
1.6796638575733793e+09	INFO	controller.rediscluster	Starting Controller	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "RedisCluster"}
1.6796638575731852e+09	DEBUG	events	Normal	{"object": {"kind":"ConfigMap","namespace":"redis-operator","name":"6cab913b.redis.opstreelabs.in","uid":"ca9c563e-ceb5-4a30-a0de-312e49d3d599","apiVersion":"v1","resourceVersion":"930"}, "reason": "LeaderElection", "message": "redis-operator-54fb85ff56-869nv_9432c8b7-0285-4811-8729-2b4f464a0ef1 became leader"}
1.6796638575735974e+09	DEBUG	events	Normal	{"object": {"kind":"Lease","namespace":"redis-operator","name":"6cab913b.redis.opstreelabs.in","uid":"94d7e8c6-1f2b-45a3-8b31-2e22f3eaeeca","apiVersion":"coordination.k8s.io/v1","resourceVersion":"931"}, "reason": "LeaderElection", "message": "redis-operator-54fb85ff56-869nv_9432c8b7-0285-4811-8729-2b4f464a0ef1 became leader"}
E0324 13:17:37.575194       1 event.go:267] Server rejected event '&v1.Event{TypeMeta:v1.TypeMeta{Kind:"", APIVersion:""}, ObjectMeta:v1.ObjectMeta{Name:"6cab913b.redis.opstreelabs.in.174f5d6114b1d701", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string(nil), Annotations:map[string]string(nil), OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, InvolvedObject:v1.ObjectReference{Kind:"ConfigMap", Namespace:"redis-operator", Name:"6cab913b.redis.opstreelabs.in", UID:"ca9c563e-ceb5-4a30-a0de-312e49d3d599", APIVersion:"v1", ResourceVersion:"930", FieldPath:""}, Reason:"LeaderElection", Message:"redis-operator-54fb85ff56-869nv_9432c8b7-0285-4811-8729-2b4f464a0ef1 became leader", Source:v1.EventSource{Component:"redis-operator-54fb85ff56-869nv_9432c8b7-0285-4811-8729-2b4f464a0ef1", Host:""}, FirstTimestamp:time.Date(2023, time.March, 24, 13, 17, 37, 572894465, time.Local), LastTimestamp:time.Date(2023, time.March, 24, 13, 17, 37, 572894465, time.Local), Count:1, Type:"Normal", EventTime:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Series:(*v1.EventSeries)(nil), Action:"", Related:(*v1.ObjectReference)(nil), ReportingController:"", ReportingInstance:""}': 'events is forbidden: User "system:serviceaccount:redis-operator:redis-operator" cannot create resource "events" in API group "" in the namespace "redis-operator"' (will not retry!)
E0324 13:17:37.643004       1 event.go:267] Server rejected event '&v1.Event{TypeMeta:v1.TypeMeta{Kind:"", APIVersion:""}, ObjectMeta:v1.ObjectMeta{Name:"6cab913b.redis.opstreelabs.in.174f5d6114b2159c", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string(nil), Annotations:map[string]string(nil), OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, InvolvedObject:v1.ObjectReference{Kind:"Lease", Namespace:"redis-operator", Name:"6cab913b.redis.opstreelabs.in", UID:"94d7e8c6-1f2b-45a3-8b31-2e22f3eaeeca", APIVersion:"coordination.k8s.io/v1", ResourceVersion:"931", FieldPath:""}, Reason:"LeaderElection", Message:"redis-operator-54fb85ff56-869nv_9432c8b7-0285-4811-8729-2b4f464a0ef1 became leader", Source:v1.EventSource{Component:"redis-operator-54fb85ff56-869nv_9432c8b7-0285-4811-8729-2b4f464a0ef1", Host:""}, FirstTimestamp:time.Date(2023, time.March, 24, 13, 17, 37, 572910492, time.Local), LastTimestamp:time.Date(2023, time.March, 24, 13, 17, 37, 572910492, time.Local), Count:1, Type:"Normal", EventTime:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Series:(*v1.EventSeries)(nil), Action:"", Related:(*v1.ObjectReference)(nil), ReportingController:"", ReportingInstance:""}': 'events is forbidden: User "system:serviceaccount:redis-operator:redis-operator" cannot create resource "events" in API group "" in the namespace "redis-operator"' (will not retry!)
1.6796638576743164e+09	INFO	controller.redis	Starting workers	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "Redis", "worker count": 1}
1.6796638577427464e+09	INFO	controller.rediscluster	Starting workers	{"reconciler group": "redis.redis.opstreelabs.in", "reconciler kind": "RedisCluster", "worker count": 1}
1.6796638577428992e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6796638578450732e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFFv4jgQ/i/zHEgCpEDe9kp6qnbbotDb02lVVUMyNFadOGs7uUUV//3kJEBgWZa7bffa0z0B9sx45vvGn22eAHP2kaRiIgMfMM+VXbpgwSPLYvBhplHTouAz0mBBShpj1Aj+E2CWCY2aiUyZn5JiproiV1oScZyrLjMBtSwIrIOzSmMWkbEhpTsRL5QmCSsLOM6JV0Exz/fmO5wwJrkOea9IF/m9XuYm0DqGBVJwM9AYryzIMN1fahvKTKocq2SqsB2Rk0QtzKT4MyMZ0oIkZREp8D/tYVbXdqhCu3TnpNHAGYlMS8E5SfANJhuAQ+N3vkn8QJ5gQcGMqTsYj8ZzdDs0cOLOwPXmnXGvT52B5y0wjuJRL3ZhdbeyQOUU1aTknEWowO9boIhTZGrynyBFHSUfnh1nszTJkkV0fQxvTWnOUVOVyRttqRbKhltkGcm6OSgrq8+GymkQzi5nt8H1eXAfXL/75UMwAQtK5AWti1lZG+swmFzO7t9NJmHLqMrLt20uIuSJUNo/6w/HbbdZEH4Mwvurm0nQ8tsC0DK8/W36Tbs7C1iKD2bsc4HLLhN2A7Bd51CedXtdDxqzacH5VHAWLcGHy8W10FNJijIjFZyVlJFSUynmFdH0ZY1WmqJp/U8wR5WABXahpD1nmZ0Qcp1ECUWPXZWA6eQFMl5Iuk0kqUTwGHzPApYxzZBPiONyRpHIYgW+61mQk2Qi3hnSLCVR6M2Y9z0xkIQxe62ZS1KikJUMPQFnKdPVtygvjD44blqJdCqkYcTtja4YVF6fC1InmK4sKAUvUroSRabrdk7N1ynqBHywq516FECjP//pPdChL7mQmqTvdp1TdkKz6q4zfJdL53QuD5quDvDw7vz25n3wx7rsCynSRsAW7OEK8/e0DGlhhh5puWO/F8D0NyMeN9Y75+HWqTJpWqfluS78ohVho6HX+5nGrGTKnFowHJ55Q68/8s4cp2gBuBtdUSRJn1yJBSI3Jw7y+mCucTuM17cR/Plg9EbeuOe+Mhj+fiN9te6/0ViDF0SxJSdbq68140jIozoxMpv/oCzUMyeowE+k85l564/cvjccjd3eCxL49rbBj9d8sGmPNuYP9dk/5X84cHrj4ch1sv/5f4bt5L4Eigvk6lXo4J253RZ5jJpmWqKmh6Xp2/WN95wjS2+bh2lz832jT9Pj9/PtuxWjiJS6EnFVL4SE8e+Saboxid7tAd4GVmkhayrdX3dfDbEZvGCc1FJpqhhRGnVRS8Rd+ydgiYzjnFO4+ZfCsVp/WTir1V8BAAD//1BLBwj1r993ywMAAJ4SAABQSwECFAAUAAgACAAAAAAA9a/fd8sDAACeEgAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAAQQAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"817","uid":"31c4e77f-2232-4457-807b-e5e86c3946b2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6796638580582569e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"817"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.679663858063109e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.679663858346532e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.679663858352576e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.679663858355932e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6796638584465816e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.679663858446636e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
MATT IS HERE: patchStatefulSet
1.6796638584511812e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.67966385854768e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFFz2jgQ/i/7bLANOIDfcsG5ybRJGMP15qbDMIu9xJrIlivJbpkM//1GNhBDacJdm15y0ydAWq12v2/3k8QDYM4+kFRMZOAD5rmySxcsuGdZDD5MNGpaFnxCGixISWOMGsF/AMwyoVEzkSnzU1LMVFvkSksijgvVZsahlgWBdXRWacwiMjakdCvihdIkYW0BxwXxyinm+cF8ayk4F59Jbp3OFekin+tVblxtvVggBTcDO/O1BRmmh9s13ZlplWMVUuW6JXKSqIWZFJ8zkiEtSVIWkQL/4wFydYbH8rRLd0EaDaiRyLQUnJME3yCzgzk06y52wR+JFCwomDF1e8PBcIFui3pO3Oq53qI17HSp1fO8JcZRPOjELqxnawtUTlFNTc5ZhAr8rgWKOEUmJ/8BUtRR8v5F0DbbkyxZRDdPo64pzTlqquJ5w+XVwNuwjCwjWZcJZWX1uSF1HISTq8k0uLkI5sHN+W/vgxFYUCIvaJvQ2tpZh8HoajI/H43ChlEVmW/bXETIE6G0f9btD5vLJkH4IQjn17ejoLHuEYSG4fSP8TftZhawFO/M2KcCV20m7A3Idh1DedbutD3YmI0LzseCs2gFPlwtb4QeS1KUGengrKSMlBpLsajIpi9btNIUTRN8hAWqBCywCyXtBcvshJDrJEooum+rBExNL5HxQtI0kaQSwWPwPQtYxjRDPiKOqwlFIosV+K5nQU6SiXhvSLOURKF3Y97zwiAJY/ZaY5ekRCErSXoAzlKmq29RXhitcNy0ku1USMOJ2xlcM6hWfSpInWC6tqAUvEjpWhSZrgs6NV/HqBPwwa769RkIjRr9r/ugRV9yITVJ3207p3TDZtf9xfAsm87pbB41XR/h4fxievsu+Gub9qUU6UbEluzuGvN3tAppaYbuabVnf+DAVDgjHm+s907Hx0WVyaZ4Giu3iV82POx09OYw0piVTJkzDPr9M6/vdQfemeMUDQD3vSuKJOmTM7FA5ObkQV4f0zVux/H6NoI/H4zOwBt23FcGwz8vpK/2/S8Kq/eCKDbk5NHqa814wuWTOjEwzX9UFuqZE1TgJ9L5g3nrDtyu1x8M3c4LEvj22uD7cz5atE8W5nfV2b/lv99zOsP+wHWyX/z/gHZyXwLFJXL1KnRwZu63RR6jpomWqOluZep2e+e94MjS6eaBurn7vuEn6nO39McXLEYRKXUt4iprCAnjPyXTdGvCnR3A3oRXaSFrQt3f918PsRm8ZJzUSmmqeFEadVELxaz5E7BExnHBKdz9c+FYjb8xnPX67wAAAP//UEsHCBqY34bNAwAAuBIAAFBLAQIUABQACAAIAAAAAAAamN+GzQMAALgSAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAADBAAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"836","uid":"26967f7d-dc15-4fe4-91f2-b629dec8562a"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"836"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.679663858552704e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6796638585556798e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6796638586466434e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6796638586505744e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6796638586539466e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6796638586539896e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.679663858659277e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6796638588445485e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6796638588446052e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "0", "Expected.Replicas": 3}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
1.6796639788457952e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: CreateOrUpdateStateFul
MATT IS HERE: patchStatefulSet
1.6796639788548975e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6796639790461822e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFFv4jgQ/i/zHEgCpEDe9kp6qnbbotDb02lVVUMyNFadOGs7uUUV//3kJEBgWZa7bffa0z0B9sx45vvGn22eAHP2kaRiIgMfMM+VXbpgwSPLYvBhplHTouAz0mBBShpj1Aj+E2CWCY2aiUyZn5JiproiV1oScZyrLjMBtSwIrIOzSmMWkbEhpTsRL5QmCSsLOM6JV0Exz/fmO5wwJrkOea9IF/m9XuYm0DqGBVJwM9AYryzIMN1fahvKTKocq2SqsB2Rk0QtzKT4MyMZ0oIkZREp8D/tYVbXdqhCu3TnpNHAGYlMS8E5SfANJhuAQ+N3vkn8QJ5gQcGMqTsYj8ZzdDs0cOLOwPXmnXGvT52B5y0wjuJRL3ZhdbeyQOUU1aTknEWowO9boIhTZGrynyBFHSUfnh1nszTJkkV0fQxvTWnOUVOVyRttqRbKhltkGcm6OSgrq8+GymkQzi5nt8H1eXAfXL/75UMwAQtK5AWti1lZG+swmFzO7t9NJmHLqMrLt20uIuSJUNo/6w/HbbdZEH4Mwvurm0nQ8tsC0DK8/W36Tbs7C1iKD2bsc4HLLhN2A7Bd51CedXtdDxqzacH5VHAWLcGHy8W10FNJijIjFZyVlJFSUynmFdH0ZY1WmqJp/U8wR5WABXahpD1nmZ0Qcp1ECUWPXZWA6eQFMl5Iuk0kqUTwGHzPApYxzZBPiONyRpHIYgW+61mQk2Qi3hnSLCVR6M2Y9z0xkIQxe62ZS1KikJUMPQFnKdPVtygvjD44blqJdCqkYcTtja4YVF6fC1InmK4sKAUvUroSRabrdk7N1ynqBHywq516FECjP//pPdChL7mQmqTvdp1TdkKz6q4zfJdL53QuD5quDvDw7vz25n3wx7rsCynSRsAW7OEK8/e0DGlhhh5puWO/F8D0NyMeN9Y75+HWqTJpWqfluS78ohVho6HX+5nGrGTKnFowHJ55Q68/8s4cp2gBuBtdUSRJn1yJBSI3Jw7y+mCucTuM17cR/Plg9EbeuOe+Mhj+fiN9te6/0ViDF0SxJSdbq68140jIozoxMpv/oCzUMyeowE+k85l564/cvjccjd3eCxL49rbBj9d8sGmPNuYP9dk/5X84cHrj4ch1sv/5f4bt5L4Eigvk6lXo4J253RZ5jJpmWqKmh6Xp2/WN95wjS2+bh2lz832jT9Pj9/PtuxWjiJS6EnFVL4SE8e+Saboxid7tAd4GVmkhayrdX3dfDbEZvGCc1FJpqhhRGnVRS8Rd+ydgiYzjnFO4+ZfCsVp/WTir1V8BAAD//1BLBwj1r993ywMAAJ4SAABQSwECFAAUAAgACAAAAAAA9a/fd8sDAACeEgAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAAQQAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"817","uid":"31c4e77f-2232-4457-807b-e5e86c3946b2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"817"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6796639790538714e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6796639791430504e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6796639791482697e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6796639791518521e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6796639792476342e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.679663979247686e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6796639793434145e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFFz2jgQ/i/7bLANOIDfcsG5ybRJGMP15qbDMIu9xJrIlivJbpkM//1GNhBDacJdm15y0ydAWq12v2/3k8QDYM4+kFRMZOAD5rmySxcsuGdZDD5MNGpaFnxCGixISWOMGsF/AMwyoVEzkSnzU1LMVFvkSksijgvVZsahlgWBdXRWacwiMjakdCvihdIkYW0BxwXxyinm+cF8ayk4F59Jbp3OFekin+tVblxtvVggBTcDO/O1BRmmh9s13ZlplWMVUuW6JXKSqIWZFJ8zkiEtSVIWkQL/4wFydYbH8rRLd0EaDaiRyLQUnJME3yCzgzk06y52wR+JFCwomDF1e8PBcIFui3pO3Oq53qI17HSp1fO8JcZRPOjELqxnawtUTlFNTc5ZhAr8rgWKOEUmJ/8BUtRR8v5F0DbbkyxZRDdPo64pzTlqquJ5w+XVwNuwjCwjWZcJZWX1uSF1HISTq8k0uLkI5sHN+W/vgxFYUCIvaJvQ2tpZh8HoajI/H43ChlEVmW/bXETIE6G0f9btD5vLJkH4IQjn17ejoLHuEYSG4fSP8TftZhawFO/M2KcCV20m7A3Idh1DedbutD3YmI0LzseCs2gFPlwtb4QeS1KUGengrKSMlBpLsajIpi9btNIUTRN8hAWqBCywCyXtBcvshJDrJEooum+rBExNL5HxQtI0kaQSwWPwPQtYxjRDPiKOqwlFIosV+K5nQU6SiXhvSLOURKF3Y97zwiAJY/ZaY5ekRCErSXoAzlKmq29RXhitcNy0ku1USMOJ2xlcM6hWfSpInWC6tqAUvEjpWhSZrgs6NV/HqBPwwa769RkIjRr9r/ugRV9yITVJ3207p3TDZtf9xfAsm87pbB41XR/h4fxievsu+Gub9qUU6UbEluzuGvN3tAppaYbuabVnf+DAVDgjHm+s907Hx0WVyaZ4Giu3iV82POx09OYw0piVTJkzDPr9M6/vdQfemeMUDQD3vSuKJOmTM7FA5ObkQV4f0zVux/H6NoI/H4zOwBt23FcGwz8vpK/2/S8Kq/eCKDbk5NHqa814wuWTOjEwzX9UFuqZE1TgJ9L5g3nrDtyu1x8M3c4LEvj22uD7cz5atE8W5nfV2b/lv99zOsP+wHWyX/z/gHZyXwLFJXL1KnRwZu63RR6jpomWqOluZep2e+e94MjS6eaBurn7vuEn6nO39McXLEYRKXUt4iprCAnjPyXTdGvCnR3A3oRXaSFrQt3f918PsRm8ZJzUSmmqeFEadVELxaz5E7BExnHBKdz9c+FYjb8xnPX67wAAAP//UEsHCBqY34bNAwAAuBIAAFBLAQIUABQACAAIAAAAAAAamN+GzQMAALgSAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAADBAAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"836","uid":"26967f7d-dc15-4fe4-91f2-b629dec8562a"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6796639796435993e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"836"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6796639796490006e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6796639796509686e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.679663979654231e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.679663979743528e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6796639797490842e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6796639797491243e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6796639798441808e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6796639799517918e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6796639799518242e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "0", "Expected.Replicas": 3}
MATT IS HERE: Reconcile
1.6796640999527643e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.679664099962314e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFFv4jgQ/i/zHEgCpEDe9kp6qnbbotDb02lVVUMyNFadOGs7uUUV//3kJEBgWZa7bffa0z0B9sx45vvGn22eAHP2kaRiIgMfMM+VXbpgwSPLYvBhplHTouAz0mBBShpj1Aj+E2CWCY2aiUyZn5JiproiV1oScZyrLjMBtSwIrIOzSmMWkbEhpTsRL5QmCSsLOM6JV0Exz/fmO5wwJrkOea9IF/m9XuYm0DqGBVJwM9AYryzIMN1fahvKTKocq2SqsB2Rk0QtzKT4MyMZ0oIkZREp8D/tYVbXdqhCu3TnpNHAGYlMS8E5SfANJhuAQ+N3vkn8QJ5gQcGMqTsYj8ZzdDs0cOLOwPXmnXGvT52B5y0wjuJRL3ZhdbeyQOUU1aTknEWowO9boIhTZGrynyBFHSUfnh1nszTJkkV0fQxvTWnOUVOVyRttqRbKhltkGcm6OSgrq8+GymkQzi5nt8H1eXAfXL/75UMwAQtK5AWti1lZG+swmFzO7t9NJmHLqMrLt20uIuSJUNo/6w/HbbdZEH4Mwvurm0nQ8tsC0DK8/W36Tbs7C1iKD2bsc4HLLhN2A7Bd51CedXtdDxqzacH5VHAWLcGHy8W10FNJijIjFZyVlJFSUynmFdH0ZY1WmqJp/U8wR5WABXahpD1nmZ0Qcp1ECUWPXZWA6eQFMl5Iuk0kqUTwGHzPApYxzZBPiONyRpHIYgW+61mQk2Qi3hnSLCVR6M2Y9z0xkIQxe62ZS1KikJUMPQFnKdPVtygvjD44blqJdCqkYcTtja4YVF6fC1InmK4sKAUvUroSRabrdk7N1ynqBHywq516FECjP//pPdChL7mQmqTvdp1TdkKz6q4zfJdL53QuD5quDvDw7vz25n3wx7rsCynSRsAW7OEK8/e0DGlhhh5puWO/F8D0NyMeN9Y75+HWqTJpWqfluS78ohVho6HX+5nGrGTKnFowHJ55Q68/8s4cp2gBuBtdUSRJn1yJBSI3Jw7y+mCucTuM17cR/Plg9EbeuOe+Mhj+fiN9te6/0ViDF0SxJSdbq68140jIozoxMpv/oCzUMyeowE+k85l564/cvjccjd3eCxL49rbBj9d8sGmPNuYP9dk/5X84cHrj4ch1sv/5f4bt5L4Eigvk6lXo4J253RZ5jJpmWqKmh6Xp2/WN95wjS2+bh2lz832jT9Pj9/PtuxWjiJS6EnFVL4SE8e+Saboxid7tAd4GVmkhayrdX3dfDbEZvGCc1FJpqhhRGnVRS8Rd+ydgiYzjnFO4+ZfCsVp/WTir1V8BAAD//1BLBwj1r993ywMAAJ4SAABQSwECFAAUAAgACAAAAAAA9a/fd8sDAACeEgAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAAQQAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"817","uid":"31c4e77f-2232-4457-807b-e5e86c3946b2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6796640999679053e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"817"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6796640999710248e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6796641000438614e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6796641000500753e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6796641002435925e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.679664100249201e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.679664100249277e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6796641002542453e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.679664100446309e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFFz2jgQ/i/7bLANOIDfcsG5ybRJGMP15qbDMIu9xJrIlivJbpkM//1GNhBDacJdm15y0ydAWq12v2/3k8QDYM4+kFRMZOAD5rmySxcsuGdZDD5MNGpaFnxCGixISWOMGsF/AMwyoVEzkSnzU1LMVFvkSksijgvVZsahlgWBdXRWacwiMjakdCvihdIkYW0BxwXxyinm+cF8ayk4F59Jbp3OFekin+tVblxtvVggBTcDO/O1BRmmh9s13ZlplWMVUuW6JXKSqIWZFJ8zkiEtSVIWkQL/4wFydYbH8rRLd0EaDaiRyLQUnJME3yCzgzk06y52wR+JFCwomDF1e8PBcIFui3pO3Oq53qI17HSp1fO8JcZRPOjELqxnawtUTlFNTc5ZhAr8rgWKOEUmJ/8BUtRR8v5F0DbbkyxZRDdPo64pzTlqquJ5w+XVwNuwjCwjWZcJZWX1uSF1HISTq8k0uLkI5sHN+W/vgxFYUCIvaJvQ2tpZh8HoajI/H43ChlEVmW/bXETIE6G0f9btD5vLJkH4IQjn17ejoLHuEYSG4fSP8TftZhawFO/M2KcCV20m7A3Idh1DedbutD3YmI0LzseCs2gFPlwtb4QeS1KUGengrKSMlBpLsajIpi9btNIUTRN8hAWqBCywCyXtBcvshJDrJEooum+rBExNL5HxQtI0kaQSwWPwPQtYxjRDPiKOqwlFIosV+K5nQU6SiXhvSLOURKF3Y97zwiAJY/ZaY5ekRCErSXoAzlKmq29RXhitcNy0ku1USMOJ2xlcM6hWfSpInWC6tqAUvEjpWhSZrgs6NV/HqBPwwa769RkIjRr9r/ugRV9yITVJ3207p3TDZtf9xfAsm87pbB41XR/h4fxievsu+Gub9qUU6UbEluzuGvN3tAppaYbuabVnf+DAVDgjHm+s907Hx0WVyaZ4Giu3iV82POx09OYw0piVTJkzDPr9M6/vdQfemeMUDQD3vSuKJOmTM7FA5ObkQV4f0zVux/H6NoI/H4zOwBt23FcGwz8vpK/2/S8Kq/eCKDbk5NHqa814wuWTOjEwzX9UFuqZE1TgJ9L5g3nrDtyu1x8M3c4LEvj22uD7cz5atE8W5nfV2b/lv99zOsP+wHWyX/z/gHZyXwLFJXL1KnRwZu63RR6jpomWqOluZep2e+e94MjS6eaBurn7vuEn6nO39McXLEYRKXUt4iprCAnjPyXTdGvCnR3A3oRXaSFrQt3f918PsRm8ZJzUSmmqeFEadVELxaz5E7BExnHBKdz9c+FYjb8xnPX67wAAAP//UEsHCBqY34bNAwAAuBIAAFBLAQIUABQACAAIAAAAAAAamN+GzQMAALgSAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAADBAAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"836","uid":"26967f7d-dc15-4fe4-91f2-b629dec8562a"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"836"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6796641004520605e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6796641004551187e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.679664100458954e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6796641005441234e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6796641005490193e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6796641005490608e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6796641006442904e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6796641007493367e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.679664100749386e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "0", "Expected.Replicas": 3}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.679664220749656e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: patchStatefulSet
1.6796642207556403e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
1.6796642209499953e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFFv4jgQ/i/zHEgCpEDe9kp6qnbbotDb02lVVUMyNFadOGs7uUUV//3kJEBgWZa7bffa0z0B9sx45vvGn22eAHP2kaRiIgMfMM+VXbpgwSPLYvBhplHTouAz0mBBShpj1Aj+E2CWCY2aiUyZn5JiproiV1oScZyrLjMBtSwIrIOzSmMWkbEhpTsRL5QmCSsLOM6JV0Exz/fmO5wwJrkOea9IF/m9XuYm0DqGBVJwM9AYryzIMN1fahvKTKocq2SqsB2Rk0QtzKT4MyMZ0oIkZREp8D/tYVbXdqhCu3TnpNHAGYlMS8E5SfANJhuAQ+N3vkn8QJ5gQcGMqTsYj8ZzdDs0cOLOwPXmnXGvT52B5y0wjuJRL3ZhdbeyQOUU1aTknEWowO9boIhTZGrynyBFHSUfnh1nszTJkkV0fQxvTWnOUVOVyRttqRbKhltkGcm6OSgrq8+GymkQzi5nt8H1eXAfXL/75UMwAQtK5AWti1lZG+swmFzO7t9NJmHLqMrLt20uIuSJUNo/6w/HbbdZEH4Mwvurm0nQ8tsC0DK8/W36Tbs7C1iKD2bsc4HLLhN2A7Bd51CedXtdDxqzacH5VHAWLcGHy8W10FNJijIjFZyVlJFSUynmFdH0ZY1WmqJp/U8wR5WABXahpD1nmZ0Qcp1ECUWPXZWA6eQFMl5Iuk0kqUTwGHzPApYxzZBPiONyRpHIYgW+61mQk2Qi3hnSLCVR6M2Y9z0xkIQxe62ZS1KikJUMPQFnKdPVtygvjD44blqJdCqkYcTtja4YVF6fC1InmK4sKAUvUroSRabrdk7N1ynqBHywq516FECjP//pPdChL7mQmqTvdp1TdkKz6q4zfJdL53QuD5quDvDw7vz25n3wx7rsCynSRsAW7OEK8/e0DGlhhh5puWO/F8D0NyMeN9Y75+HWqTJpWqfluS78ohVho6HX+5nGrGTKnFowHJ55Q68/8s4cp2gBuBtdUSRJn1yJBSI3Jw7y+mCucTuM17cR/Plg9EbeuOe+Mhj+fiN9te6/0ViDF0SxJSdbq68140jIozoxMpv/oCzUMyeowE+k85l564/cvjccjd3eCxL49rbBj9d8sGmPNuYP9dk/5X84cHrj4ch1sv/5f4bt5L4Eigvk6lXo4J253RZ5jJpmWqKmh6Xp2/WN95wjS2+bh2lz832jT9Pj9/PtuxWjiJS6EnFVL4SE8e+Saboxid7tAd4GVmkhayrdX3dfDbEZvGCc1FJpqhhRGnVRS8Rd+ydgiYzjnFO4+ZfCsVp/WTir1V8BAAD//1BLBwj1r993ywMAAJ4SAABQSwECFAAUAAgACAAAAAAA9a/fd8sDAACeEgAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAAQQAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"817","uid":"31c4e77f-2232-4457-807b-e5e86c3946b2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"817"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6796642209566717e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6796642209594843e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6796642210432453e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.679664221046035e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6796642210506358e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6796642210506604e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6796642210544322e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.679664221445827e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFFz2jgQ/i/7bLANOIDfcsG5ybRJGMP15qbDMIu9xJrIlivJbpkM//1GNhBDacJdm15y0ydAWq12v2/3k8QDYM4+kFRMZOAD5rmySxcsuGdZDD5MNGpaFnxCGixISWOMGsF/AMwyoVEzkSnzU1LMVFvkSksijgvVZsahlgWBdXRWacwiMjakdCvihdIkYW0BxwXxyinm+cF8ayk4F59Jbp3OFekin+tVblxtvVggBTcDO/O1BRmmh9s13ZlplWMVUuW6JXKSqIWZFJ8zkiEtSVIWkQL/4wFydYbH8rRLd0EaDaiRyLQUnJME3yCzgzk06y52wR+JFCwomDF1e8PBcIFui3pO3Oq53qI17HSp1fO8JcZRPOjELqxnawtUTlFNTc5ZhAr8rgWKOEUmJ/8BUtRR8v5F0DbbkyxZRDdPo64pzTlqquJ5w+XVwNuwjCwjWZcJZWX1uSF1HISTq8k0uLkI5sHN+W/vgxFYUCIvaJvQ2tpZh8HoajI/H43ChlEVmW/bXETIE6G0f9btD5vLJkH4IQjn17ejoLHuEYSG4fSP8TftZhawFO/M2KcCV20m7A3Idh1DedbutD3YmI0LzseCs2gFPlwtb4QeS1KUGengrKSMlBpLsajIpi9btNIUTRN8hAWqBCywCyXtBcvshJDrJEooum+rBExNL5HxQtI0kaQSwWPwPQtYxjRDPiKOqwlFIosV+K5nQU6SiXhvSLOURKF3Y97zwiAJY/ZaY5ekRCErSXoAzlKmq29RXhitcNy0ku1USMOJ2xlcM6hWfSpInWC6tqAUvEjpWhSZrgs6NV/HqBPwwa769RkIjRr9r/ugRV9yITVJ3207p3TDZtf9xfAsm87pbB41XR/h4fxievsu+Gub9qUU6UbEluzuGvN3tAppaYbuabVnf+DAVDgjHm+s907Hx0WVyaZ4Giu3iV82POx09OYw0piVTJkzDPr9M6/vdQfemeMUDQD3vSuKJOmTM7FA5ObkQV4f0zVux/H6NoI/H4zOwBt23FcGwz8vpK/2/S8Kq/eCKDbk5NHqa814wuWTOjEwzX9UFuqZE1TgJ9L5g3nrDtyu1x8M3c4LEvj22uD7cz5atE8W5nfV2b/lv99zOsP+wHWyX/z/gHZyXwLFJXL1KnRwZu63RR6jpomWqOluZep2e+e94MjS6eaBurn7vuEn6nO39McXLEYRKXUt4iprCAnjPyXTdGvCnR3A3oRXaSFrQt3f918PsRm8ZJzUSmmqeFEadVELxaz5E7BExnHBKdz9c+FYjb8xnPX67wAAAP//UEsHCBqY34bNAwAAuBIAAFBLAQIUABQACAAIAAAAAAAamN+GzQMAALgSAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAADBAAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"836","uid":"26967f7d-dc15-4fe4-91f2-b629dec8562a"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-24T13:17:12Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}],"resourceVersion":"836"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"14989ba1-e40d-415b-923e-455fadcd82d1"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"776575385600u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"285921u","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"3813578912","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"740297810n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"1","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}}],"image":"ACTOKEY","imagePullPolicy":"ACTOKEY","name":"ACTOKEY","resources":{"limits":{"cpu":"800m"},"requests":{"cpu":"800m"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6796642214533522e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.679664221456265e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6796642215480647e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.679664221551587e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6796642216468477e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6796642216469e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6796642216515763e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6796642217483258e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6796642217485087e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "0", "Expected.Replicas": 3}

