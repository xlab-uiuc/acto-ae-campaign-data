MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116429382432e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.680311642945955e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803116429545813e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803116429754038e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116429781802e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116430735543e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116431731677e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.680311643178434e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.680311643178488e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116432709026e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"replicas":0,"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"$setElementOrder/volumeMounts":[{"mountPath":"/data"},{"mountPath":"/etc/redis/external.conf.d"}],"livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":null,"successThreshold":5,"terminationGracePeriodSeconds":3,"timeoutSeconds":null},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"periodSeconds":null,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"volumeMounts":[{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zgM/l/47MRxu/SH33aN71Bg7QKnt3sYioCWmVmYLGkS5S0I/L8f5PxYWvQufTnguqfE1EeK/D6S2gBa+Ymcl0ZDDmitT7sMEvgqdQ05LBiZVkEtiCGBlhhrZIR8A6i1YWRptI+fjmrpx8Z6dkQKKz+WMSC7QJC8eOoZtaCIIc8joYJnctAnoLAiNQRFa5+dj1ZGKfOd3D7o0hMHu+S1jaH2URJwRkXDAd4noLF9ft1xuHjsLQ4pDaFHxpJDNvHQfNfkSlqRIy3IQ/75GXPbCl+qM+2yihgjqcJodkYpcpBHZg40l9Hv5pD8C5lCAkFGaH0+xcnVBEcXlcDRO1Gdj6ozvB5l08t39aXAq8vrCfSPfQLekthKY5UU6CE/T8CTIhFryjfQIovmw3/CdryeXCcF3f8760ytVcg05POG2+uI76gySk1u2yaku+F3J+q8KBe3i4fi/qZYFvfvf/tQzCCBDlWgfUF9ckCXxex2sXw/m5VHoCGzPE2VEaga4zm/OL+8PnZbFOWnolzefZwVR34/STgCPvw5/0fcYwKyxS/R9i3geixNuiM53ebQXYzPxlPYweZBqblRUqwhh9vVveG5I086rg4lO9Lk/dyZahCbfuzZaluMQ/AZKvQNJJAG79JK6rQhVNyIhsTXsW8g9vQKpQqOHhpHvjGqhnyagNSSJaoZKVwvSBhde8izaQKWnDT1ExPLlkzgg216ejE4wlr+X3N35E1ww0ragJKt5OGfsAFyyCZZO6zt1rioSXZ2dSdh8PoWyL8C2ifQGRVaujNB87ah2/h3jtxADukwrycojNvol56DEf2wxjG5PBtPXjMNu1ufOsNJNSevV/NFaN8/RkWDrZFpwQ6Zvqwh3xxUvlEo24fdSt6p/YaX8qm+/LmzUQjy/s7UQ9VQEtZ/Ocn0Mab7+EyYY749G7ftjOyPp/NSR+PvUpFfe6Z2uI2RQ3Trtw/0/hOwQ6mwUlQe3upJcvRwT/r+7wAAAP//UEsHCMOZe9DyAgAAqgkAAFBLAQIUABQACAAIAAAAAADDmXvQ8gIAAKoJAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAAoAwAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:15Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1412","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680311643471775e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"replicas\":0,\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"affinity\":{\"nodeAffinity\":{\"requiredDuringSchedulingIgnoredDuringExecution\":{\"nodeSelectorTerms\":[{\"matchExpressions\":[{\"key\":\"kubernetes.io/hostname\",\"operator\":\"In\",\"values\":[\"kind-worker\",\"kind-worker2\",\"kind-worker3kind-control-plane\"]}]}]}}},\"containers\":[{\"$setElementOrder/volumeMounts\":[{\"mountPath\":\"/data\"},{\"mountPath\":\"/etc/redis/external.conf.d\"}],\"livenessProbe\":{\"exec\":{\"command\":[\"ACTOKEY\",\"ACTOKEY\"]},\"failureThreshold\":1,\"grpc\":{\"port\":2},\"httpGet\":{\"host\":\"ACTOKEY\",\"httpHeaders\":[{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"}],\"path\":\"ACTOKEY\",\"port\":\"ACTOKEY\",\"scheme\":\"ACTOKEY\"},\"initialDelaySeconds\":5,\"periodSeconds\":null,\"successThreshold\":5,\"terminationGracePeriodSeconds\":3,\"timeoutSeconds\":null},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"exec\":{\"command\":[\"ACTOKEY\"]},\"failureThreshold\":1,\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"},\"initialDelaySeconds\":2,\"periodSeconds\":null,\"tcpSocket\":{\"port\":3},\"terminationGracePeriodSeconds\":2,\"timeoutSeconds\":3},\"volumeMounts\":[{\"mountPath\":\"/etc/redis/external.conf.d\",\"name\":\"external-config\"}]}],\"volumes\":[{\"configMap\":{\"name\":\"ACTOKEY\"},\"name\":\"external-config\"}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:15Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1412"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1412", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc001080aec), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00074e1b0), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 10, 15, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00074e1e0), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc001080ae8), Selector:(*v1.LabelSelector)(0xc0007d4120), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc0008fa740), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc0005a1000), ReadinessProbe:(*v1.Probe)(0xc0005a0fc0), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc001317338), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000d802d0), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803116435836236e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116435870738e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803116435871058e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680311643590224e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803116435933492e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116435933678e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.680311643596877e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.680311643669613e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311643000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave 15627911390c3dd79954fdb1f46334a9002336af 0 1680311642043 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311640000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311642000 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311642000 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311643351 3 connected 10923-16383\n"}
1.6803116436696997e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803116436780229e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803116439700115e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311643000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave 15627911390c3dd79954fdb1f46334a9002336af 0 1680311642043 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311640000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311642000 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311642000 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311643351 3 connected 10923-16383\n"}
1.680311643970156e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803116439701698e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803116439701827e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803116539716258e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116539820063e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680311654073045e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803116540783403e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116540803e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116540839112e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116540861387e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116541726096e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803116541726665e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116541770985e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1810","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803116546741161e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1810"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:15Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1412"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1810", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc000c36ac4), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000d44270), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000d442a0), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000c36ac0), Selector:(*v1.LabelSelector)(0xc00049c180), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc0003a18c0), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc0005a1280), ReadinessProbe:(*v1.Probe)(0xc0005a1240), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc000847080), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000d643d0), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803116547858727e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116547921245e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.68031165479217e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803116547961843e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680311654799718e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116547997413e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803116548712819e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.680311654871978e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311654570 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave 15627911390c3dd79954fdb1f46334a9002336af 0 1680311653599 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311653000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311653000 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311654403 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311654000 3 connected 10923-16383\n"}
1.680311654872135e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803116549704697e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803116549714735e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311654570 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave 15627911390c3dd79954fdb1f46334a9002336af 0 1680311653599 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311653000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311653000 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311654403 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311654000 3 connected 10923-16383\n"}
1.680311654971548e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803116549715614e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803116549715736e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803116649718657e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116649807289e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}
1.6803116652779124e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}

1.6803116653748066e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116653771307e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116653807085e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116653837e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116653868675e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803116653869174e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116654715137e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1849","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1849"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803116656716664e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1810"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1849", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc0008fd204), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000b54660), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000b54690), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc0008fd200), Selector:(*v1.LabelSelector)(0xc00049cf80), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc00074a4c0), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc0006b4e00), ReadinessProbe:(*v1.Probe)(0xc0006b4dc0), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc000b54168), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc00052fd00), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803116656926296e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116656976726e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680311665697714e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803116657709115e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803116657766466e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116657767072e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803116659699996e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.680311666069714e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311665000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave 15627911390c3dd79954fdb1f46334a9002336af 0 1680311665513 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311663000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311664000 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311665011 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311665000 3 connected 10923-16383\n"}
1.6803116660702736e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803116661703577e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803116661716537e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311665000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave 15627911390c3dd79954fdb1f46334a9002336af 0 1680311665513 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311663000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311664000 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311665011 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311665000 3 connected 10923-16383\n"}
1.6803116661717358e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.680311666171746e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803116661717565e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803116761727252e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116761793997e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680311676186241e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680311676189415e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116761905935e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116762736185e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116762770646e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116762806523e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.680311676280693e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116762849395e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
1.6803116768710084e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWW1z2zgO/i/4LPktSdvoWy/xZjPXtB7bm5vbNJOhKdjmhCK1JOXG59F/vyH1Rsl24+5uey+zky8SCIDEAxB64OyApOwelWZSQAQkTXV/M4QAnpmIIYKZIQaXGZ+hgQASNCQmhkC0AyKENMQwKbR9VRgz3ZOpNgqRk4XuMevQqAwhOLiqDREUrQ5qE1KeaYMK8gCoQud3zhLUhiQpRDAajM7CwXk4GM4Hw2hwGZ1d/goBcLJA7vYnadpxFS4l5/ILqmr/J40mS5/MNrW7VhsGoCS3glo9DyAhgqww/okhjzVED0dhWjqNeeGyUL9v5PdDe7Rl5OO2jDrI9SDa5QEsowUR/yKMcpnFPSqTPifahCRNOcO40jkM8/G1CuRd7lQavOpdHXCegxZKpdwBVLqQXwSqKS5RoaDo+3qOdp8hY/FniD5DfHZBBu8GJHyzoCQ8p4uzcDEil+Hw4u15/JaSd28vB58hd26dX50iLfBJZXzn8E9QmInkjG6bE6acUaKb9w2zOfmZaSPV9gNLmKnWNHKkRqrmXW0YxY8kqQMzmKScGPyWLP1nM9CBiiyXTDCzbfkTMsb3hxYU/pYxhfF1pphYzega44wzsbpdCVmLxy9IM+PqvNqPSmEIE6jcuV2aBUnQ5dmdOMSXVCqDqshosyOKTbdAasvJeDq7nc3HH6/GT+OP7//2YXzdNRderjaEZxWMbUfT8fXt7On99fX099nPxtP78fTp7tP1+Pc6mP8y+QZ798oSsqrX3Msk47xd7r65Qi0z1b5xy4jbim+LaJpVjwkmUm3r2rP5R32Senk9VMKEuwN3qLU9IjFrqC/P3mp9+D2IDjbmv6rlFPuTq4WzDQrUeqLkAtvAvhQNo0m6TBIi4royloTxTOF8rVCvJa8/N2tj0hs0Ldu11MZf/xlJXLQGJ0q9ErFNoXrWdI1J0wdtd2KEXyMn2xlSKeLGAyom445QZ5Si1nsn9KrwRhGKk0PGhiUoM+NJ9/BWSGL2J6P3p8VI05mkz508VOD+YRj+pzqLXd9IniV4JzNh9vhHYqXWmbtrffs9716zWqUSVHVwxAca2nefuT6+GFSC8B6VYtmLT3dchh0L3eUz2hDVITm6+DCj8qmKRpopZrZXUhh8MQegOp73Aq89qOqOVIUV2rDYqhtWIb0jaUsa45Jk3NzJGA/guB97lsbE4MwoYnDleImjNZZ//OKW2sVNlGE1C3GRlnTIi+iKE5bMSw6nq+oquLuCCG5kaBtUSDlDYecXmaIihVcoNw3A3oq9CWN4Hg3OfoU8+IPMXxtiMl08kw1hnCw4TjsslloY7AZXtoBqaaYUCrOnXIkL5luJ5cLyW4xvUNQxVjVG4m3XS5dIF9nxnbahfM4WaMvD2JShCquVI5jqbFF1FYigBOEVqB8DKGrm6BRnl3VKnM+CdxabS3eO7lzSHdoKcn6Iovc3wwUaYrPXhAiRnV3rQXhq7a7qmfHASSGwww9EJ40+LtwKouaMw3fnl3b+rBh+k6ZBAN5AAwkxdP3hu0y/dnt/VDrq1p+efswvA99n3Pfw9uep7hj1zdOT8zArkzZHlRRF6VI3fkkVal1g9LCDZ9yWt0wJNKh7TPYt0XJ1Vl0ym3q4FRCAY4fW0pVn+EWqZxeb9zZqv56557K8w5QTgfCY2z8bvz/hPezAEfGHXVXlB7h3dYYqkbZRltoNwfaUXEaifp9LSrgNLHpz9vbSN/N4tWfXJN9TrPjzIb3HAEquDL9lZGtxLIur+IZHmze9Ue8CSjWfRcPt8qM0E4W6+Frs8emKCNb87wHeX80//X38Twjqp0fbT/cI4TCAlUqddcHbRnkAHrsuSLXnrsWsm1Q0ClXklcRD6L9H6TGAYh7wlIr4PUE1GXi+4SB1vrAfli5FvrCN6Ksk6Cx/9cuyz/6/kusTM3xe99ETQhsF0GL5hQt78leCGxVfVZ/WW6sWp2+ovKPkMBwME/drbkHKYTh6d8fAWTU0/quqeQBtEm77WsN+C959+DMZer+zdoyOEu3GU4eqQv5ovfwf96v6p7Vo2Buc0rXKXdvG8GpFDE6viIOquY2kHjQe7MXxpoZOp8i/ls88gL1Zoa63LuXvkjz/fxcTK9UGhblvbH/YfzG+D1d59Uo1VMY1SjueOZ4wRRL/QzGDn+xxHzv14KdZG6mKghzetK+6nfTgJ8ZRb7XBxO1Wzzfpmmh3+VDETKwgt1fTWz8w/QwCn+Dm+b8DAAD//1BLBwgIZ9NakgYAAI0aAABQSwECFAAUAAgACAAAAAAACGfTWpIGAACNGgAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAyAYAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1875","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1875"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1849"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1875", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc0008fda04), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000b55f80), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000b55fb0), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc0008fda00), Selector:(*v1.LabelSelector)(0xc000b34180), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc00053aa40), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc001046cc0), ReadinessProbe:(*v1.Probe)(0xc001046c80), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc00104b0f8), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000fb9240), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803116768849628e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116769699302e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803116769700065e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803116769754705e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803116769796221e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116769796615e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803116769832277e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803116769838977e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311676562 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311674000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311676562 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311676000 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311676000 3 connected 10923-16383\n"}
1.680311676983974e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803116770708528e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803116770714629e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311676562 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311674000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311676562 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311676000 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311676000 3 connected 10923-16383\n"}
1.6803116770715482e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803116770715692e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803116770715826e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116870720553e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803116870772462e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803116873758194e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.68031168747389e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116874758368e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680311687479312e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116874812958e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116874839363e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
1.6803116874839783e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateOrUpdateStateFul
1.6803116874879162e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
1.6803116876770654e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1924","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1924"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1875"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1924", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc000da6334), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000ffd830), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000ffd860), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000da6330), Selector:(*v1.LabelSelector)(0xc000808ee0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc0006b4880), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc00074bd80), ReadinessProbe:(*v1.Probe)(0xc00074bd40), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc001280fc0), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc00054f070), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803116878809583e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116879699006e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803116879699523e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803116879753933e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803116879800682e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116879801307e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "2"}
1.680311687985159e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.680311688069573e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311686608 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311686000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311687611 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311686000 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311687000 3 connected 10923-16383\n"}
1.6803116880696719e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803116880741518e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803116880749302e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311686608 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311686000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311687611 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311686000 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311687000 3 connected 10923-16383\n"}
1.6803116880749846e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.680311688074993e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803116880750034e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803116980761516e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116980849965e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803116981768188e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803116981815238e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116982720358e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803116982777982e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.68031169828073e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803116982841113e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.680311698284131e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803116982883012e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1950","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803116986751347e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1950"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1924"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1950", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc0007bee3c), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000daa660), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000daa690), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc0007bee38), Selector:(*v1.LabelSelector)(0xc000f8c3c0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc0006733c0), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc0006b4a00), ReadinessProbe:(*v1.Probe)(0xc0006b49c0), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc000b361c8), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000fa8280), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.680311698781845e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680311698873368e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803116988734286e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803116988773956e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803116988811173e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803116988811517e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "2"}
1.680311698884774e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803116989695692e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311698000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311697000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311697655 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311698658 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311697000 3 connected 10923-16383\n"}
1.680311698969653e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.680311698975788e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803116989764726e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311698000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311697000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 0 1680311697655 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311698658 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311697000 3 connected 10923-16383\n"}
1.6803116989765627e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.680311698976582e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803116989765933e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803117089775636e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803117092709672e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803117092780085e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680311709282872e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117092851841e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117093700905e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803117094712737e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803117094763463e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803117094764185e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803117094822211e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
1.680311709971649e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2015","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2015"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:14:03Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1950"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"2015", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc000d22e64), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00068c390), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 15, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00068c3c0), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000d22e60), Selector:(*v1.LabelSelector)(0xc00049c9e0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc0006b4540), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc00047e600), ReadinessProbe:(*v1.Probe)(0xc00047e4c0), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc00124a060), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000d0a510), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.680311710079467e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117100818813e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117100819004e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117100843701e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680311710086869e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680311710086902e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "1"}
1.680311710089812e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803117101695657e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311709710 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311709000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311709000 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311708505 3 connected 10923-16383\n"}
1.6803117101696382e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803117101753976e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803117101760128e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311709710 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311709000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311709000 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311708505 3 connected 10923-16383\n"}
1.6803117101760964e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803117101761153e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803117101761339e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680311720177153e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: patchStatefulSet
1.6803117201855123e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803117205744042e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680311720676537e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117206791277e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117206829007e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.680311720684971e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.680311720687901e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803117206879246e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803117206918154e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
1.680311720875446e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2023","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2023"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2015"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"2023", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc000b4ab84), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000dab4a0), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 15, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000dab4d0), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000b4ab80), Selector:(*v1.LabelSelector)(0xc0003d5640), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc000137f40), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc001046d40), ReadinessProbe:(*v1.Probe)(0xc001046d00), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc001329b18), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000273730), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803117209811752e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117209850929e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117209851403e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117209903245e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680311720995406e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117209954426e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "1"}
1.680311721000353e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803117210695913e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311720000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311720000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311720757 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311720556 3 connected 10923-16383\n"}
1.6803117210697086e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.680311721078071e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.68031172107905e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311720000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311720000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311720757 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311720556 3 connected 10923-16383\n"}
1.680311721079111e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803117210791216e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803117210791383e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803117310799098e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803117310914843e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.680311731098225e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680311731102221e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117311709943e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680311731174585e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803117311766129e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803117311797256e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803117311797698e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803117311839015e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
1.680311731373023e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWW1z2zgO/i/4LPktSdvoWy/xZjPXtB7bm5trmsnQFGxzQpFaknLj8+i/35B6o2S7cXe3ey+zky8SCIDEAxB64OyApOwelWZSQAQkTXV/M4QAnpmIIYKZIQaXGZ+hgQASNCQmhkC0AyKENMQwKbR9VRgz3ZOpNgqRk4XuMevQqAwhOLiqDREUrQ5qE1KeaYMK8gCoQud3zhLUhiQpRDAajM7CwXk4GM4Hw2hwGZ1dfoYAOFkgd/uTNO24CpeSc/kVVbX/k0aTpU9mm9pdqw0DUJJbQa2eB5AQQVYY/8SQxxqih6MwLZ3GvHBZqN838vuhPdoy8nFbRh3kehDt8gCW0YKIfxFGucziHpVJnxNtQpKmnGFc6RyG+fhaBfIudyoNXvWuDjjPQQulUu4AKl3IrwLVFJeoUFD0fT1Huy+QsfgLRF8gPrsgg3cDEr5ZUBKe08VZuBiRy3B48fY8fkvJu7eXgy+QO7fOr06RFvikMr5z+CcozERyRrfNCVPOKNHN+4bZnPzMtJFq+4ElzFRrGjlSI1XzrjaM4keS1IEZTFJODH5Plv6zGehARZZLJpjZtvwJGeP7QwsKf82Ywvg6U0ysZnSNccaZWN2uhKzF4xekmXF1Xu1HpTCECVTu3C7NgiTo8uxOHOJLKpVBVWS02RHFplsgteVkPJ3dzubjj1fjp/HH93/7ML7umgsvVxvCswrGtqPp+Pp29vT++nr62+xn4+n9ePp09+l6/FsdzH+ZfIe9e2UJWdVr7mWScd4ud99coZaZat+4ZcRtxbdFNM2qxwQTqbZ17dn8oz5JvbweKmHC3YE71NoekZg11Jdnb7U+/B5EBxvzX9Vyiv3J1cLZBgVqPVFygW1gX4qG0SRdJgkRcV0ZS8J4pnC+VqjXktefm7Ux6Q2alu1aauOv/4wkLlqDE6VeidimUD1rusak6YO2OzHCr5GT7QypFHHjARWTcUeoM0pR670TelV4owjFySFjwxKUmfGke3grJDH7g9H7w2Kk6UzS504eKnB/Nwz/U53Frm8kzxK8k5kwe/wjsVLrzN21vv2ed69ZrVIJqjo44gMN7bvPXB9fDCpBeI9KsezFpzsuw46F7vIZbYjqkBxdfJhR+VRFI80UM9srKQy+mANQHc97gdceVHVHqsIKbVhs1Q2rkN6RtCWNcUkybu5kjAdw3I89S2NicGYUMbhyvMTRGss/fnFL7eImyrCahbhISzrkRXTFCUvmJYfTVXUV3F1BBDcytA0qpJyhsPOLTFGRwiuUmwZgb8XehDE8jwZnnyEPfifz14aYTBfPZEMYJwuO0w6LpRYGu8GVLaBamimFwkxLiluJ5cISWYxvUNTBVMVE4m3Xd5cxF2nwnbYxe84WaOvA2NygCquVI+DpbFG1D4igjPYYphfR4N1nyB8DKIrj6Lhml3VKnM+CYBabS3eO7gDSnc4KFn6Ii/c3wwUaYtPUhAiRHVLriXdq7a7q4fDASSGwUw5EJ804LtwKouaMFhk7aFZUvknTIABvcoGEGLr+8EPGXLu9PxMddeuPSX/OTwA/Zq738PYHp+689N1jkvMwK5M2R5UURelSN35JFWpdYPSwg2fclrdMCTSoe0z2LaNydVZdMpt6uBUQgKOB1tKVZ/hVqmcXm/c2ar+eueeyvMOUE4HwmNs/G78/yj3swDHuh11V5QdIdnWGKpG2I5baDZP2lFxGon6fS0q4DSx6c/b20jfzCLRn1yTfU6yI8iG9xwBKUgy/ZmRrcSyLq/hYR5s3vVHvAko1ny7D7fKjNBOFuvgs7BHnivHVRO8B3l/NP/19/E8I6qdH20/3mN8wgJVKnXVB0EZ5AB6NLtiz565FoZtUNApV5JXEQ+i/R+kxgIL4e0pF/J6gGgE833CQI1/YD0uXC1/YRvRNtnOWv/pl2af538j1iRk+r/voCaGNAmjR+cKFPfkrwY2Kr6rP361Vi7w3nN1xbxgOhon72bZg3zAcvbtj4Kwavv5N1TyANtu2fa2huQXBPvyZDL0fVDtGRxl146nDSSF/tF7+j/tV/RtaNOwNTula5a5tY3i1IganV8RB1dxGUk8UD/bieONBp1Pk38pnHsDeUFDXW5fbd0me/0+KiZVqg8LcN7Z/2r8rfgxXefVKNVTGNUo7hzmeMEUS/0Mxg5/scR879eCnWRupioIc3rSvuh3p4CfGUW+1wcTtVg8y6Zpod/lQxEysILdX01s/MOYMAp/g5vm/AwAA//9QSwcIdFV2o5MGAAB2GgAAUEsBAhQAFAAIAAgAAAAAAHRVdqOTBgAAdhoAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAAMkGAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2051","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2051"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2023"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"2051", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc001302714), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000dabb60), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 15, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000dabb90), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc001302710), Selector:(*v1.LabelSelector)(0xc000b5fcc0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc000e90080), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc000672380), ReadinessProbe:(*v1.Probe)(0xc000672300), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc00000c648), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc0001eff50), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803117315878246e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117315909066e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117315909333e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117316702456e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803117316742048e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117316742458e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "1"}
1.680311731677337e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803117316778722e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311730799 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311731000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311731503 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311730000 3 connected 10923-16383\n"}
1.680311731677928e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803117316816943e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803117316823053e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311730799 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311731000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 0 1680311731503 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311730000 3 connected 10923-16383\n"}
1.6803117316823928e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803117316824205e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.680311731682444e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803117416834376e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803117416949198e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680311741769953e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803117417759216e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117417786565e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680311741782868e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803117419717827e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
1.6803117419757385e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803117419757833e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateOrUpdateStateFul
1.680311742071054e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2109","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680311742276631e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2109"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2051"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"2109", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc001324adc), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00068d0e0), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 15, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00068d110), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc001324ad8), Selector:(*v1.LabelSelector)(0xc00049da20), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc0007a8a00), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc0005a00c0), ReadinessProbe:(*v1.Probe)(0xc0005a0080), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc001281ba8), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc0003770d0), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.680311742381595e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117423864284e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117423864677e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117423900843e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803117424750648e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117424751024e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "0"}
1.68031174247936e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803117424799314e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311741840 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311741000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 1680311739832 1680311737825 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311741538 3 connected 10923-16383\n"}
1.6803117424799972e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803117424842968e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803117424847713e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311741840 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311741000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 1680311739832 1680311737825 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311741538 3 connected 10923-16383\n"}
1.680311742484823e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.680311742484834e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.680311742484849e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803117524855587e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803117524924693e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803117529706411e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803117529770057e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117529781735e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117529808793e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803117530714087e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803117530762346e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803117530762813e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803117530806277e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2116","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803117532716763e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2116"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2109"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"2116", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc000da608c), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00068c3d8), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 15, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00068c408), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000da6088), Selector:(*v1.LabelSelector)(0xc0003d5140), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc0007a9340), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc0008fb0c0), ReadinessProbe:(*v1.Probe)(0xc0008fb080), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc000847ba8), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000f01820), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.680311753570663e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117535755005e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117535755599e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117535804596e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680311753583672e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680311753583698e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "0"}
1.6803117536712985e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.68031175367212e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311753000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311750000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave,fail e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 1680311739832 1680311737825 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311753585 3 connected 10923-16383\n"}
1.6803117536722066e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803117536790557e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803117536797707e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311753000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311750000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave,fail e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 1680311739832 1680311737825 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311753585 3 connected 10923-16383\n"}
1.6803117536798372e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.680311753679848e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803117536798596e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803117636804378e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680311763690546e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi07qfOhWzfWLgI0qSFnu4ciMEbUpCJKkSw51NYw9N8XlD/iBNk0hz1se5I4fDOceW843AA69Yl8UNZADuhcyLopCPiqTA05LBmZHqJeEoOAlhhrZIR8A2iMZWRlTUhLT7UKY+sCeyKNVRirFJB9JBAv7gZGIylhKPBI6hiYPPQCNFakh6Do3LP9kSasye9DrgJxdCteuxRoH0OAtzoZduBegMH2+VGPodJmcDgkM4QdWUce2aZN+7chX9IDeTKSAuSfn3G2re2lCrNuWhFjolNaw95qTR7yxMmB4DL5XR0SfyFPEBBVgtanM5xcTHB0VkkcvZPV6ag6wcvRdHb+rj6XeHF+OYH+vhcQHMmtKE4riQHyUwGBNMlUU76BFlk2H/5zntPR5Dsl6fY1vplap5FpyOQnbakjlpO2qAz5bXOQ6YbvTspFUS6vl3fF7VWxKm7f//ahmIOADnWkfTG9OKDLYn69XL2fz8sj0JBXnmXaStSNDZyfnZ5fHrsti/JTUa5uPs6LI79HAo6Ad38u/hV3L0C1+CXZvkVcj5XNdgRn2xy6s/HJeAY72CJqvbBayTXkcP1wa3nhKZBJo0KrjgyFsPC2GoSm73u22hZT63+GCkMDArIYfFYpkzWEmhvZkPw6Dg2kTn5ApaOnu8ZTaKyuIZ8JUEaxQj0njeslSWvqAPl0JsCRV7Z+YmLVko18sM1+NAw8Ya3+r5l7Cjb6YQxtQKtW8fAnXYQcppNpOwzp1vqkyPTk4kbB4PUtUngDtBfQWR1burHR8Lad2/S7QG4gh2y4qa8SmObPL30HRvTdWc/k8+l48pabsDv1qTP8UMvJ27V8Edr390nP6GpkWrJHpi9ryDcHja80qvZuN4p3Wv+kw/j1jnyc1CglhXBj66FeKAnrv7xi+pgSvX8myTHTga3f9sT0j6f3pE7G35WmsA5M7XAaI8fk1m8f4/0SsEOlsdJUHt7liTh6pCd9/08AAAD//1BLBwjAs3rA8AIAAJAJAABQSwECFAAUAAgACAAAAAAAwLN6wPACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406","uid":"d6956954-ecb9-4f87-ae88-44d2b7080792"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803117637701592e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:09:39Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:10:14Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"1406"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680311763774591e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117637768478e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803117637803879e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803117638702452e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803117638748317e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803117638748565e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803117638801115e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"grpc":{"port":2},"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"grpc":{"port":4,"service":"ACTOKEY"}}}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2144","uid":"42ea0ec5-cd6d-470c-80a2-af71d9ef1a17"},"spec":{"podManagementPolicy":"OrderedReady","replicas":0,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"periodSeconds":10,"successThreshold":5,"timeoutSeconds":1},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"initialDelaySeconds":2,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2144"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T01:09:39Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"d35a080a-6bca-4cb3-b2a9-1574d7ca8790\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:affinity":{".":{},"f:nodeAffinity":{".":{},"f:requiredDuringSchedulingIgnoredDuringExecution":{}}},"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/etc/redis/external.conf.d\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{},"f:volumes":{".":{},"k:{\"name\":\"external-config\"}":{".":{},"f:configMap":{".":{},"f:defaultMode":{},"f:name":{}},"f:name":{}}}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T01:14:03Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:collisionCount":{},"f:currentRevision":{},"f:observedGeneration":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T01:15:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"d35a080a-6bca-4cb3-b2a9-1574d7ca8790"}],"resourceVersion":"2116"},"spec":{"replicas":0,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchExpressions":[{"key":"kubernetes.io/hostname","operator":"In","values":["kind-worker","kind-worker2","kind-worker3kind-control-plane"]}]}]}}},"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY"]},"failureThreshold":1,"grpc":{"port":2},"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":5,"successThreshold":5,"terminationGracePeriodSeconds":3},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["ACTOKEY"]},"failureThreshold":1,"grpc":{"port":4,"service":"ACTOKEY"},"initialDelaySeconds":2,"tcpSocket":{"port":3},"terminationGracePeriodSeconds":2,"timeoutSeconds":3},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"},{"mountPath":"/etc/redis/external.conf.d","name":"external-config"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}],"volumes":[{"configMap":{"name":"ACTOKEY"},"name":"external-config"}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803117642711098e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"grpc\":{\"port\":2},\"terminationGracePeriodSeconds\":3},\"name\":\"test-cluster-follower\",\"readinessProbe\":{\"grpc\":{\"port\":4,\"service\":\"ACTOKEY\"}}}]}}}}"}
MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"2144", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 1, 9, 39, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"d35a080a-6bca-4cb3-b2a9-1574d7ca8790", Controller:(*bool)(0xc000c1a494), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 14, 3, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00068cc90), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 1, 15, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00068ccc0), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000c1a490), Selector:(*v1.LabelSelector)(0xc000620c80), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume{v1.Volume{Name:"external-config", VolumeSource:v1.VolumeSource{HostPath:(*v1.HostPathVolumeSource)(nil), EmptyDir:(*v1.EmptyDirVolumeSource)(nil), GCEPersistentDisk:(*v1.GCEPersistentDiskVolumeSource)(nil), AWSElasticBlockStore:(*v1.AWSElasticBlockStoreVolumeSource)(nil), GitRepo:(*v1.GitRepoVolumeSource)(nil), Secret:(*v1.SecretVolumeSource)(nil), NFS:(*v1.NFSVolumeSource)(nil), ISCSI:(*v1.ISCSIVolumeSource)(nil), Glusterfs:(*v1.GlusterfsVolumeSource)(nil), PersistentVolumeClaim:(*v1.PersistentVolumeClaimVolumeSource)(nil), RBD:(*v1.RBDVolumeSource)(nil), FlexVolume:(*v1.FlexVolumeSource)(nil), Cinder:(*v1.CinderVolumeSource)(nil), CephFS:(*v1.CephFSVolumeSource)(nil), Flocker:(*v1.FlockerVolumeSource)(nil), DownwardAPI:(*v1.DownwardAPIVolumeSource)(nil), FC:(*v1.FCVolumeSource)(nil), AzureFile:(*v1.AzureFileVolumeSource)(nil), ConfigMap:(*v1.ConfigMapVolumeSource)(0xc0008fbd80), VsphereVolume:(*v1.VsphereVirtualDiskVolumeSource)(nil), Quobyte:(*v1.QuobyteVolumeSource)(nil), AzureDisk:(*v1.AzureDiskVolumeSource)(nil), PhotonPersistentDisk:(*v1.PhotonPersistentDiskVolumeSource)(nil), Projected:(*v1.ProjectedVolumeSource)(nil), PortworxVolume:(*v1.PortworxVolumeSource)(nil), ScaleIO:(*v1.ScaleIOVolumeSource)(nil), StorageOS:(*v1.StorageOSVolumeSource)(nil), CSI:(*v1.CSIVolumeSource)(nil), Ephemeral:(*v1.EphemeralVolumeSource)(nil)}}}, InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}, v1.VolumeMount{Name:"external-config", ReadOnly:false, MountPath:"/etc/redis/external.conf.d", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc000672300), ReadinessProbe:(*v1.Probe)(0xc000672240), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(0xc00153db30), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000740530), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.680311764285968e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117642901666e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803117642902207e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680311764294282e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680311764375293e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803117643753386e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "0"}
1.6803117643806772e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.680311764381238e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311763000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311761000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave,fail e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 1680311739832 1680311737825 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311763924 3 connected 10923-16383\n"}
1.6803117643813264e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803117644698417e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803117644710426e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "777d27d114771e26aa94d8cb23b589870b5a1e4e 10.244.2.4:6379@16379 master - 0 1680311763000 2 connected 5461-10922\nd517ff4582a47af20ce6ace0758e769ae67ea2a4 10.244.1.9:6379@16379 slave,fail 15627911390c3dd79954fdb1f46334a9002336af 1680311675558 1680311673000 3 connected\ne5afbcbf3603f6102d6fb9916a62a7fdf501df2b 10.244.3.5:6379@16379 myself,master - 0 1680311761000 1 connected 0-5460\n1858710e65dee7ef204a795c97d39b2e534ed2e4 10.244.2.5:6379@16379 slave,fail 777d27d114771e26aa94d8cb23b589870b5a1e4e 1680311707702 1680311706598 2 connected\n72e85f014fd562a4ea193be602da31c1c2b6f6b7 10.244.3.6:6379@16379 slave,fail e5afbcbf3603f6102d6fb9916a62a7fdf501df2b 1680311739832 1680311737825 1 connected\n15627911390c3dd79954fdb1f46334a9002336af 10.244.1.8:6379@16379 master - 0 1680311763924 3 connected 10923-16383\n"}
1.68031176447114e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803117644711556e+09	INFO	controllers.RedisCluster	no follower/replicas configured, skipping replication configuration	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Leader.Size": 3, "Follower.Replicas": 0}
1.6803117644711723e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}

