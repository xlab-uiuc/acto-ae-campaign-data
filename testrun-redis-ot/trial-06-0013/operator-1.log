MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803090147273636e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-leader"},{"name":"redis-exporter"},{"name":"ACTOKEY"}],"containers":[{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgT/i9zli0rjvOhW99Y7yJAkxpytnsoAmNEjSuiFMmSQ20NQ/99QfkjTpBNc9jDdk8Sh88MZ55nONwCWvmZnJdGQw5orU+7DBL4JnUNOSwZmdZBLYkhgZYYa2SEfAuotWFkabSPS0e19GNjPTsihZUfyxiQXSBIXt31jFpQxJDnkVDBMznoE1BYkRqCorUv9keKsCZ3CLnyxMGueGNjoEOMBJxR0bAH9wlobF8e9RQqbnqLQzJD2JGx5JBN3DR/anIlrcmRFuQh//KCs11tr1WYdllFjJFOYTQ7oxQ5yCMnR4LL6HdzTPyVPCGBICP0cnp+VdeTakQX0+vR+frscnS9vsZRVp3V53Q1vZpVNfSPfQLektiJYpUU6CGfJuBJkYg15VtokUXz8R/nOR5NrpOC7t/im6m1CpmGTH7RljphOWqLUpPbNQfpbvjupVwU5fJ2+VDc3xSr4v7D/z4Wc0igQxXoUEyfHNFlMb9drj7M5+UJaMgrT1NlBKrGeM4vppfXp27LovxclKu7T/PixO+JgBPgw++Lv8U9JiBb/Bpt3wNuxtKke4LTXQ7dxfhsPIM9bBGUWhglxQZyuF3fG1448qTjqFCyI03eL5ypBqHpx4GttsXY+l+gQt9AAmnwLq2kThtCxY1oSHwb+wZiJ69RquDooXHkG6NqyGcJSC1ZopqTws2ShNG1hzybJWDJSVM/M7FsyQQ+2mY/GwaOsJb/1swdeRPcMIa2oGQrefgTNkAO2SRrhyHdGhcVyc6u7iQMXt8D+XdA+wQ6o0JLdyZo3rVzG38XyA3kkA439U0C4/z5T9+BEf2wxjG5PBtP3nMT9qc+d4afajl5v5avQvv+MeoZbI1MS3bI9HUD+fao8Y1C2T7sR/Fe6190GL/dkU+TGoUg7+9MPdQLJWH9h5NMn2Kijy8kOWXas3G7nsh+e35P6mj8v1TkN56pHU5j5BDd+t1jfFgCdigVVorK47s8SU4e6Unf/xUAAP//UEsHCBKmW2/yAgAAkAkAAFBLAQIUABQACAAIAAAAAAASpltv8gIAAJAJAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAAoAwAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1404","uid":"d4b4b8e7-ae0c-47b6-85ac-62fce06b472e"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1404"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680309014775419e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-leader\"},{\"name\":\"redis-exporter\"},{\"name\":\"ACTOKEY\"}],\"containers\":[{\"env\":[{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\",\"valueFrom\":{\"configMapKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"optional\":false},\"fieldRef\":{\"apiVersion\":\"ACTOKEY\",\"fieldPath\":\"ACTOKEY\"},\"resourceFieldRef\":{\"containerName\":\"ACTOKEY\",\"divisor\":\"124768317440n\",\"resource\":\"ACTOKEY\"},\"secretKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"optional\":false}}},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\",\"valueFrom\":{\"configMapKeyRef\":{\"key\":\"ACTOKEY\",\"optional\":true},\"fieldRef\":{\"apiVersion\":\"ACTOKEY\",\"fieldPath\":\"ACTOKEY\"},\"resourceFieldRef\":{\"containerName\":\"ACTOKEY\",\"divisor\":\"29332\",\"resource\":\"ACTOKEY\"},\"secretKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"optional\":true}}},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"}],\"image\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"resources\":{}}]}}}}"}
MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-leader", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1404", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 27, 54, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-leader", "redis_setup_type":"cluster", "role":"leader"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd", Controller:(*bool)(0xc000c32bf8), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 27, 54, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc0004bee58), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 28, 29, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc0004bee88), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000c32bf4), Selector:(*v1.LabelSelector)(0xc000e227c0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-leader", "redis_setup_type":"cluster", "role":"leader"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-leader", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-leader", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc00089aec0), ReadinessProbe:(*v1.Probe)(0xc00089ae80), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"ACTOKEY", Image:"ACTOKEY", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(0xc000a22a60)}, v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(0xc000a22aa0)}, v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList(nil)}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-leader", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-leader", "redis_setup_type":"cluster", "role":"leader"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc00025ff80), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-leader", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803090150766547e+09	INFO	KubeAPIWarningLogger	spec.template.spec.containers[2].env[1].name: duplicate name "ACTOKEY"
1.6803090150767465e+09	INFO	KubeAPIWarningLogger	spec.template.spec.containers[2].env[2].name: duplicate name "ACTOKEY"
1.6803090150773273e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803090150804935e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680309015082663e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803090151733427e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803090151756647e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803090151782007e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803090151782389e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680309015181721e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"},{"name":"ACTOKEY"}],"containers":[{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zgM/l/47MRx0/SH33aN71Bg7QKnt3sYioCWmVmYLGkS5S0I/L8f5PxYWvSufTngtqfE1EeK/D6S2gJa+ZGcl0ZDDmitT7sMEvgidQ05LBmZ1kEtiSGBlhhrZIR8C6i1YWRptI+fjmrpx8Z6dkQKKz+WMSC7QJC8eOoZtaCIIc8joYJnctAnoLAiNQRFa5+dj9ZGKfON3CHoyhMHu+KNjaEOURJwRkXDEd4noLF9ft1puHjsLQ4pDaFHxpJDNvHQfNPkSlqTIy3IQ/7pGXO7Cl+qM+2yihgjqcJodkYpcpBHZo40l9Hv5pj8C5lCAkFG6OX0/KquJ9WILqbXo/P12eXoen2No6w6q8/pano1q2roH/sEvCWxk8YqKdBDPk3AkyIRa8q30CKL5v1/wna8nlwnBd3/O+tMrVXINOTzE7fXCd9RZZSa3K5NSHfD717URVEub5cPxf1NsSru3/32vphDAh2qQIeC+uSILov57XL1bj4vT0BDZnmaKiNQNcZzfjG9vD51Wxblx6Jc3X2YFyd+P0g4AT78ufhH3GMCssXP0fY14GYsTbonOd3l0F2Mz8Yz2MMWQamFUVJsIIfb9b3hhSNPOq4OJTvS5P3CmWoQm74f2GpbjEPwCSr0DSSQBu/SSuq0IVTciIbEl7FvIPb0GqUKjh4aR74xqoZ8loDUkiWqOSncLEkYXXvIs1kClpw09RMTy5ZM4KNt9vpicIS1/L/m7sib4IaVtAUlW8nDP2ED5JBNsnZY261xUZPs7OpOwuD1NZB/A7RPoDMqtHRnguZdQ7fx7wK5gRzSYV5foTBuo196Dkb03RrH5PJsPHnLNOxvfeoMr6o5ebuaL0L7/jEqGmyNTEt2yPR5A/n2qPKNQtk+7FfyXu2feCm/1pc/djYKQd7fmXqoGkrC+i8nmT7EdB+fCXPKt2fjdp2R/fF0Xupo/F0q8hvP1A63MXKIbv3ugT58AnYoFVaKyuNbPUlOHu5J3/8dAAD//1BLBwj21gtp8wIAAKoJAABQSwECFAAUAAgACAAAAAAA9tYLafMCAACqCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAKQMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1396","uid":"d2ac6601-0f84-4443-978a-548184e2ff70"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1396"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680309015277111e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"},{\"name\":\"ACTOKEY\"}],\"containers\":[{\"env\":[{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\",\"valueFrom\":{\"configMapKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"optional\":false},\"fieldRef\":{\"apiVersion\":\"ACTOKEY\",\"fieldPath\":\"ACTOKEY\"},\"resourceFieldRef\":{\"containerName\":\"ACTOKEY\",\"divisor\":\"124768317440n\",\"resource\":\"ACTOKEY\"},\"secretKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"optional\":false}}},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\",\"valueFrom\":{\"configMapKeyRef\":{\"key\":\"ACTOKEY\",\"optional\":true},\"fieldRef\":{\"apiVersion\":\"ACTOKEY\",\"fieldPath\":\"ACTOKEY\"},\"resourceFieldRef\":{\"containerName\":\"ACTOKEY\",\"divisor\":\"29332\",\"resource\":\"ACTOKEY\"},\"secretKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"optional\":true}}},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"}],\"image\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"resources\":{}}]}}}}"}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1396", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 27, 54, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFlz2zYQ/i/7TN3yxbfUVtxMYkcjKe40tscDkUsLYxBgAFCJquF/7wC8QEpOnKROmk7fxMUewLeL3Q/aAknoFUpFBQcfSJKo3noAHjxQHoIPc000RimbowYPYtQkJJqAvwXCudBEU8GV+ZQYUtUVidISkZGl6lLjUMsUwdu7qjThARodVLoTsFRplJB5EEi0fhc0RqVJnIAPw/5w1OmPO/3Bot/3h0f+wfg9eMDIEpmNT5Kk5aoTCcbER5Rl/DuFOk3u9CYxUcuAHkjBjKBSzzyICSf3GL6kyEIF/vWjMEVWY5G7zNWvavnVwGwt8l3cIr+FXBf8beZB5C8J/4vQgIk07AYi7jGidIckCaMYljr7YX58rQR5m1mVGq8qqgXOcdBAqZBbgAoX4iNHOcMIJfIAXV8P/vYGUhregH8DR6PxcRj2lx08HJ10xtHwqHMSnZDOYDkMx3g8Oj5YhjeQWbfWr0owyPFJRHhh8Y+R66lgNNjUO0wYDYiqv9fU5OR3qrSQmzc0prpcU8gw0ELW33JNA7wkcXUwjXHCiMavydLPzUALqkBwTShHaT3aBHASo82A9dXBT4mQGmWOdR0U+bqduspyOpnNX80Xk8vTyd3k8sVvbyZnbXPuoLgmLC0P2HQ0m5y9mt+9ODubfZv9fDK7mszuLt6eTb7VweLd9Cvs7SeNyX21Zj+mKWPNQnTNJSqRyuZdiHxmarEpCpK0/BljLOSmqgqJH1JUT1IvClfGlNvqvEClzBaJXtVlvbNabX4Hor0t8/9qeYr9k6uF0TVyVGoqxRKbwH7Kr3KddBHHhIdVZUSEslTiYiVRrQSrBgHlVFPCzpCRzRwDwcOqKSYoqQhbQpUGASq140fTGEWqHe099U1C+mtt/5e6kraoBEtjvBAp1zsjNTZS48wWac+MqHZ9VirQKtis2F3IVXuSKk1ka7yqYIVhylC6Q1JhkEqqN6eCa/yk95zoXJIAp+205YHTJCQa51oSjfebfGpJwRjl9+/sUuMcCZGaakuyijSUU9BB6ZQRGi+K0V2FyimbBB/ORWelddIJGEVuaKtIUJLcKxRBPTCV8xixzLzvJHxKE52qgkisCWVkyXDWIi+BgcEEODXZq6SplMj1jnIpzglPKRZLQ2swPEdenbG+tZu2lzZ/yrPTdppLQ9e4ifBDusSO4R4mkyg75cojUKt0WV5I8KHA5rEMHPvDk/eQ3XqQ1/CjnN4sq4RYnznXyYMLu482S21T+Jyq7SNsvfVgiZqYpNZHBN+8ZKpn0czYnVYviD07Bc9QYfCfRITtcUuI6j0ORieH5jVS8r06eyMPHHoLMdHB6s2zvIVMeJc4P+rW5dI/5p34PI8/B2+XXV9vwZKg622Z7T28Bzwo2EF+INNHCu2a3DhKdmd+r8dEQNhKKO0fjo5OXDOH0zh2NQiOYsld9undelDwFPiQkk2Xil4Bci/fw/qwO+weQKHmMhh4FV0KPZWo8ma6w2VKDlCN/mtYErUCD3qpkr0l5b0VEqZXwQqDh65awa3pMjvE4MCDvaxgcOBBixMYUXvyH2Rf7Bi7ROZftPcGZamZimUcMOgPYvv/S845YDA8vqBgrWqW8lnVzIMmx7jegsMaclqxv5XVEGa3puL+w/egei77g27/KbehiNo0hi9ms//0bO5Vzfbk4cXp4u3ryZ/OsVuSl1LERVuL6P0FSV7jZoaRET3gpqG/41IkpoMTBn5EmMKsIDyFeWOy1kZWpaivUupU+kvHQ9VqL9uRQ7qmyow5GAzHR4fHo8HReNznDsZN7woDifo7jpY51fRPYlrHMXfipyA4PBmNhs+BnD3R04Bz7+BnfLsXKMtuTf/aeUpUPa39ImiTPfcf7amRKo1cX9W2P+y/7efhLF9q2zWlIfYZfSFCCxPMkIR/SKrxrdnubatvue1IaSHzpA3Om+MkRPsSYqg2SmNso1XPn2RFlB0SyEPK78Gk0l3f8zjqew7R7WfZ3wEAAP//UEsHCA/0zR7aBQAAoxgAAFBLAQIUABQACAAIAAAAAAAP9M0e2gUAAKMYAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAAQBgAAAAA=", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd", Controller:(*bool)(0xc0005992e4), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 27, 54, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc0009ea168), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 28, 29, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc0009ea198), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc0005992e0), Selector:(*v1.LabelSelector)(0xc0000280e0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc000c80580), ReadinessProbe:(*v1.Probe)(0xc000c80500), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"ACTOKEY", Image:"ACTOKEY", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(0xc000a22a60)}, v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(0xc000a22aa0)}, v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList(nil)}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000416410), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803090156711087e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803090156745648e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803090156759813e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803090156795273e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680309015770912e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680309015776573e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803090157766268e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803090157824044e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803090157855222e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803090157855537e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.680309015871834e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803090158734274e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379@16379 myself,master - 0 0 0 connected\n"}
1.6803090158734756e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "1"}
1.6803090158798378e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803090158803895e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379@16379 myself,master - 0 0 0 connected\n"}
1.6803090158804846e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "1", "Type": "leader"}
1.680309015880504e+09	INFO	controllers.RedisCluster	Not all leader are part of the cluster...	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 1, "Instance.Size": 3}
1.6803090158861384e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803090159733846e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-1", "ip": "10.244.2.6"}
1.6803090159773152e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-2", "ip": "10.244.1.9"}
1.6803090159773457e+09	INFO	controller_redis	Redis cluster creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "create", "10.244.3.5:6379", "10.244.2.6:6379", "10.244.1.9:6379", "--cluster-yes"]}
1.6803090159816005e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.6803090181889997e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "create", "10.244.3.5:6379", "10.244.2.6:6379", "10.244.1.9:6379", "--cluster-yes"], "Output": ">>> Performing hash slots allocation on 3 nodes...\nMaster[0] -> Slots 0 - 5460\nMaster[1] -> Slots 5461 - 10922\nMaster[2] -> Slots 10923 - 16383\nM: 8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379\n   slots:[0-5460] (5461 slots) master\nM: ca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\nM: e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379\n   slots:[10923-16383] (5461 slots) master\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n.\n>>> Performing Cluster Check (using node 10.244.3.5:6379)\nM: 8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379\n   slots:[0-5460] (5461 slots) master\nM: e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379\n   slots:[10923-16383] (5461 slots) master\nM: ca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n"}
1.680309018189106e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803090207722838e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680309020777786e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
1.6803090207822192e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1496","uid":"d4b4b8e7-ae0c-47b6-85ac-62fce06b472e"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1496"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1404"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680309020785377e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803090207880216e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803090207916741e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.680309020794382e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680309020873519e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803090208735561e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803090208766537e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1510","uid":"d2ac6601-0f84-4443-978a-548184e2ff70"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803090209713168e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1510"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1396"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803090209756072e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803090209771886e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680309020979979e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803090211703532e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680309021174184e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680309021174219e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803090211777666e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803090211815317e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803090211815653e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803090211850586e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803090212698777e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379@16379 master - 0 1680309020305 3 connected 10923-16383\n8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379@16379 myself,master - 0 1680309017000 1 connected 0-5460\nca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379@16379 master - 0 1680309020000 2 connected 5461-10922\n"}
1.6803090212699668e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3"}
1.6803090212746716e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803090213696148e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379@16379 master - 0 1680309020305 3 connected 10923-16383\n8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379@16379 myself,master - 0 1680309017000 1 connected 0-5460\nca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379@16379 master - 0 1680309020000 2 connected 5461-10922\n"}
1.6803090213697093e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803090213697214e+09	INFO	controllers.RedisCluster	All leader are part of the cluster, adding follower/replicas	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Instance.Size": 3, "Follower.Replicas": 3}
1.6803090213777168e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803090213785431e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379@16379 master - 0 1680309021309 3 connected 10923-16383\n8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379@16379 myself,master - 0 1680309021000 1 connected 0-5460\nca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379@16379 master - 0 1680309020000 2 connected 5461-10922\n"}
1.6803090213824344e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-0", "ip": "10.244.3.4"}
1.6803090213824756e+09	INFO	controller_redis	Checking if Node is in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node": "10.244.3.4"}
1.6803090213824918e+09	INFO	controller_redis	Adding node to cluster.	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node.IP": "10.244.3.4", "Follower.Pod": {"PodName":"test-cluster-follower-0","Namespace":"redis-operator"}}
1.680309021386025e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-0", "ip": "10.244.3.4"}
1.680309021470744e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803090214708004e+09	INFO	controller_redis	Redis replication creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.3.4:6379", "10.244.3.5:6379", "--cluster-slave"]}
1.6803090214763057e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.6803090226798751e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.3.4:6379", "10.244.3.5:6379", "--cluster-slave"], "Output": ">>> Adding node 10.244.3.4:6379 to cluster 10.244.3.5:6379\n>>> Performing Cluster Check (using node 10.244.3.5:6379)\nM: 8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379\n   slots:[0-5460] (5461 slots) master\nM: e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379\n   slots:[10923-16383] (5461 slots) master\nM: ca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nAutomatically selected master 10.244.3.5:6379\n>>> Send CLUSTER MEET to node 10.244.3.4:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 10.244.3.5:6379.\n[OK] New node added correctly.\n"}
1.6803090226864102e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-1", "ip": "10.244.2.5"}
1.6803090226865742e+09	INFO	controller_redis	Checking if Node is in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node": "10.244.2.5"}
1.680309022686603e+09	INFO	controller_redis	Adding node to cluster.	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node.IP": "10.244.2.5", "Follower.Pod": {"PodName":"test-cluster-follower-1","Namespace":"redis-operator"}}
1.680309022873905e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-1", "ip": "10.244.2.5"}
1.6803090228772502e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-1", "ip": "10.244.2.6"}
1.6803090228772793e+09	INFO	controller_redis	Redis replication creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.2.5:6379", "10.244.2.6:6379", "--cluster-slave"]}
1.6803090229710636e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.6803090240994747e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.2.5:6379", "10.244.2.6:6379", "--cluster-slave"], "Output": ">>> Adding node 10.244.2.5:6379 to cluster 10.244.2.6:6379\n>>> Performing Cluster Check (using node 10.244.2.6:6379)\nM: ca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\nM: e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379\n   slots:[10923-16383] (5461 slots) master\nM: 8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: c63f0e2c8a98c027590219bb2c00ab5f51ec8d23 10.244.3.4:6379\n   slots: (0 slots) slave\n   replicates 8e88c396205e27100a44a5184b74bda68d841a2d\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nAutomatically selected master 10.244.2.6:6379\n>>> Send CLUSTER MEET to node 10.244.2.5:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 10.244.2.6:6379.\n[OK] New node added correctly.\n"}
1.6803090241038744e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-2", "ip": "10.244.1.8"}
1.6803090241039186e+09	INFO	controller_redis	Checking if Node is in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node": "10.244.1.8"}
1.6803090241039283e+09	INFO	controller_redis	Adding node to cluster.	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node.IP": "10.244.1.8", "Follower.Pod": {"PodName":"test-cluster-follower-2","Namespace":"redis-operator"}}
1.680309024107502e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-2", "ip": "10.244.1.8"}
1.6803090241105943e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-2", "ip": "10.244.1.9"}
1.6803090241106274e+09	INFO	controller_redis	Redis replication creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.1.8:6379", "10.244.1.9:6379", "--cluster-slave"]}
1.6803090241139636e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.680309025380113e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.1.8:6379", "10.244.1.9:6379", "--cluster-slave"], "Output": ">>> Adding node 10.244.1.8:6379 to cluster 10.244.1.9:6379\n>>> Performing Cluster Check (using node 10.244.1.9:6379)\nM: e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379\n   slots:[10923-16383] (5461 slots) master\nM: 8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: c63f0e2c8a98c027590219bb2c00ab5f51ec8d23 10.244.3.4:6379\n   slots: (0 slots) slave\n   replicates 8e88c396205e27100a44a5184b74bda68d841a2d\nM: ca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nAutomatically selected master 10.244.1.9:6379\n>>> Send CLUSTER MEET to node 10.244.1.8:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 10.244.1.9:6379.\n[OK] New node added correctly.\n"}
1.6803090253802328e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.680309035380561e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680309035390251e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1496","uid":"d4b4b8e7-ae0c-47b6-85ac-62fce06b472e"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1496"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803090353972218e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1404"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803090354024944e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803090354713771e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803090354760137e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803090354795225e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803090354830997e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803090354831364e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803090355710037e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1510","uid":"d2ac6601-0f84-4443-978a-548184e2ff70"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680309035872509e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1510"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1396"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803090358802714e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680309035881609e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803090358847904e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680309035969923e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803090360702033e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803090360702598e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803090360743456e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680309036078139e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680309036078169e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.680309036175528e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803090361761882e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379@16379 master - 0 1680309034365 3 connected 10923-16383\n578b7c7996d739269e3257c0590a801bdcf111d0 10.244.2.5:6379@16379 slave ca40f7e003c492d57ae0a1ca8b9c89b871a6432a 0 1680309034000 2 connected\n541d2d6f6b344fde776dae74e520a3d6324b18d1 10.244.1.8:6379@16379 slave e38103f0a8a39d56dab0f49b5e64f26b48b86e98 0 1680309034000 3 connected\nca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379@16379 master - 0 1680309034566 2 connected 5461-10922\nc63f0e2c8a98c027590219bb2c00ab5f51ec8d23 10.244.3.4:6379@16379 slave 8e88c396205e27100a44a5184b74bda68d841a2d 0 1680309035370 1 connected\n8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379@16379 myself,master - 0 1680309035000 1 connected 0-5460\n"}
1.6803090361762288e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803090361762376e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803090361803617e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803090361808736e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "e38103f0a8a39d56dab0f49b5e64f26b48b86e98 10.244.1.9:6379@16379 master - 0 1680309034365 3 connected 10923-16383\n578b7c7996d739269e3257c0590a801bdcf111d0 10.244.2.5:6379@16379 slave ca40f7e003c492d57ae0a1ca8b9c89b871a6432a 0 1680309034000 2 connected\n541d2d6f6b344fde776dae74e520a3d6324b18d1 10.244.1.8:6379@16379 slave e38103f0a8a39d56dab0f49b5e64f26b48b86e98 0 1680309034000 3 connected\nca40f7e003c492d57ae0a1ca8b9c89b871a6432a 10.244.2.6:6379@16379 master - 0 1680309034566 2 connected 5461-10922\nc63f0e2c8a98c027590219bb2c00ab5f51ec8d23 10.244.3.4:6379@16379 slave 8e88c396205e27100a44a5184b74bda68d841a2d 0 1680309035370 1 connected\n8e88c396205e27100a44a5184b74bda68d841a2d 10.244.3.5:6379@16379 myself,master - 0 1680309035000 1 connected 0-5460\n"}
1.680309036180903e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 0}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
1.6803091561815686e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: CreateOrUpdateStateFul
1.6803091561870935e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1595","uid":"d4b4b8e7-ae0c-47b6-85ac-62fce06b472e"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803091561915002e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1595"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1404"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803091561943946e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803091561956284e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803091561983726e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803091564705486e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803091565752857e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803091565753477e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803091565803423e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803091565863302e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1617","uid":"d2ac6601-0f84-4443-978a-548184e2ff70"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1617"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1396"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803091566741107e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803091566775532e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680309156681423e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803091567717955e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803091567768402e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.68030915677688e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803091567817824e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803091568743854e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803091568744318e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
1.6803092768749688e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803092768873613e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
1.6803092768936718e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1595","uid":"d4b4b8e7-ae0c-47b6-85ac-62fce06b472e"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1595"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1404"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803092769701097e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803092769738016e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803092769785314e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.680309276979861e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803092769829888e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803092769830241e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803092769869735e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803092774705076e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1617","uid":"d2ac6601-0f84-4443-978a-548184e2ff70"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1617"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1396"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803092774769304e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803092775703528e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680309277576181e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803092775788684e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803092775820708e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803092775821166e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680309277585646e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803092776705647e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680309277670617e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}
1.6803093976717794e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803093976775408e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFtv2zoS/i/zLN+dm966iZst2qSG7WaxTYKAlsYxEYpUScpbr6H/fkDqRslK67Y57enBebOGcyG/Gc589A5ITG9QKio4+EDiWPU2A/DgifIQfJhronGVsDlq8CBCTUKiCfg7IJwLTTQVXJlPiSFVXRErLREZWaouNQ61TBC81lWlCQ/Q6KDSnYAlSqOE1INAovW7oBEqTaIYfBj2h6NOf9zpDxb9vj888Y/GH8EDRpbIbHwSxw1XHYYkRFlEf1Cok/hBb2MTswjngRTMCHLl1IOIcPKI4WuKLFTg3z4L0cpqLDKHmfpNJb8ZmG2tfBezld9ArQv+LvVg5S8J/z+hARNJ2A1E1GNE6Q6JY0YxLHTaIX5+rQB4l1qVCqsyqgXNcVDDKJdbeHIX4n8c5QxXKJEH6Pp68nd3kNDwDvw7OBmNT8Owv+zg8eisM14NTzpnqzPSGSyH4RhPR6dHy/AOUuvW+lUxBhk+sQivLP4Rcj0VjAbbaocxowFR1feGmpz8myot5PYdjagu1hQyDLSQ1bfc0ACvSVQeTGMUM6LxW7L0azPQgCoQXBPKUVqPNgGcRGgzYH118HMspEaZYV0FRb5ppq60nE5m8zfzxeT6fPIwuX71r3eTi6Y5d1DcEJYUB6w7mk0u3swfXl1czL7Pfj6Z3UxmD1fvLybf62DxYfoN9vaTRuSxXLMf04SxeiG65hKVSGT9Lqx8ZmqxLgripPgZYSTktqwKiZ8SVAep54UrI8ptdV6hUmaLRK+rst5bLTe/B1FLu/ynVg6xP7hWGN0gR6WmUiyxDuzn7CJXKRdRRHhY1sWKUJZIXKwlqrVg5RignGpK2AUysp1jIHhYtsQYJRVhQ6iSIECl9vxoGqFItKPdUt0kpL/X9n+rC2mLSrAkwiuRcL03UCMjNc5skfbMgGrWZ6kCjYJN892FXDXnqNJENoarCtYYJgylOyIVBomkensuuMbPuuVEl5IEOG2mLQucxCHRONeSaHzcZjNLCsYof/xgl2rniInUVFuKlaehmIEOSueM0GiRD+4yVEbYJPhwKTprreNOwChyQ1hFjJJkXiEP6oGpnOcoZer9IN1TmuhE5TRiQygjS4azBnUJDAwmwLnJXilNpESu95QLcUZ3CrFYGlKD4SXy8ozVrd02vTTZU5adptNMGrrGdYSfkiV2DPMwmUTZKVaegVoly+JCgg85Ns9l4NQfnn2E9N6DrIafYfNmUcXEesx4ThZa2F00GWqTvmc0rY2s9TaDJWpiUlodEHzzgimfQzNjd16+HVr2CZ6hweAfRILtYQuAqj0Oxv2xeYkUXK/K3cgDh9pCRHSwfvfibyAT2iXMz7h0GfTPeRm+/HPPQdnl07c7sMTndlfkuIXrgAc5I8gOY3pHrl0RGkfJ7svv9ZgICFsLpf3j0cmZa+bwGMeuAsBRLPhKm969Bzk3gU8J2Xap6OUA97I9bI67w+4R5Goua4E3q2uhpxJV1kD3+Esx98txfwtLotbgQS9RsrekvLdGwvQ6WGPw1FVruDedZY8MHHnQygQGRx40eIARNaf9UfqVLrFPXf5CO6+RlIqbWI4Bg/4gsv+1ZCwDBsPTKwrWquIlX1RNPaizitsdODwhIxLt7asAML031fY3vgPl49gfdPuH3IQ8at0YvprL/uG5bFVNW/Lw6nzx/u3kv86xG5LXUkR5S1vRxysSv8XtDFdG9ITbmv6eSxGbzk0Y+CvCFKY5wcnNa7O0MrIqeXUVUqfOXzseyjZ73Ywc0g1VZrDBYDg+OT4dDU7G4z53MK57VxhI1D9wtNSpppfEtIpj7sQvQXB4NhoN/wzk7IkOA869g1/w7V6gNL033Wvv6VB2tOYLoEnv3P+up0aqNHJ9U9n+tH+xX56rfLlhV0SG2AfzlQgtQDBDEv5HUo3vzUbvGx3LbURKC5mla3BZHyMh2jcPQ7VVGiMbrXzoxGui7HhAHlL+CCaJ7nrLM6jvOaS2n6Z/BAAA//9QSwcIjA0eXdkFAACHGAAAUEsBAhQAFAAIAAgAAAAAAIwNHl3ZBQAAhxgAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAAA8GAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1595","uid":"d4b4b8e7-ae0c-47b6-85ac-62fce06b472e"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803093976821597e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1595"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1404"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803093976856375e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803093977718608e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803093977766414e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.680309397780605e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803093979743478e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803093979743848e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803093979770625e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzsWFlz2zYQ/i/7TN3yxbfUVtxMYkcjKe40tscDkUsLYxBgAFCJquF/7wC8QEpOnKROmk7fxMUewLeL3Q/aAknoFUpFBQcfSJKo3noAHjxQHoIPc000RimbowYPYtQkJJqAvwXCudBEU8GV+ZQYUtUVidISkZGl6lLjUMsUwdu7qjThARodVLoTsFRplJB5EEi0fhc0RqVJnIAPw/5w1OmPO/3Bot/3h0f+wfg9eMDIEpmNT5Kk5aoTCcbER5Rl/DuFOk3u9CYxUcuAHkjBjKBSzzyICSf3GL6kyEIF/vWjMEVWY5G7zNWvavnVwGwt8l3cIr+FXBf8beZB5C8J/4vQgIk07AYi7jGidIckCaMYljr7YX58rQR5m1mVGq8qqgXOcdBAqZBbgAoX4iNHOcMIJfIAXV8P/vYGUhregH8DR6PxcRj2lx08HJ10xtHwqHMSnZDOYDkMx3g8Oj5YhjeQWbfWr0owyPFJRHhh8Y+R66lgNNjUO0wYDYiqv9fU5OR3qrSQmzc0prpcU8gw0ELW33JNA7wkcXUwjXHCiMavydLPzUALqkBwTShHaT3aBHASo82A9dXBT4mQGmWOdR0U+bqduspyOpnNX80Xk8vTyd3k8sVvbyZnbXPuoLgmLC0P2HQ0m5y9mt+9ODubfZv9fDK7mszuLt6eTb7VweLd9Cvs7SeNyX21Zj+mKWPNQnTNJSqRyuZdiHxmarEpCpK0/BljLOSmqgqJH1JUT1IvClfGlNvqvEClzBaJXtVlvbNabX4Hor0t8/9qeYr9k6uF0TVyVGoqxRKbwH7Kr3KddBHHhIdVZUSEslTiYiVRrQSrBgHlVFPCzpCRzRwDwcOqKSYoqQhbQpUGASq140fTGEWqHe099U1C+mtt/5e6kraoBEtjvBAp1zsjNTZS48wWac+MqHZ9VirQKtis2F3IVXuSKk1ka7yqYIVhylC6Q1JhkEqqN6eCa/yk95zoXJIAp+205YHTJCQa51oSjfebfGpJwRjl9+/sUuMcCZGaakuyijSUU9BB6ZQRGi+K0V2FyimbBB/ORWelddIJGEVuaKtIUJLcKxRBPTCV8xixzLzvJHxKE52qgkisCWVkyXDWIi+BgcEEODXZq6SplMj1jnIpzglPKRZLQ2swPEdenbG+tZu2lzZ/yrPTdppLQ9e4ifBDusSO4R4mkyg75cojUKt0WV5I8KHA5rEMHPvDk/eQ3XqQ1/CjnN4sq4RYnznXyYMLu482S21T+Jyq7SNsvfVgiZqYpNZHBN+8ZKpn0czYnVYviD07Bc9QYfCfRITtcUuI6j0ORieH5jVS8r06eyMPHHoLMdHB6s2zvIVMeJc4P+rW5dI/5p34PI8/B2+XXV9vwZKg622Z7T28Bzwo2EF+INNHCu2a3DhKdmd+r8dEQNhKKO0fjo5OXDOH0zh2NQiOYsld9undelDwFPiQkk2Xil4Bci/fw/qwO+weQKHmMhh4FV0KPZWo8ma6w2VKDlCN/mtYErUCD3qpkr0l5b0VEqZXwQqDh65awa3pMjvE4MCDvaxgcOBBixMYUXvyH2Rf7Bi7ROZftPcGZamZimUcMOgPYvv/S845YDA8vqBgrWqW8lnVzIMmx7jegsMaclqxv5XVEGa3puL+w/egei77g27/KbehiNo0hi9ms//0bO5Vzfbk4cXp4u3ryZ/OsVuSl1LERVuL6P0FSV7jZoaRET3gpqG/41IkpoMTBn5EmMKsIDyFeWOy1kZWpaivUupU+kvHQ9VqL9uRQ7qmyow5GAzHR4fHo8HReNznDsZN7woDifo7jpY51fRPYlrHMXfipyA4PBmNhs+BnD3R04Bz7+BnfLsXKMtuTf/aeUpUPa39ImiTPfcf7amRKo1cX9W2P+y/7efhLF9q2zWlIfYZfSFCCxPMkIR/SKrxrdnubatvue1IaSHzpA3Om+MkRPsSYqg2SmNso1XPn2RFlB0SyEPK78Gk0l3f8zjqew7R7WfZ3wEAAP//UEsHCA/0zR7aBQAAoxgAAFBLAQIUABQACAAIAAAAAAAP9M0e2gUAAKMYAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAAQBgAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1617","uid":"d2ac6601-0f84-4443-978a-548184e2ff70"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680309398075362e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1617"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1396"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803093980815399e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803093981705837e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803093981744962e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803093981760187e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680309398178322e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680309398178345e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803093982735815e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803093982778654e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803093982778933e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}
1.6803095182783535e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803095182914732e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1595","uid":"d4b4b8e7-ae0c-47b6-85ac-62fce06b472e"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803095182949104e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1595"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1404"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680309518297341e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680309518298663e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803095183010979e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803095183045275e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803095183069317e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803095183069584e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
MATT IS HERE: patchStatefulSet
1.6803095184705114e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1617","uid":"d2ac6601-0f84-4443-978a-548184e2ff70"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803095184736574e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1617"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:27:54Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:27:54Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:28:29Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"7348dd0b-e639-4f27-9f9a-1b2d4e8385bd"}],"resourceVersion":"1396"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"124768317440n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"29332","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY"}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803095184765785e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680309518477709e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680309518570167e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803095185738864e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803095185796618e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803095185797088e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803095185838244e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803095186706595e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803095186708338e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}

