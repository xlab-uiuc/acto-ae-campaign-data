MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803099438557937e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-leader"},{"name":"redis-exporter"},{"name":"ACTOKEY"}],"containers":[{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}}}} 
1.6803099439774432e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-leader\"},{\"name\":\"redis-exporter\"},{\"name\":\"ACTOKEY\"}],\"containers\":[{\"env\":[{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\",\"valueFrom\":{\"configMapKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\"},\"fieldRef\":{\"fieldPath\":\"ACTOKEY\"},\"resourceFieldRef\":{\"containerName\":\"ACTOKEY\",\"divisor\":\"4\",\"resource\":\"ACTOKEY\"}}},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\",\"valueFrom\":{\"configMapKeyRef\":{\"key\":\"ACTOKEY\",\"optional\":false},\"fieldRef\":{\"apiVersion\":\"ACTOKEY\",\"fieldPath\":\"ACTOKEY\"},\"resourceFieldRef\":{\"containerName\":\"ACTOKEY\",\"divisor\":\"4\",\"resource\":\"ACTOKEY\"},\"secretKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"optional\":true}}}],\"image\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"resources\":{}}]}}}}"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zYQ/l/uWbYsZ05SvXWxNgRoUkPOuociME7UuSJKkSx51GoY+t8Hyj/iBF6ahz2se5J4/O54933H4xbQyk/kvDQackBrfdplkMBXqWvIYcnItA5qSQwJtMRYIyPkW0CtDSNLo31cOqqlHxvr2REprPxYxoDsAkFydtczakERQ55HQgXP5KBPQGFFagiK1r7YHynCmtwh5MoTB7vijY2BDjEScEZFwx7cJ6CxfXnUU6i46S0OyQxhR8aSQzZx0/ylyZW0JkdakIf88wvOdrWdqzDtsooYI53CaHZGKXKQR06OBJfR7+aY+Jk8IYEgI/SaLqrrNVWjenJ1OfpFTK9GVXY5Ha3FZH2RZTibzt5B/9gn4C2JnShWSYEe8osEPCkSsaZ8Cy2yaD786zzHo8l1UtD9a3wztVYh05DJT9pSJyxHbVFqcrvmIN0N372Ui6Jc3i4fivubYlXcv//1QzGHBDpUgQ7F9MkRXRbz2+Xq/XxenoCGvPI0VUagaozn/PLi6t2p27IoPxXl6u7jvDjxeyLgBPjwx+IfcY8JyBa/RNu3gJuxNOme4HSXQ3c5no5nsIctglILo6TYQA6363vDC0eedBwVSnakyfuFM9UgNH0/sNW2GFv/M1ToG0ggDd6lldRpQ6i4EQ2Jr2PfQOzkNUoVHD00jnxjVA35LAGpJUtUc1K4WZIwuvaQZ7MELDlp6mcmli2ZwEfb7EfDwBHW8r+auSNvghvG0BaUbCUPf8IGyCGbZO0wpFvjoiLZ9PpOwuD1LZB/A7RPoDMqtHRnguZdO7fxd4HcQA7pcFNfJTDOn//1HRjRd2sck8uz8eQtN2F/6nNn+KGWk7dreRba949Rz2BrZFqyQ6YvG8i3R41vFMr2YT+K91r/pMP49Y58mtQoBHl/Z+qhXigJ6z+dZPoYE318Ickp056N2/VE9vvze1JH429Skd94pnY4jZFDdOt3j/FhCdihVFgpKo/v8iQ5eaQnff93AAAA//9QSwcI92ehw/ECAACQCQAAUEsBAhQAFAAIAAgAAAAAAPdnocPxAgAAkAkAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAACcDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:58Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1400","uid":"028a474c-1e9c-47ca-a5c5-281ec31e5f0b"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:58Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-leader", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1400", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 43, 23, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-leader", "redis_setup_type":"cluster", "role":"leader"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"8e3b8feb-d076-4c27-b162-fc0f311a5259", Controller:(*bool)(0xc00081dacc), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 43, 23, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000826cc0), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 43, 58, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000826cf0), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc00081dac8), Selector:(*v1.LabelSelector)(0xc0006104c0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-leader", "redis_setup_type":"cluster", "role":"leader"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-leader", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-leader", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc0010a8fc0), ReadinessProbe:(*v1.Probe)(0xc0010a8f80), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"ACTOKEY", Image:"ACTOKEY", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(0xc0005464c0)}, v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(0xc000546500)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList(nil)}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-leader", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-leader", "redis_setup_type":"cluster", "role":"leader"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000f2adc0), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-leader", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803099440852506e+09	INFO	KubeAPIWarningLogger	spec.template.spec.containers[2].env[1].name: duplicate name "ACTOKEY"
1.6803099440856493e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803099441699584e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803099441715596e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803099441755805e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803099443713913e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803099443775363e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803099443775852e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803099443812108e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"},{"name":"ACTOKEY"}],"containers":[{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zYQ/l/uWbYsZ05SvXWxNgRoUkPOuociME7UuSJKkSx5VGsY+t8Hyj/qBNmclwHLnmwdvzvefd/dcQto5SdyXhoNOaC1Pu0ySOCr1DXksGRkWge1JIYEWmKskRHyLaDWhpGl0T5+OqqlHxvr2REprPxYxoDsAkHy4qln1IIihjyPhAqeyUGfgMKK1BAUrX12Plobpcx3coegK08c7Io3NoY6REnAGRUNR3ifgMb2+XWn4eKxtzikNIQeGUsO2cRD812TK2lNjrQgD/nnZ8ztKnypzrTLKmKMpAqj2RmlyEEemTnSXEa/m2PyL2QKCQQZodd0UV2vqRrVk6vL0S9iejWqssvpaC0m64ssw9l09g76xz4Bb0nspLFKCvSQXyTgSZGINeVbaJFF8+FfYTteT66Tgu7/mXWm1ipkGvJ5w+11wndUGaUmt2sT0t3wuxd1UZTL2+VDcX9TrIr7979+KOaQQIcq0KGgPjmiy2J+u1y9n8/LE9CQWZ6myghUjfGcX15cvTt1Wxblp6Jc3X2cFyd+P0k4AT78sfhb3GMCssUv0fYt4GYsTbonOd3l0F2Op+MZ7GGLoNTCKCk2kMPt+t7wwpEnHVeHkh1p8n7hTDWITT8ObLUtxiH4DBX6BhJIg3dpJXXaECpuREPi69g3EHt6jVIFRw+NI98YVUM+S0BqyRLVnBRuliSMrj3k2SwBS06a+omJZUsm8NE2O78YHGEt/6u5O/ImuGElbUHJVvLwT9gAOWSTrB3Wdmtc1CSbXt9JGLy+BfKvgPYJdEaFlu5M0Lxr6Db+XSA3kEM6zOsZCuM2+l/PwYh+WOOYXJ6NJ6+Zhv2tT53hrJqT16v5IrTvH6OiwdbItGSHTF82kG+PKt8olO3DfiXv1X7DS/lcX/7c2SgEeX9n6qFqKAnrP51k+hjTfXwmzCnfno3bdUb2+9N5qaPxN6nIbzxTO9zGyCG69bsH+vAJ2KFUWCkqj2/1JDl5uCd9/1cAAAD//1BLBwj9JD5y8wIAAKoJAABQSwECFAAUAAgACAAAAAAA/SQ+cvMCAACqCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAKQMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:59Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1394","uid":"9f442151-f086-47f8-9042-e2b51b9115ab"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803099444742007e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"},{\"name\":\"ACTOKEY\"}],\"containers\":[{\"env\":[{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\",\"valueFrom\":{\"configMapKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\"},\"fieldRef\":{\"fieldPath\":\"ACTOKEY\"},\"resourceFieldRef\":{\"containerName\":\"ACTOKEY\",\"divisor\":\"4\",\"resource\":\"ACTOKEY\"}}},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\",\"valueFrom\":{\"configMapKeyRef\":{\"key\":\"ACTOKEY\",\"optional\":false},\"fieldRef\":{\"apiVersion\":\"ACTOKEY\",\"fieldPath\":\"ACTOKEY\"},\"resourceFieldRef\":{\"containerName\":\"ACTOKEY\",\"divisor\":\"4\",\"resource\":\"ACTOKEY\"},\"secretKeyRef\":{\"key\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"optional\":true}}}],\"image\":\"ACTOKEY\",\"name\":\"ACTOKEY\",\"resources\":{}}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:59Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1394", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 43, 23, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"8e3b8feb-d076-4c27-b162-fc0f311a5259", Controller:(*bool)(0xc000bf814c), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 43, 23, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00043fdb8), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 43, 59, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc00043fde8), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000bf8148), Selector:(*v1.LabelSelector)(0xc0007bda40), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc001083800), ReadinessProbe:(*v1.Probe)(0xc0010837c0), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"ACTOKEY", Image:"ACTOKEY", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(0xc0005464c0)}, v1.EnvVar{Name:"ACTOKEY", Value:"ACTOKEY", ValueFrom:(*v1.EnvVarSource)(0xc000546500)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList(nil)}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000730840), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803099445773647e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803099445802953e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803099445822134e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803099445851471e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680309944671225e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803099446755672e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803099446756108e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803099446811125e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803099446850107e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803099446850355e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803099449705799e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.4"}
1.6803099449718983e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379@16379 myself,master - 0 0 0 connected\n"}
1.6803099449719427e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "1"}
1.6803099449799297e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.4"}
1.6803099450696352e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379@16379 myself,master - 0 0 0 connected\n"}
1.680309945069755e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "1", "Type": "leader"}
1.6803099450697825e+09	INFO	controllers.RedisCluster	Not all leader are part of the cluster...	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 1, "Instance.Size": 3}
1.68030994507503e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.4"}
1.6803099451710484e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-1", "ip": "10.244.1.6"}
1.6803099451765423e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-2", "ip": "10.244.2.9"}
1.6803099451766007e+09	INFO	controller_redis	Redis cluster creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "create", "10.244.3.4:6379", "10.244.1.6:6379", "10.244.2.9:6379", "--cluster-yes"]}
1.6803099451812236e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.6803099475933268e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "create", "10.244.3.4:6379", "10.244.1.6:6379", "10.244.2.9:6379", "--cluster-yes"], "Output": ">>> Performing hash slots allocation on 3 nodes...\nMaster[0] -> Slots 0 - 5460\nMaster[1] -> Slots 5461 - 10922\nMaster[2] -> Slots 10923 - 16383\nM: 93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379\n   slots:[0-5460] (5461 slots) master\nM: 51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379\n   slots:[5461-10922] (5462 slots) master\nM: 5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379\n   slots:[10923-16383] (5461 slots) master\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n.\n>>> Performing Cluster Check (using node 10.244.3.4:6379)\nM: 93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379\n   slots:[0-5460] (5461 slots) master\nM: 51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379\n   slots:[5461-10922] (5462 slots) master\nM: 5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379\n   slots:[10923-16383] (5461 slots) master\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n"}
1.6803099475933826e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803099486776962e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803099486896338e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.68030994869538e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1492","uid":"028a474c-1e9c-47ca-a5c5-281ec31e5f0b"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1492"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:58Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803099486985183e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803099487719367e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803099488705668e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803099489737704e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803099490733044e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803099490733614e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803099490781486e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803099492729485e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1504","uid":"9f442151-f086-47f8-9042-e2b51b9115ab"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1504"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:59Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803099492769141e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680309949372807e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803099493782015e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680309949472471e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803099494777017e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680309949477736e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803099494821963e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803099494862645e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680309949486303e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803099495755343e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.4"}
1.6803099495763357e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379@16379 myself,master - 0 1680309947000 1 connected 0-5460\n51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379@16379 master - 0 1680309949385 2 connected 5461-10922\n5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379@16379 master - 0 1680309948382 3 connected 10923-16383\n"}
1.6803099495764036e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3"}
1.6803099495816233e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.4"}
1.6803099495825887e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379@16379 myself,master - 0 1680309947000 1 connected 0-5460\n51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379@16379 master - 0 1680309949385 2 connected 5461-10922\n5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379@16379 master - 0 1680309948382 3 connected 10923-16383\n"}
1.6803099495826468e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803099495826588e+09	INFO	controllers.RedisCluster	All leader are part of the cluster, adding follower/replicas	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Instance.Size": 3, "Follower.Replicas": 3}
1.6803099495878608e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.4"}
1.6803099495885766e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379@16379 myself,master - 0 1680309947000 1 connected 0-5460\n51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379@16379 master - 0 1680309949385 2 connected 5461-10922\n5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379@16379 master - 0 1680309948382 3 connected 10923-16383\n"}
1.680309949671693e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-0", "ip": "10.244.3.5"}
1.6803099496718876e+09	INFO	controller_redis	Checking if Node is in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node": "10.244.3.5"}
1.6803099496719058e+09	INFO	controller_redis	Adding node to cluster.	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node.IP": "10.244.3.5", "Follower.Pod": {"PodName":"test-cluster-follower-0","Namespace":"redis-operator"}}
1.6803099496784701e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-0", "ip": "10.244.3.5"}
1.680309949976685e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.4"}
1.6803099499767616e+09	INFO	controller_redis	Redis replication creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.3.5:6379", "10.244.3.4:6379", "--cluster-slave"]}
1.6803099499813569e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.68030995117631e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.3.5:6379", "10.244.3.4:6379", "--cluster-slave"], "Output": ">>> Adding node 10.244.3.5:6379 to cluster 10.244.3.4:6379\n>>> Performing Cluster Check (using node 10.244.3.4:6379)\nM: 93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379\n   slots:[0-5460] (5461 slots) master\nM: 51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379\n   slots:[5461-10922] (5462 slots) master\nM: 5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379\n   slots:[10923-16383] (5461 slots) master\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nAutomatically selected master 10.244.3.4:6379\n>>> Send CLUSTER MEET to node 10.244.3.5:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 10.244.3.4:6379.\n[OK] New node added correctly.\n"}
1.6803099511826565e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-1", "ip": "10.244.1.5"}
1.6803099511828556e+09	INFO	controller_redis	Checking if Node is in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node": "10.244.1.5"}
1.680309951182869e+09	INFO	controller_redis	Adding node to cluster.	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node.IP": "10.244.1.5", "Follower.Pod": {"PodName":"test-cluster-follower-1","Namespace":"redis-operator"}}
1.680309951185877e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-1", "ip": "10.244.1.5"}
1.6803099511889265e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-1", "ip": "10.244.1.6"}
1.6803099511889577e+09	INFO	controller_redis	Redis replication creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.1.5:6379", "10.244.1.6:6379", "--cluster-slave"]}
1.6803099511925528e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.6803099522821949e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.1.5:6379", "10.244.1.6:6379", "--cluster-slave"], "Output": ">>> Adding node 10.244.1.5:6379 to cluster 10.244.1.6:6379\n>>> Performing Cluster Check (using node 10.244.1.6:6379)\nM: 51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379\n   slots:[5461-10922] (5462 slots) master\nS: abac4fd8b9946df3b4aee3ec4cc79e0bb2688eab 10.244.3.5:6379\n   slots: (0 slots) slave\n   replicates 93985c9f80518dc8a7c592f7ff013bae0cf403b8\nM: 5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379\n   slots:[10923-16383] (5461 slots) master\nM: 93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nAutomatically selected master 10.244.1.6:6379\n>>> Send CLUSTER MEET to node 10.244.1.5:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 10.244.1.6:6379.\n[OK] New node added correctly.\n"}
1.6803099522907925e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-2", "ip": "10.244.2.8"}
1.6803099522908404e+09	INFO	controller_redis	Checking if Node is in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node": "10.244.2.8"}
1.6803099522908485e+09	INFO	controller_redis	Adding node to cluster.	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node.IP": "10.244.2.8", "Follower.Pod": {"PodName":"test-cluster-follower-2","Namespace":"redis-operator"}}
1.6803099522941537e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-2", "ip": "10.244.2.8"}
1.680309952298606e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-2", "ip": "10.244.2.9"}
1.6803099522986763e+09	INFO	controller_redis	Redis replication creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.2.8:6379", "10.244.2.9:6379", "--cluster-slave"]}
1.6803099524762332e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.680309953720689e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.2.8:6379", "10.244.2.9:6379", "--cluster-slave"], "Output": ">>> Adding node 10.244.2.8:6379 to cluster 10.244.2.9:6379\n>>> Performing Cluster Check (using node 10.244.2.9:6379)\nM: 5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379\n   slots:[10923-16383] (5461 slots) master\nM: 93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nM: 51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nS: abac4fd8b9946df3b4aee3ec4cc79e0bb2688eab 10.244.3.5:6379\n   slots: (0 slots) slave\n   replicates 93985c9f80518dc8a7c592f7ff013bae0cf403b8\nS: b7b72694e332261c15619ece96249fd6952549f7 10.244.1.5:6379\n   slots: (0 slots) slave\n   replicates 51a9b5d684e147f801e4d34cf9c01ed0a5b0945c\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nAutomatically selected master 10.244.2.9:6379\n>>> Send CLUSTER MEET to node 10.244.2.8:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 10.244.2.9:6379.\n[OK] New node added correctly.\n"}
1.6803099537207506e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803099637213411e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
MATT IS HERE: patchStatefulSet
1.6803099637286925e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1492","uid":"028a474c-1e9c-47ca-a5c5-281ec31e5f0b"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1492"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680309963971517e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:58Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803099639781427e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803099639815927e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803099639854393e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803099640719683e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803099640759792e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803099640760157e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680309964170485e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1504","uid":"9f442151-f086-47f8-9042-e2b51b9115ab"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1504"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:59Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803099641743572e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803099641790671e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680309964181493e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803099641851368e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803099642708907e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803099642764113e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803099642764635e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803099642822237e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803099645751078e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680309964575215e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803099645825853e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.4"}
1.680309964583287e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379@16379 myself,master - 0 1680309962000 1 connected 0-5460\nabac4fd8b9946df3b4aee3ec4cc79e0bb2688eab 10.244.3.5:6379@16379 slave 93985c9f80518dc8a7c592f7ff013bae0cf403b8 0 1680309963591 1 connected\n750225ebe09e96a1a023eafeb70b56a35447068c 10.244.2.8:6379@16379 slave 5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 0 1680309964495 3 connected\nb7b72694e332261c15619ece96249fd6952549f7 10.244.1.5:6379@16379 slave 51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 0 1680309963000 2 connected\n5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379@16379 master - 0 1680309963000 3 connected 10923-16383\n51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379@16379 master - 0 1680309964000 2 connected 5461-10922\n"}
1.6803099645833862e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803099645833945e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803099645870562e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.4"}
1.6803099645876725e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "93985c9f80518dc8a7c592f7ff013bae0cf403b8 10.244.3.4:6379@16379 myself,master - 0 1680309962000 1 connected 0-5460\nabac4fd8b9946df3b4aee3ec4cc79e0bb2688eab 10.244.3.5:6379@16379 slave 93985c9f80518dc8a7c592f7ff013bae0cf403b8 0 1680309963591 1 connected\n750225ebe09e96a1a023eafeb70b56a35447068c 10.244.2.8:6379@16379 slave 5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 0 1680309964495 3 connected\nb7b72694e332261c15619ece96249fd6952549f7 10.244.1.5:6379@16379 slave 51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 0 1680309963000 2 connected\n5fd550bb87fe666bb7f19ac63a047b8cc9e37e4d 10.244.2.9:6379@16379 master - 0 1680309963000 3 connected 10923-16383\n51a9b5d684e147f801e4d34cf9c01ed0a5b0945c 10.244.1.6:6379@16379 master - 0 1680309964000 2 connected 5461-10922\n"}
1.6803099645877361e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 0}
1.6803100845881946e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803100846001096e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1589","uid":"028a474c-1e9c-47ca-a5c5-281ec31e5f0b"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1589"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:58Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680310084778501e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803100848749409e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803100848777883e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803100849733636e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803100849761302e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803100849797041e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803100849797392e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.680310084983655e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1610","uid":"9f442151-f086-47f8-9042-e2b51b9115ab"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1610"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680310085072753e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:59Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803100850769434e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803100851713483e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803100851772065e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803100854712925e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803100854754384e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.68031008547546e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803100854804466e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680310085570607e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680310085570658e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803102055717196e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.680310205577133e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1589","uid":"028a474c-1e9c-47ca-a5c5-281ec31e5f0b"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1589"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:58Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680310205870211e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803102058760643e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803102058773668e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803102058800426e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803102058816574e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803102058839893e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803102058840642e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
MATT IS HERE: patchStatefulSet
1.6803102058879774e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803102059711823e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1610","uid":"9f442151-f086-47f8-9042-e2b51b9115ab"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1610"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:59Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803102059769032e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803102060714004e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803102060771039e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803102060803053e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803102060830717e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803102060830925e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803102060863678e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680310206173308e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803102061733377e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}
1.6803103261738954e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680310326184086e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803103261899495e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1589","uid":"028a474c-1e9c-47ca-a5c5-281ec31e5f0b"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1589"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:58Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803103262702012e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680310326372004e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803103263760643e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803103263778784e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803103263804762e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803103263805099e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
1.6803103263838367e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1610","uid":"9f442151-f086-47f8-9042-e2b51b9115ab"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803103264737973e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1610"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:59Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803103264789073e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803103264818008e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803103265702255e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803103265734355e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803103265771523e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803103265771885e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803103265809307e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680310326670966e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803103266710591e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}
1.6803104466717062e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803104466802053e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
1.6803104466843066e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1589","uid":"028a474c-1e9c-47ca-a5c5-281ec31e5f0b"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1589"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:58Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680310446770982e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803104467744093e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680310446874306e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803104469729693e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803104470701578e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803104470702207e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680310447078014e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1610","uid":"9f442151-f086-47f8-9042-e2b51b9115ab"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"apiVersion":"v1","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","imagePullPolicy":"IfNotPresent","name":"ACTOKEY","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803104471736035e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1610"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:43:23Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"8e3b8feb-d076-4c27-b162-fc0f311a5259\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:43:23Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:43:59Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"8e3b8feb-d076-4c27-b162-fc0f311a5259"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},{"env":[{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY"},"fieldRef":{"fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"4","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}}],"image":"ACTOKEY","name":"ACTOKEY","resources":{}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803104472708917e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803104472740564e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803104472797198e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803104473701508e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.68031044737525e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680310447375305e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803104473806e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803104473846862e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803104473847117e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}

