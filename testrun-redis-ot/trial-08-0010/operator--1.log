MATT IS HERE: CreateRedisLeader
1.6803073507578619e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
MATT IS HERE: patchStatefulSet
1.6803073507636416e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803073509736817e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-leader\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"$setElementOrder/env\":[{\"name\":\"PERSISTENCE_ENABLED\"},{\"name\":\"REDIS_ADDR\"},{\"name\":\"SERVER_MODE\"},{\"name\":\"SETUP_MODE\"}],\"env\":[{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"}],\"name\":\"test-cluster-leader\"},{\"$setElementOrder/env\":[{\"name\":\"PERSISTENCE_ENABLED\"},{\"name\":\"REDIS_ADDR\"},{\"name\":\"SERVER_MODE\"},{\"name\":\"SETUP_MODE\"}],\"env\":[{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"}],\"name\":\"redis-exporter\"}]}}}}"}
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-leader"},{"name":"redis-exporter"}],"containers":[{"$setElementOrder/env":[{"name":"PERSISTENCE_ENABLED"},{"name":"REDIS_ADDR"},{"name":"SERVER_MODE"},{"name":"SETUP_MODE"}],"env":[{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"}],"name":"test-cluster-leader"},{"$setElementOrder/env":[{"name":"PERSISTENCE_ENABLED"},{"name":"REDIS_ADDR"},{"name":"SERVER_MODE"},{"name":"SETUP_MODE"}],"env":[{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"}],"name":"redis-exporter"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","generation":2,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"1585","uid":"a0045ea8-8cb4-4e0b-a50a-6785a7d294f3"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"282600876617498624m","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"0","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"541150536670635829514731520n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"282600876617498624m","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"0","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"541150536670635829514731520n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"1585"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"bb92d5a1-36b7-4025-aef0-0187740314c5\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T23:50:02Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T23:50:38Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"1389"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"282600876617498624m","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"0","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"541150536670635829514731520n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"282600876617498624m","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"0","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"541150536670635829514731520n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-leader", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1585", Generation:0, CreationTimestamp:time.Date(2023, time.March, 31, 23, 50, 2, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-leader", "redis_setup_type":"cluster", "role":"leader"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVk1v2zgQ/S9zlizJjpJUt27sXQRoUsP2ZoEtjGBETSKiFMmSI2+NQP99QfkzgTfNISgWPVkezsfTezNDPQFaeUfOS6OhALTWJ6sMIvgqdQUFzBmZHlo1J4YIGmKskBGKJ0CtDSNLo33466iSfmCsZ0eksPQDGRKyawmik6eeUQsKPuQ5Fqr1TA66CISjPu9CNuQZGwsFDNPhKE5H8ShbDEdFnhbp8G+IQGFJqq+P1r5IFSvCityu+r0nbu09r22ouSsXgTMqGLbOXQQam5eoDqnCobfY4+7TxsaSQzbh0Pyjyc3ogRxpQR6KLy/o3dBwioxklZXEGJgXRrMzSpGDItC312IW4q72wE/ghAhaGVzL8sOwyjGLR+flRXyWDvMY6SGN0+zy4uIsHWVnIoduGajxpnWCDhiz/DIPNHhLYiOsVVKgh2IUgSdFIrxs8QQNsqg/vbsAoTS5lRR0+5oQTI1VyNQj+Slt+f69dsRyEB2lJrfpGtKr/ner8XQym1/PF5Pbq8n95Pbjb58mY4hghaql3ct00d57Nhlfz+8/jsezI6ceV5EkyghUtfFcnI8uPhyHzSezu8ns/ubzeHIUdyDgyHHx5/Q//ZYRyAYfg+1bi+uBNMmW4GSDYXU+GA5y2LpNW6WmRkmxhgKuH24NTx150mHdKLkiTd5PnSl7oen7jq2mwTATX6BEX0MESetdUkqd1ISKa1GT+DrwNSy7CB5QqtbRonbka6MqKPIIpJYsUY1J4XpOwujKQ5HlEVhy0lTPTCwbMi3vbfmPtoQjrOT/Fflu5PtWVrKR3D8J24bpT7OmX/SNcUGRbHh5I6GP+taSf4NrF8HKqLahG9Nq3rRzEx6nyDUUkPST+iqB3TJ02y88AzF9t8YxuSIbpG+ZhG3V58HwQy3Tt2t50rXrlkHP1lbINGeHTI9rKJ72Gl8plM1iu4pPXHjHnxLTYPVMmu8OsT/to+L9t/frLXxY7SgEeX9jqp4gmBFWfznJ9DkAXb7Q8Fgaz8Ztmij74/lgVcH4u1Tk156p6asxctuH2Rp9PzCkK6kfIYh4fI4rlApLRbP9zZ5GR9d82nX/BgAA//9QSwcILgVpaDMDAAAWCgAAUEsBAhQAFAAIAAgAAAAAAC4FaWgzAwAAFgoAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAAGkDAAAAAA==", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"bb92d5a1-36b7-4025-aef0-0187740314c5", Controller:(*bool)(0xc000b34d68), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000b34d64), Selector:(*v1.LabelSelector)(0xc000d50920), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-leader", "redis_setup_type":"cluster", "role":"leader"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-leader", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-leader", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc00061e600), ReadinessProbe:(*v1.Probe)(0xc00061e580), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-leader", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-leader", "redis_setup_type":"cluster", "role":"leader"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000918f00), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-leader", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803073510796142e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803073510848188e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803073511702871e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803073511758516e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803073511797657e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803073511835837e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803073511836252e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.680307351188243e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"$setElementOrder/env":[{"name":"PERSISTENCE_ENABLED"},{"name":"REDIS_ADDR"},{"name":"SERVER_MODE"},{"name":"SETUP_MODE"}],"env":[{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"}],"name":"test-cluster-follower"},{"$setElementOrder/env":[{"name":"PERSISTENCE_ENABLED"},{"name":"REDIS_ADDR"},{"name":"SERVER_MODE"},{"name":"SETUP_MODE"}],"env":[{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"},{"$patch":"delete","name":"ACTOKEY"}],"name":"redis-exporter"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"1582","uid":"62d861c6-d40a-46a9-8aac-cfce29ce22df"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"282600876617498624m","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"0","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"541150536670635829514731520n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"282600876617498624m","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"0","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"541150536670635829514731520n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"1582"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.680307351275374e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"$setElementOrder/env\":[{\"name\":\"PERSISTENCE_ENABLED\"},{\"name\":\"REDIS_ADDR\"},{\"name\":\"SERVER_MODE\"},{\"name\":\"SETUP_MODE\"}],\"env\":[{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"}],\"name\":\"test-cluster-follower\"},{\"$setElementOrder/env\":[{\"name\":\"PERSISTENCE_ENABLED\"},{\"name\":\"REDIS_ADDR\"},{\"name\":\"SERVER_MODE\"},{\"name\":\"SETUP_MODE\"}],\"env\":[{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"},{\"$patch\":\"delete\",\"name\":\"ACTOKEY\"}],\"name\":\"redis-exporter\"}]}}}}"}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"bb92d5a1-36b7-4025-aef0-0187740314c5\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T23:50:02Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T23:50:38Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"1383"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"282600876617498624m","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"0","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"541150536670635829514731520n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"282600876617498624m","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","optional":false}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"0","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"ACTOKEY","value":"ACTOKEY","valueFrom":{"configMapKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":false},"fieldRef":{"apiVersion":"ACTOKEY","fieldPath":"ACTOKEY"},"resourceFieldRef":{"containerName":"ACTOKEY","divisor":"541150536670635829514731520n","resource":"ACTOKEY"},"secretKeyRef":{"key":"ACTOKEY","name":"ACTOKEY","optional":true}}},{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1582", Generation:0, CreationTimestamp:time.Date(2023, time.March, 31, 23, 50, 2, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVk1v2zgQ/S9zlizJjpNUt27sXQRoUsP2ZoEtjGBEjSOiFMmSI7dGoP++oPwRJfBuckmx6MnycD6e3psZ6hHQyjtyXhoNOaC1PtlkEMFXqUvIYcHItG7UghgiqImxREbIHwG1Nowsjfbhr6NS+oGxnh2RwsIPZEjIriGITp56Ri0o+JDnWKjGMzloIxCOurxLWZNnrC3kMEyHozgdxaNsORzl4zRPh39DBAoLUl19tPZFqnhtlDLfyR3q33vixt7z1oaqh4IROKOC4ejeRqCxfomsny4ce4sd+i51bCw5ZBMOzXdNbk5rcqQFeci/vCB5R8YpSpJNVhBj4F8Yzc4oRQ7yQOJRkXmIuzqCP4EUImhkcC2KD8NyjFk8Oi8u4rN0OI6R1mmcZpcXF2fpKDsTY2hXgR5vGifoCWM2vhwGIrwlsZPXKinQQz6KwJMiEV42f4QaWVSf3kWGUJ7cRgq6/W85mGqrkKnD81Na9H36rsd3kB+lJrfrH9Kb7nev9mw6X1wvltPbq+n99Pbjb5+mE4hgg6qhwwu10dF7Pp1cL+4/TibznlOHLE8SZQSqynjOz0cXH/phi+n8bjq/v/k8mfbinkjoOS7/nP2r3yoCWeNDsH1rcDuQJtmTnOwwbM4Hw8EY9m6zRqmZUVJsIYfr9a3hmSNPOqwfJTekyfuZM0UnNv04sFXXGKbjCxToK4ggabxLCqmTilBxJSoSXwe+glUbwRqlahwtK0e+MqqEfByB1JIlqgkp3C5IGF16yLNxBJacNOUzE8uaTMNH2/j1jeEIS/l/xX4Y/66hlawld0/CNmETpFndrf7auKBJNry8kdBFfWvIv8G1jWBjVFPTjWk07xq6Do8z5ApySLp5fYXCdhU67heeg5h+WOOYXJ4N0rdMw77q82B4Vc307WqedG3bVVC0sSUyLdgh08MW8sejylcKZb3cr+QT11//82IWrJ5J891T7E/70HifLf5aIz8teRSCvL8xZUcTzAnLv5xk+hzgrl4o2RfIs3G7Vsr+eD5gZTD+LhX5rWequ2qM3HRhtkLfjQ3pUuoHCFL2z3GDUmGhaH687dOod/WnbftPAAAA//9QSwcIv1Sc/TYDAAAwCgAAUEsBAhQAFAAIAAgAAAAAAL9UnP02AwAAMAoAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAAGwDAAAAAA==", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"bb92d5a1-36b7-4025-aef0-0187740314c5", Controller:(*bool)(0xc000adec9c), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000adec98), Selector:(*v1.LabelSelector)(0xc000593a20), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc000963900), ReadinessProbe:(*v1.Probe)(0xc0009638c0), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000b1ea70), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803073516708748e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803073516741931e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803073516765814e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680307351679528e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680307351682052e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803073517739606e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803073517740176e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803073518751333e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803073518788865e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803073518789308e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}
MATT IS HERE: Reconcile
1.6803073631710744e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
MATT IS HERE: patchStatefulSet
1.6803073631790662e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVk1v2zgQ/S9zlizJjpJUt27sXQRoUsP2ZoEtjGBETSKiFMmSI2+NQP99QfkzgTfNISgWPVkezsfTezNDPQFaeUfOS6OhALTWJ6sMIvgqdQUFzBmZHlo1J4YIGmKskBGKJ0CtDSNLo33466iSfmCsZ0eksPQDGRKyawmik6eeUQsKPuQ5Fqr1TA66CISjPu9CNuQZGwsFDNPhKE5H8ShbDEdFnhbp8G+IQGFJqq+P1r5IFSvCityu+r0nbu09r22ouSsXgTMqGLbOXQQam5eoDqnCobfY4+7TxsaSQzbh0Pyjyc3ogRxpQR6KLy/o3dBwioxklZXEGJgXRrMzSpGDItC312IW4q72wE/ghAhaGVzL8sOwyjGLR+flRXyWDvMY6SGN0+zy4uIsHWVnIoduGajxpnWCDhiz/DIPNHhLYiOsVVKgh2IUgSdFIrxs8QQNsqg/vbsAoTS5lRR0+5oQTI1VyNQj+Slt+f69dsRyEB2lJrfpGtKr/ner8XQym1/PF5Pbq8n95Pbjb58mY4hghaql3ct00d57Nhlfz+8/jsezI6ceV5EkyghUtfFcnI8uPhyHzSezu8ns/ubzeHIUdyDgyHHx5/Q//ZYRyAYfg+1bi+uBNMmW4GSDYXU+GA5y2LpNW6WmRkmxhgKuH24NTx150mHdKLkiTd5PnSl7oen7jq2mwTATX6BEX0MESetdUkqd1ISKa1GT+DrwNSy7CB5QqtbRonbka6MqKPIIpJYsUY1J4XpOwujKQ5HlEVhy0lTPTCwbMi3vbfmPtoQjrOT/Fflu5PtWVrKR3D8J24bpT7OmX/SNcUGRbHh5I6GP+taSf4NrF8HKqLahG9Nq3rRzEx6nyDUUkPST+iqB3TJ02y88AzF9t8YxuSIbpG+ZhG3V58HwQy3Tt2t50rXrlkHP1lbINGeHTI9rKJ72Gl8plM1iu4pPXHjHnxLTYPVMmu8OsT/to+L9t/frLXxY7SgEeX9jqp4gmBFWfznJ9DkAXb7Q8Fgaz8Ztmij74/lgVcH4u1Tk156p6asxctuH2Rp9PzCkK6kfIYh4fI4rlApLRbP9zZ5GR9d82nX/BgAA//9QSwcILgVpaDMDAAAWCgAAUEsBAhQAFAAIAAgAAAAAAC4FaWgzAwAAFgoAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAAGkDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","generation":3,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"3070","uid":"a0045ea8-8cb4-4e0b-a50a-6785a7d294f3"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"3070"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"1585"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803073631843176e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.680307363188994e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803073632711663e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803073632763972e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.680307363279993e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803073632834792e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803073632835245e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803073632878196e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVk1v2zgQ/S9zlizJjpNUt27sXQRoUsP2ZoEtjGBEjSOiFMmSI7dGoP++oPwRJfBuckmx6MnycD6e3psZ6hHQyjtyXhoNOaC1PtlkEMFXqUvIYcHItG7UghgiqImxREbIHwG1Nowsjfbhr6NS+oGxnh2RwsIPZEjIriGITp56Ri0o+JDnWKjGMzloIxCOurxLWZNnrC3kMEyHozgdxaNsORzl4zRPh39DBAoLUl19tPZFqnhtlDLfyR3q33vixt7z1oaqh4IROKOC4ejeRqCxfomsny4ce4sd+i51bCw5ZBMOzXdNbk5rcqQFeci/vCB5R8YpSpJNVhBj4F8Yzc4oRQ7yQOJRkXmIuzqCP4EUImhkcC2KD8NyjFk8Oi8u4rN0OI6R1mmcZpcXF2fpKDsTY2hXgR5vGifoCWM2vhwGIrwlsZPXKinQQz6KwJMiEV42f4QaWVSf3kWGUJ7cRgq6/W85mGqrkKnD81Na9H36rsd3kB+lJrfrH9Kb7nev9mw6X1wvltPbq+n99Pbjb5+mE4hgg6qhwwu10dF7Pp1cL+4/TibznlOHLE8SZQSqynjOz0cXH/phi+n8bjq/v/k8mfbinkjoOS7/nP2r3yoCWeNDsH1rcDuQJtmTnOwwbM4Hw8EY9m6zRqmZUVJsIYfr9a3hmSNPOqwfJTekyfuZM0UnNv04sFXXGKbjCxToK4ggabxLCqmTilBxJSoSXwe+glUbwRqlahwtK0e+MqqEfByB1JIlqgkp3C5IGF16yLNxBJacNOUzE8uaTMNH2/j1jeEIS/l/xX4Y/66hlawld0/CNmETpFndrf7auKBJNry8kdBFfWvIv8G1jWBjVFPTjWk07xq6Do8z5ApySLp5fYXCdhU67heeg5h+WOOYXJ4N0rdMw77q82B4Vc307WqedG3bVVC0sSUyLdgh08MW8sejylcKZb3cr+QT11//82IWrJ5J891T7E/70HifLf5aIz8teRSCvL8xZUcTzAnLv5xk+hzgrl4o2RfIs3G7Vsr+eD5gZTD+LhX5rWequ2qM3HRhtkLfjQ3pUuoHCFL2z3GDUmGhaH687dOod/WnbftPAAAA//9QSwcIv1Sc/TYDAAAwCgAAUEsBAhQAFAAIAAgAAAAAAL9UnP02AwAAMAoAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAAGwDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","generation":3,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"3080","uid":"62d861c6-d40a-46a9-8aac-cfce29ce22df"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"3080"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T23:50:02Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"bb92d5a1-36b7-4025-aef0-0187740314c5"}],"resourceVersion":"1582"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803073633736355e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803073634764001e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680307363673567e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803073637701075e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803073637721274e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803073637774072e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680307363777441e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.68030736387018e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803073638743463e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803073638743882e+09	INFO	controllers.RedisCluster	Redis leader and follower nodes are not ready yet	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Ready.Replicas": "2", "Expected.Replicas": 3}

