MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680303406511744e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803034065165687e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803034067744849e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zYQ/l/umbakpPZavXWxNwRoUkPOuociMM7UuSJKkSx51GoY+t8Hyj/iBFmahz2se5J4/O54933H4w7QqU/kg7IGSkDnQtYVIOCrMjWUsGRk2kS9JAYBLTHWyAjlDtAYy8jKmpCWnmoVxtYF9kQa12GsUkD2kUA8uxsYjaSEocAjqWNg8tAL0LgmPQRF557sjzRhTf4YchWIo1vx1qVAxxgCvNXJcAD3Agy2T496CJU2g8MhmSHsyDryyDZt2r8M+Yo25MlIClB+fsLZvrbnKsy6Yk2MiU5pDXurNXkoEycngqvkd3VK/Jk8QUBUCTqZYJ5f1NPRBuv16M274nKEb4uL0WYyzadTfJPnRQ79fS8gOJJ7UZxWEgOUlwICaZKppnIHLbJsPvzrPKejyXdK0u1LfDO1TiPTkMlP2lJnLCdtURny++Yg0w3fg5SLebW8Xt7Nb6/mq/nt+18/zGcgoEMd6VhML07oaj67Xq7ez2bVGWjIq8wybSXqxgYup5e/vDt3W86rT/NqdfNxNj/zeyDgDHj3x+IfcfcCVItfku1bxO1Y2exAcLbPoZuOL8YTOMAWUeuF1UpuoYTrza3lhadAJo0KrToyFMLC2/UgNH0/stW2mFr/M6wxNCAgi8Fna2WyhlBzIxuSX8ehgdTJG1Q6erprPIXG6hrKiQBlFCvUM9K4XZK0pg5QFhMBjryy9SMTq5Zs5JNt8qNh4Alr9V/N3FOw0Q9jaAdatYqHP+kilFDkRTsM6db6pEhx8fZGweD1LVJ4BbQX0FkdW7qx0fC+ndv0u0BuoIRsuKkvEpjmz//6Dozou7OeyZfFOH/NTTic+tgZfqhl/notn4X2/X3SM7oamZbskenLFsrdSeMrjaq9O4zig9Y/6TB+uSMfJjVKSSHc2HqoFyrC+k+vmD6mRO+fSHLOdGDr9z1R/P74ntTJ+JvSFLaBqR1OY+SY3Pr9Y3xcAnaoNK41Vad3ORdnj3Te938HAAD//1BLBwigiCOx8AIAAJAJAABQSwECFAAUAAgACAAAAAAAoIgjsfACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1400","uid":"0304505c-6a26-400c-bed6-aabf598f7c42"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803034067802818e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680303406870405e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680303406876336e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803034068781831e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.680303406974669e+09	INFO	controller_redis	Redis PodDisruptionBudget get action was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803034069764462e+09	INFO	controller_redis	Changes in PodDisruptionBudget Detected, Updating...	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader", "patch": "{\"spec\":{\"maxUnavailable\":5,\"selector\":null}}", "Current": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"banzaicloud.com/last-applied\":\"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWyEkj1vGzEMhv8L57tEl8ZGq60fQ4cOQYYuRRHQ0utGqCwJIpXUMO6/FzoHRm0Y6Hh8yefIBzoQl/AdVUJOZKnkGNz+9mWigX6H5MnSQ/ZfgtRWNOT0qflfUBpoB2XPymQPxCll5R5L/6zwQW5yEa1A5I3chI7W2kDD1VSUk0PvgejoYhNFpXmgyBvEBcqlXOZvrCeBtvKk+9IJ/4Q59kIE+yMs8e7yH+Nbegyl8LLFgh1zQWXNPcyvCfURW1QkByH740Lb8ahrp92+TBsod58uJ605RlSyXcbJ8GOf+3xa/MqeNFALvXW1YmPu/Hrcst+M9x+mdyO/n+7G7Wpt1mu+N2YyNP+cB5IC18UJIlw/wx5ox+qev/3H6bm2uaOUtS0TrtWKpF/BUZ/3ZM1AHhIq/Fnp9FzkY4z5FX4p40+BU/iH7IWsmee/AQAA//9QSwcIXMkwvE0BAAB8AgAAUEsBAhQAFAAIAAgAAAAAAFzJMLxNAQAAfAIAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAAIMBAAAAAA==\",\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"generation\":1,\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"leader\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-leader\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1494\",\"uid\":\"180e08a9-4c0e-4a03-b78d-519e1af345e7\"}}", "Original": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"leader\"},\"name\":\"test-cluster-leader\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}]},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"test-cluster\",\"role\":\"leader\"}}},\"status\":{\"currentHealthy\":0,\"desiredHealthy\":0,\"disruptionsAllowed\":0,\"expectedPods\":0}}", "Modified": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"leader\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-leader\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1494\"},\"spec\":{\"maxUnavailable\":5}}"}
1.680303406985381e+09	INFO	controller_redis	Redis PodDisruptionBudget update was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader", "PDB.Spec": {"selector":{"matchLabels":{"app":"test-cluster","role":"leader"}},"maxUnavailable":5}}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680303406989202e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803034072844157e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zYQ/l/umbakpPZavXWxNwRoUkPOuociMM7UuSJKkSx5VGsY+t8Hyj/qBNmSlwHLnmwdvzvefd/dcQfo1CfyQVkDJaBzIesKEPBVmRpKWDIybaJeEoOAlhhrZIRyB2iMZWRlTUifnmoVxtYF9kQa12GsUkD2kUA8eRoYjaSEocAjqWNg8tAL0LgmPQRF5x6djzZWa/ud/DHoKhBHt+KtS6GOUQR4q5PhBO8FGGwfX3ceLh0Hh0NKQ+iRdeSRbTq03w35ijbkyUgKUH5+xNy+wqfqzLpiTYyJVGkNe6s1eSgTMyeaq+R3dUr+iUxBQFQJOplgnl/U09EG6/XozbvicoRvi4vRZjLNp1N8k+dFDv19LyA4kntpnFYSA5SXAgJpkqmmcgctsmw+/Ctsp+vJd0rS7T+zztQ6jUxDPq+4vc74TiqjMuT3bUKmG34Poi7m1fJ6eTe/vZqv5rfvf/0wn4GADnWkY0G9OKGr+ex6uXo/m1VnoCGzMsu0lagbG7icXv7y7txtOa8+zavVzcfZ/MzvJwlnwLs/Fn+LuxegWvySbN8ibsfKZgeSs30O3XR8MZ7AAbaIWi+sVnILJVxvbi0vPAUyaXVo1ZGhEBbergex6ceRrbbFNASfYY2hAQFZDD5bK5M1hJob2ZD8Og4NpJ7eoNLR013jKTRW11BOBCijWKGekcbtkqQ1dYCymAhw5JWtH5hYtWQjn2yT5xeDJ6zVfzV3T8FGP6ykHWjVKh7+SRehhCIv2mFtt9YnTYqLtzcKBq9vkcILoL2AzurY0o2NhvcN3aa/C+QGSsiGeX2GwrSN/tdzMKIfznomXxbj/CXTcLj1oTM8q2b+cjWfhPb9fVI0uhqZluyR6csWyt1J5SuNqr07rOSD2q94KT/Xlz93NkpJIdzYeqgaKsL6T6+YPqZ07x8Jc853YOv3nVH8/nBe6mT8TWkK28DUDrcxckxu/f6BPn4Cdqg0rjVVp7c6F2cPd973fwUAAP//UEsHCEmOce/yAgAAqgkAAFBLAQIUABQACAAIAAAAAABJjnHv8gIAAKoJAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAAoAwAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1394","uid":"6f622b7c-b892-43f5-8100-255047e63819"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803034072885265e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680303407289954e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803034072928202e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803034072940228e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680303407370443e+09	INFO	controller_redis	Redis PodDisruptionBudget get action was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803034073719175e+09	INFO	controller_redis	Changes in PodDisruptionBudget Detected, Updating...	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower", "patch": "{\"spec\":{\"maxUnavailable\":5,\"selector\":null}}", "Current": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"banzaicloud.com/last-applied\":\"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWyEkk/P0zAMh7+Lz+37pmOrIDf+HDhwmHbggtDkJi6LyJIodjamqd8dpUMVVJM41j/7qf0od8DkvlJmFwNoSNE7c3u9dNDATxcsaNhH+8lxLklcDB+K/UECDZxJ0KIg6DtgCFGwxlw/M1nHLzGxZCKPA7+4ipZcCJqnKQsGQ7WHWFrjCwtlmBrwOJCfoZjSOv/DOjJJSUe5pUr4K4y+Fsbofbw+cAHP67+0S/6IOeG8yYxuY6KMEmsYr4HygUbKFAwx6G8rdY/Dnp33eukGEqxOTQySo/eUQVchi+VDnfu4LP9kU2iguNq626FSG9u3I9qh3b7r3rT4ttu0465XfY9bpToF0/epAU5kqjwmT6aeoe9wRjGnL//xulY3VZiglHnGlJwpyGdCL6cbaNWAJXaZ7D+l5dHw+5lj5zL9SmSE7D5aBq2m6XcAAAD//1BLBwh+HQ47TAEAAIICAABQSwECFAAUAAgACAAAAAAAfh0OO0wBAACCAgAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAggEAAAAA\",\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"generation\":1,\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"follower\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-follower\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1499\",\"uid\":\"85b1d12a-32e3-43f9-929a-afaa465d2acf\"}}", "Original": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"follower\"},\"name\":\"test-cluster-follower\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}]},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"test-cluster\",\"role\":\"follower\"}}},\"status\":{\"currentHealthy\":0,\"desiredHealthy\":0,\"disruptionsAllowed\":0,\"expectedPods\":0}}", "Modified": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"follower\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-follower\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1499\"},\"spec\":{\"maxUnavailable\":5}}"}
1.6803034074803247e+09	INFO	controller_redis	Redis PodDisruptionBudget update was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower", "PDB.Spec": {"selector":{"matchLabels":{"app":"test-cluster","role":"follower"}},"maxUnavailable":5}}
1.6803034074841652e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803034074865654e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803034074865916e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.680303407570897e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803034075716152e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "2a026be4bdc0be342b75701d43c9bea6a6718a75 10.244.1.6:6379@16379 master - 0 1680303406000 3 connected 10923-16383\n3685a9bd297fb8207b18961fb61b9324bdbeb452 10.244.2.8:6379@16379 master - 0 1680303405422 2 connected 5461-10922\n1ae34473f1518027ba0281cb3826a48dd9d75b02 10.244.1.5:6379@16379 slave 2a026be4bdc0be342b75701d43c9bea6a6718a75 0 1680303406000 3 connected\nb90c8d45d3b39094f01b3f152af555502b5bd71d 10.244.3.5:6379@16379 myself,master - 0 1680303406000 1 connected 0-5460\nb7640a02b7558ff9046833cf49eb7d2f4ba49844 10.244.2.9:6379@16379 slave 3685a9bd297fb8207b18961fb61b9324bdbeb452 0 1680303406426 2 connected\nab37e3469ed76104d61243f59fe85b6f545db764 10.244.3.4:6379@16379 slave b90c8d45d3b39094f01b3f152af555502b5bd71d 0 1680303407429 1 connected\n"}
1.6803034075716732e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803034075716815e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803034075779526e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803034075787733e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "2a026be4bdc0be342b75701d43c9bea6a6718a75 10.244.1.6:6379@16379 master - 0 1680303406000 3 connected 10923-16383\n3685a9bd297fb8207b18961fb61b9324bdbeb452 10.244.2.8:6379@16379 master - 0 1680303405422 2 connected 5461-10922\n1ae34473f1518027ba0281cb3826a48dd9d75b02 10.244.1.5:6379@16379 slave 2a026be4bdc0be342b75701d43c9bea6a6718a75 0 1680303406000 3 connected\nb90c8d45d3b39094f01b3f152af555502b5bd71d 10.244.3.5:6379@16379 myself,master - 0 1680303406000 1 connected 0-5460\nb7640a02b7558ff9046833cf49eb7d2f4ba49844 10.244.2.9:6379@16379 slave 3685a9bd297fb8207b18961fb61b9324bdbeb452 0 1680303406426 2 connected\nab37e3469ed76104d61243f59fe85b6f545db764 10.244.3.4:6379@16379 slave b90c8d45d3b39094f01b3f152af555502b5bd71d 0 1680303407429 1 connected\n"}
1.6803034075788844e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 0}
1.6803034166730223e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803034166805887e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803034166888962e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zYQ/l/umbakpPZavXWxNwRoUkPOuociMM7UuSJKkSx51GoY+t8Hyj/iBFmahz2se5J4/O54933H4w7QqU/kg7IGSkDnQtYVIOCrMjWUsGRk2kS9JAYBLTHWyAjlDtAYy8jKmpCWnmoVxtYF9kQa12GsUkD2kUA8uxsYjaSEocAjqWNg8tAL0LgmPQRF557sjzRhTf4YchWIo1vx1qVAxxgCvNXJcAD3Agy2T496CJU2g8MhmSHsyDryyDZt2r8M+Yo25MlIClB+fsLZvrbnKsy6Yk2MiU5pDXurNXkoEycngqvkd3VK/Jk8QUBUCTqZYJ5f1NPRBuv16M274nKEb4uL0WYyzadTfJPnRQ79fS8gOJJ7UZxWEgOUlwICaZKppnIHLbJsPvzrPKejyXdK0u1LfDO1TiPTkMlP2lJnLCdtURny++Yg0w3fg5SLebW8Xt7Nb6/mq/nt+18/zGcgoEMd6VhML07oaj67Xq7ez2bVGWjIq8wybSXqxgYup5e/vDt3W86rT/NqdfNxNj/zeyDgDHj3x+IfcfcCVItfku1bxO1Y2exAcLbPoZuOL8YTOMAWUeuF1UpuoYTrza3lhadAJo0KrToyFMLC2/UgNH0/stW2mFr/M6wxNCAgi8Fna2WyhlBzIxuSX8ehgdTJG1Q6erprPIXG6hrKiQBlFCvUM9K4XZK0pg5QFhMBjryy9SMTq5Zs5JNt8qNh4Alr9V/N3FOw0Q9jaAdatYqHP+kilFDkRTsM6db6pEhx8fZGweD1LVJ4BbQX0FkdW7qx0fC+ndv0u0BuoIRsuKkvEpjmz//6Dozou7OeyZfFOH/NTTic+tgZfqhl/notn4X2/X3SM7oamZbskenLFsrdSeMrjaq9O4zig9Y/6TB+uSMfJjVKSSHc2HqoFyrC+k+vmD6mRO+fSHLOdGDr9z1R/P74ntTJ+JvSFLaBqR1OY+SY3Pr9Y3xcAnaoNK41Vad3ORdnj3Te938HAAD//1BLBwigiCOx8AIAAJAJAABQSwECFAAUAAgACAAAAAAAoIgjsfACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1400","uid":"0304505c-6a26-400c-bed6-aabf598f7c42"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803034166921692e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803034166936953e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803034166964827e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803034166980176e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803034167703915e+09	INFO	controller_redis	Redis PodDisruptionBudget get action was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803034167767327e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zYQ/l/umbakpPZavXWxNwRoUkPOuociMM7UuSJKkSx5VGsY+t8Hyj/qBNmSlwHLnmwdvzvefd/dcQfo1CfyQVkDJaBzIesKEPBVmRpKWDIybaJeEoOAlhhrZIRyB2iMZWRlTUifnmoVxtYF9kQa12GsUkD2kUA8eRoYjaSEocAjqWNg8tAL0LgmPQRF5x6djzZWa/ud/DHoKhBHt+KtS6GOUQR4q5PhBO8FGGwfX3ceLh0Hh0NKQ+iRdeSRbTq03w35ijbkyUgKUH5+xNy+wqfqzLpiTYyJVGkNe6s1eSgTMyeaq+R3dUr+iUxBQFQJOplgnl/U09EG6/XozbvicoRvi4vRZjLNp1N8k+dFDv19LyA4kntpnFYSA5SXAgJpkqmmcgctsmw+/Ctsp+vJd0rS7T+zztQ6jUxDPq+4vc74TiqjMuT3bUKmG34Poi7m1fJ6eTe/vZqv5rfvf/0wn4GADnWkY0G9OKGr+ex6uXo/m1VnoCGzMsu0lagbG7icXv7y7txtOa8+zavVzcfZ/MzvJwlnwLs/Fn+LuxegWvySbN8ibsfKZgeSs30O3XR8MZ7AAbaIWi+sVnILJVxvbi0vPAUyaXVo1ZGhEBbergex6ceRrbbFNASfYY2hAQFZDD5bK5M1hJob2ZD8Og4NpJ7eoNLR013jKTRW11BOBCijWKGekcbtkqQ1dYCymAhw5JWtH5hYtWQjn2yT5xeDJ6zVfzV3T8FGP6ykHWjVKh7+SRehhCIv2mFtt9YnTYqLtzcKBq9vkcILoL2AzurY0o2NhvcN3aa/C+QGSsiGeX2GwrSN/tdzMKIfznomXxbj/CXTcLj1oTM8q2b+cjWfhPb9fVI0uhqZluyR6csWyt1J5SuNqr07rOSD2q94KT/Xlz93NkpJIdzYeqgaKsL6T6+YPqZ07x8Jc853YOv3nVH8/nBe6mT8TWkK28DUDrcxckxu/f6BPn4Cdqg0rjVVp7c6F2cPd973fwUAAP//UEsHCEmOce/yAgAAqgkAAFBLAQIUABQACAAIAAAAAABJjnHv8gIAAKoJAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAAoAwAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1394","uid":"6f622b7c-b892-43f5-8100-255047e63819"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803034171719449e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680303417181949e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680303417271757e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803034172748606e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.68030341727679e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680303417279413e+09	INFO	controller_redis	Redis PodDisruptionBudget get action was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803034172838001e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803034173704627e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803034173705199e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803034174703877e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803034174711087e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "2a026be4bdc0be342b75701d43c9bea6a6718a75 10.244.1.6:6379@16379 master - 0 1680303416000 3 connected 10923-16383\n3685a9bd297fb8207b18961fb61b9324bdbeb452 10.244.2.8:6379@16379 master - 0 1680303416473 2 connected 5461-10922\n1ae34473f1518027ba0281cb3826a48dd9d75b02 10.244.1.5:6379@16379 slave 2a026be4bdc0be342b75701d43c9bea6a6718a75 0 1680303415000 3 connected\nb90c8d45d3b39094f01b3f152af555502b5bd71d 10.244.3.5:6379@16379 myself,master - 0 1680303414000 1 connected 0-5460\nb7640a02b7558ff9046833cf49eb7d2f4ba49844 10.244.2.9:6379@16379 slave 3685a9bd297fb8207b18961fb61b9324bdbeb452 0 1680303416000 2 connected\nab37e3469ed76104d61243f59fe85b6f545db764 10.244.3.4:6379@16379 slave b90c8d45d3b39094f01b3f152af555502b5bd71d 0 1680303415000 1 connected\n"}
1.6803034174712067e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803034174712152e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.680303417477465e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803034176701908e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "2a026be4bdc0be342b75701d43c9bea6a6718a75 10.244.1.6:6379@16379 master - 0 1680303416000 3 connected 10923-16383\n3685a9bd297fb8207b18961fb61b9324bdbeb452 10.244.2.8:6379@16379 master - 0 1680303416473 2 connected 5461-10922\n1ae34473f1518027ba0281cb3826a48dd9d75b02 10.244.1.5:6379@16379 slave 2a026be4bdc0be342b75701d43c9bea6a6718a75 0 1680303417578 3 connected\nb90c8d45d3b39094f01b3f152af555502b5bd71d 10.244.3.5:6379@16379 myself,master - 0 1680303416000 1 connected 0-5460\nb7640a02b7558ff9046833cf49eb7d2f4ba49844 10.244.2.9:6379@16379 slave 3685a9bd297fb8207b18961fb61b9324bdbeb452 0 1680303416000 2 connected\nab37e3469ed76104d61243f59fe85b6f545db764 10.244.3.4:6379@16379 slave b90c8d45d3b39094f01b3f152af555502b5bd71d 0 1680303417477 1 connected\n"}
1.6803034176703036e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 0}

