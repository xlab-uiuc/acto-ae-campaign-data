MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803034702492135e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803034702614179e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.680303470475885e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zYQ/l/umbakpPZavXWxNwRoUkPOuociMM7UuSJKkSx51GoY+t8Hyj/iBFmahz2se5J4/O54933H4w7QqU/kg7IGSkDnQtYVIOCrMjWUsGRk2kS9JAYBLTHWyAjlDtAYy8jKmpCWnmoVxtYF9kQa12GsUkD2kUA8uxsYjaSEocAjqWNg8tAL0LgmPQRF557sjzRhTf4YchWIo1vx1qVAxxgCvNXJcAD3Agy2T496CJU2g8MhmSHsyDryyDZt2r8M+Yo25MlIClB+fsLZvrbnKsy6Yk2MiU5pDXurNXkoEycngqvkd3VK/Jk8QUBUCTqZYJ5f1NPRBuv16M274nKEb4uL0WYyzadTfJPnRQ79fS8gOJJ7UZxWEgOUlwICaZKppnIHLbJsPvzrPKejyXdK0u1LfDO1TiPTkMlP2lJnLCdtURny++Yg0w3fg5SLebW8Xt7Nb6/mq/nt+18/zGcgoEMd6VhML07oaj67Xq7ez2bVGWjIq8wybSXqxgYup5e/vDt3W86rT/NqdfNxNj/zeyDgDHj3x+IfcfcCVItfku1bxO1Y2exAcLbPoZuOL8YTOMAWUeuF1UpuoYTrza3lhadAJo0KrToyFMLC2/UgNH0/stW2mFr/M6wxNCAgi8Fna2WyhlBzIxuSX8ehgdTJG1Q6erprPIXG6hrKiQBlFCvUM9K4XZK0pg5QFhMBjryy9SMTq5Zs5JNt8qNh4Alr9V/N3FOw0Q9jaAdatYqHP+kilFDkRTsM6db6pEhx8fZGweD1LVJ4BbQX0FkdW7qx0fC+ndv0u0BuoIRsuKkvEpjmz//6Dozou7OeyZfFOH/NTTic+tgZfqhl/notn4X2/X3SM7oamZbskenLFsrdSeMrjaq9O4zig9Y/6TB+uSMfJjVKSSHc2HqoFyrC+k+vmD6mRO+fSHLOdGDr9z1R/P74ntTJ+JvSFLaBqR1OY+SY3Pr9Y3xcAnaoNK41Vad3ORdnj3Te938HAAD//1BLBwigiCOx8AIAAJAJAABQSwECFAAUAAgACAAAAAAAoIgjsfACAACQCQAACAAAAAAAAAAAAAAAAAAAAAAAb3JpZ2luYWxQSwUGAAAAAAEAAQA2AAAAJgMAAAAA","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1400","uid":"0304505c-6a26-400c-bed6-aabf598f7c42"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1400"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803034704802263e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803034704817955e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803034704855888e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.68030347057084e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803034705745661e+09	INFO	controller_redis	Redis PodDisruptionBudget get action was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803034705758934e+09	INFO	controller_redis	Changes in PodDisruptionBudget Detected, Updating...	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader", "patch": "{\"spec\":{\"maxUnavailable\":2}}", "Current": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"banzaicloud.com/last-applied\":\"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWykVE9v2z4M/S4826mdf/hVt982rDvsUBRpD1uGgpaYVqgsCZKctgv83QfJsZ0EaTtgN4uUH6nH97gDtPKOnJdGAwNrlOSvF9sSMniSWgCDayO+SO8aG6TRnxrxQAEyqCmgwIDAdoBam4Ax7ePRkZB+YqwPjkhh5ScyQgfXEGRnsz6g5hTvkA85V40P5KDNgDtKuCtZkw9YW2AwLaazvJjls3I1nbLFnM2nPyADhRWpVB+tPYXal733FBp7H15tLHaQNCoGFKHo6tao8YHEV0lKeGA/32Fpk+6sOsjuh7sxflfGjjbskK4NOyFsAmzXZrBhFerfKLkyjZhwU18o9CFHa5Uk0d85z+7buZ7bXZuujDQNVRNfBwBHLO3jiaA9hHnW5G5oQ440p0OsJ7ZbQyPFGtgaFgssiqlY5hsUVT6/LGc5/ldO881iWSyXOC+KslhDm2ATrrfE92zhy63GLUqFlRqa8KSIB+P6P7ohOWBwZfLHEGzOlSQd1WksucQvMLi1AkNUXpA1vaWfNvvnEfuAofHdNzdayNP5JnYiq4me0VP/K2WeSXRcjGOJw1851F72DugzNXmPD8PRVJ7clsQV6eHV/TjRj6ehwXTqx9u+g3HM8lNTUc6NDs4oRS7vM2/Q7ZvKkTeNS87eF/9gCr8y0FifboJ8b8wu6S0mxKTVvCttUhenujy1bWePcya52JYVBYxDHR8ILK6sYQ/exP8+DzvjTJ+QRfED+yvpp8f2BI09lvPLedxAvRlOrbDI4MAHUGPgj98/WH3H2y0OddQqb5wjHb4RqvD4CqzIQJCXjsRRaBCr36s1henFEg8krk3ckkXb/gkAAP//UEsHCK53RL16AgAATgYAAFBLAQIUABQACAAIAAAAAACud0S9egIAAE4GAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAACwAgAAAAA=\",\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"generation\":2,\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"leader\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-leader\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1814\",\"uid\":\"180e08a9-4c0e-4a03-b78d-519e1af345e7\"},\"spec\":{\"maxUnavailable\":5}}", "Original": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"leader\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-leader\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1494\"},\"spec\":{\"maxUnavailable\":5,\"selector\":{\"matchLabels\":{\"app\":\"test-cluster\",\"role\":\"leader\"}}},\"status\":{\"currentHealthy\":0,\"desiredHealthy\":0,\"disruptionsAllowed\":0,\"expectedPods\":0}}", "Modified": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"leader\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-leader\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1814\"},\"spec\":{\"maxUnavailable\":2}}"}
1.6803034705820541e+09	INFO	controller_redis	Redis PodDisruptionBudget update was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader", "PDB.Spec": {"selector":{"matchLabels":{"app":"test-cluster","role":"leader"}},"maxUnavailable":2}}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803034705852413e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
1.6803034709743671e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zYQ/l/umbakpPZavXWxNwRoUkPOuociMM7UuSJKkSx5VGsY+t8Hyj/qBNmSlwHLnmwdvzvefd/dcQfo1CfyQVkDJaBzIesKEPBVmRpKWDIybaJeEoOAlhhrZIRyB2iMZWRlTUifnmoVxtYF9kQa12GsUkD2kUA8eRoYjaSEocAjqWNg8tAL0LgmPQRF5x6djzZWa/ud/DHoKhBHt+KtS6GOUQR4q5PhBO8FGGwfX3ceLh0Hh0NKQ+iRdeSRbTq03w35ijbkyUgKUH5+xNy+wqfqzLpiTYyJVGkNe6s1eSgTMyeaq+R3dUr+iUxBQFQJOplgnl/U09EG6/XozbvicoRvi4vRZjLNp1N8k+dFDv19LyA4kntpnFYSA5SXAgJpkqmmcgctsmw+/Ctsp+vJd0rS7T+zztQ6jUxDPq+4vc74TiqjMuT3bUKmG34Poi7m1fJ6eTe/vZqv5rfvf/0wn4GADnWkY0G9OKGr+ex6uXo/m1VnoCGzMsu0lagbG7icXv7y7txtOa8+zavVzcfZ/MzvJwlnwLs/Fn+LuxegWvySbN8ibsfKZgeSs30O3XR8MZ7AAbaIWi+sVnILJVxvbi0vPAUyaXVo1ZGhEBbergex6ceRrbbFNASfYY2hAQFZDD5bK5M1hJob2ZD8Og4NpJ7eoNLR013jKTRW11BOBCijWKGekcbtkqQ1dYCymAhw5JWtH5hYtWQjn2yT5xeDJ6zVfzV3T8FGP6ykHWjVKh7+SRehhCIv2mFtt9YnTYqLtzcKBq9vkcILoL2AzurY0o2NhvcN3aa/C+QGSsiGeX2GwrSN/tdzMKIfznomXxbj/CXTcLj1oTM8q2b+cjWfhPb9fVI0uhqZluyR6csWyt1J5SuNqr07rOSD2q94KT/Xlz93NkpJIdzYeqgaKsL6T6+YPqZ07x8Jc853YOv3nVH8/nBe6mT8TWkK28DUDrcxckxu/f6BPn4Cdqg0rjVVp7c6F2cPd973fwUAAP//UEsHCEmOce/yAgAAqgkAAFBLAQIUABQACAAIAAAAAABJjnHv8gIAAKoJAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAAoAwAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1394","uid":"6f622b7c-b892-43f5-8100-255047e63819"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-03-31T22:52:20Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-03-31T22:52:20Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-03-31T22:52:56Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}],"resourceVersion":"1394"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"55a002d6-fadb-4913-a812-f56066a40010"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680303470981148e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803034710698843e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803034710744164e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803034710772617e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803034710807066e+09	INFO	controller_redis	Redis PodDisruptionBudget get action was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803034711699755e+09	INFO	controller_redis	Changes in PodDisruptionBudget Detected, Updating...	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower", "patch": "{\"spec\":{\"maxUnavailable\":2}}", "Current": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"banzaicloud.com/last-applied\":\"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWykVE9P/DYQ/S5zTpZk/6n41j8qPfSA0MKh3QpN7AlYOLZlOwt0le9e2dkkS7RApd8tnnHejN+8N0dAKx/IeWk0MLBGSf5+dSghgxepBTC4NeI36V1rgzT6l1Y8UYAMGgooMCCwI6DWJmBM+3h0JKRfGOuDI1JY+YWM0MG1BNnFrA+oOcU75EPOVesDOegy4I4S7k425AM2Fhgsi+UqL1b5qtwtl2yzZuvlX5CBwopUqo/WzqFOZR89hdY+hncbi50ljYqB2ihlXvvKDWp8IvG7JCU8sL+/4KlOd3Y9aP/DwxR/KGNPNTsnrGYzyhbAjl0GNatQ/4uSK9OKBTfNlUIfcrRWSRLDncv8fp4b2D126cpE1Fg1MXYG8IGnUzxRdIIwr5rcHdXkSHM6x3phxz20UuyB7WGzwaJYim1eo6jy9XW5yvGncpnXm22x3eK6KMpiD12CTbjeEj+xhW/3Gg8oFVZqbMKTIh6MG/7oh+SAwY3Jn0OwOVeSdNSnseQSv8Dg3goMUXtBNvSZgrrsh0fsA4bW99/caCHn803sRFYTPZOrfk66Ez0X01ji8HcOtZeDB4ZMQ97j03g0lSd3IHFDenz1ME7002lsMJ2G8XZfYHxk+aWtKOdGB2eUIpcPmU/o9m3lyJvWJW+fin8zhX8y0NjMd0E+WrNPe4sJM6k174ub1MdcmXPj9ga5ZJOrQ1lRwDjW6YnA4toad+Fd/O/XcW9c6BSyKH9g/0v86bkDRVOP5fr6Ou6gwQ5zM2wyOHMCNBj485/frL/5houDnfTKW+dIhz8IVXh+B1ZkIMhLR+JDaBSsPyk2henNEg8kbk3clEXX/RcAAP//UEsHCESb+6J6AgAAVAYAAFBLAQIUABQACAAIAAAAAABEm/uiegIAAFQGAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAACwAgAAAAA=\",\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"generation\":2,\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"follower\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-follower\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1818\",\"uid\":\"85b1d12a-32e3-43f9-929a-afaa465d2acf\"},\"spec\":{\"maxUnavailable\":5}}", "Original": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"follower\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-follower\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1499\"},\"spec\":{\"maxUnavailable\":5,\"selector\":{\"matchLabels\":{\"app\":\"test-cluster\",\"role\":\"follower\"}}},\"status\":{\"currentHealthy\":0,\"desiredHealthy\":0,\"disruptionsAllowed\":0,\"expectedPods\":0}}", "Modified": "{\"apiVersion\":\"policy/v1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{\"redis.opstreelabs.in\":\"true\",\"redis.opstreelabs.instance\":\"test-cluster\"},\"creationTimestamp\":\"2023-03-31T22:54:42Z\",\"labels\":{\"app\":\"test-cluster\",\"redis_setup_type\":\"cluster\",\"role\":\"follower\"},\"managedFields\":[{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:annotations\":{\".\":{},\"f:banzaicloud.com/last-applied\":{},\"f:redis.opstreelabs.in\":{},\"f:redis.opstreelabs.instance\":{}},\"f:labels\":{\".\":{},\"f:app\":{},\"f:redis_setup_type\":{},\"f:role\":{}},\"f:ownerReferences\":{\".\":{},\"k:{\\\"uid\\\":\\\"55a002d6-fadb-4913-a812-f56066a40010\\\"}\":{}}},\"f:spec\":{\"f:maxUnavailable\":{},\"f:selector\":{}}},\"manager\":\"Go-http-client\",\"operation\":\"Update\",\"time\":\"2023-03-31T22:54:42Z\"},{\"apiVersion\":\"policy/v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\".\":{},\"k:{\\\"type\\\":\\\"DisruptionAllowed\\\"}\":{\".\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:observedGeneration\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:observedGeneration\":{}}},\"manager\":\"kube-controller-manager\",\"operation\":\"Update\",\"subresource\":\"status\",\"time\":\"2023-03-31T22:54:42Z\"}],\"name\":\"test-cluster-follower\",\"namespace\":\"redis-operator\",\"ownerReferences\":[{\"apiVersion\":\"redis.redis.opstreelabs.in/v1beta1\",\"controller\":true,\"kind\":\"RedisCluster\",\"name\":\"test-cluster\",\"uid\":\"55a002d6-fadb-4913-a812-f56066a40010\"}],\"resourceVersion\":\"1818\"},\"spec\":{\"maxUnavailable\":2}}"}
1.6803034711789935e+09	INFO	controller_redis	Redis PodDisruptionBudget update was successful	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower", "PDB.Spec": {"selector":{"matchLabels":{"app":"test-cluster","role":"follower"}},"maxUnavailable":2}}
1.6803034711836834e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803034712710407e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803034712711031e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803034712775655e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803034712783394e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "2a026be4bdc0be342b75701d43c9bea6a6718a75 10.244.1.6:6379@16379 master - 0 1680303469509 3 connected 10923-16383\n3685a9bd297fb8207b18961fb61b9324bdbeb452 10.244.2.8:6379@16379 master - 0 1680303470713 2 connected 5461-10922\n1ae34473f1518027ba0281cb3826a48dd9d75b02 10.244.1.5:6379@16379 slave 2a026be4bdc0be342b75701d43c9bea6a6718a75 0 1680303469000 3 connected\nb90c8d45d3b39094f01b3f152af555502b5bd71d 10.244.3.5:6379@16379 myself,master - 0 1680303469000 1 connected 0-5460\nb7640a02b7558ff9046833cf49eb7d2f4ba49844 10.244.2.9:6379@16379 slave 3685a9bd297fb8207b18961fb61b9324bdbeb452 0 1680303470612 2 connected\nab37e3469ed76104d61243f59fe85b6f545db764 10.244.3.4:6379@16379 slave b90c8d45d3b39094f01b3f152af555502b5bd71d 0 1680303470000 1 connected\n"}
1.6803034712783928e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803034712784011e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803034712826025e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.5"}
1.6803034712831297e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "2a026be4bdc0be342b75701d43c9bea6a6718a75 10.244.1.6:6379@16379 master - 0 1680303469509 3 connected 10923-16383\n3685a9bd297fb8207b18961fb61b9324bdbeb452 10.244.2.8:6379@16379 master - 0 1680303470713 2 connected 5461-10922\n1ae34473f1518027ba0281cb3826a48dd9d75b02 10.244.1.5:6379@16379 slave 2a026be4bdc0be342b75701d43c9bea6a6718a75 0 1680303469000 3 connected\nb90c8d45d3b39094f01b3f152af555502b5bd71d 10.244.3.5:6379@16379 myself,master - 0 1680303469000 1 connected 0-5460\nb7640a02b7558ff9046833cf49eb7d2f4ba49844 10.244.2.9:6379@16379 slave 3685a9bd297fb8207b18961fb61b9324bdbeb452 0 1680303470612 2 connected\nab37e3469ed76104d61243f59fe85b6f545db764 10.244.3.4:6379@16379 slave b90c8d45d3b39094f01b3f152af555502b5bd71d 0 1680303470000 1 connected\n"}
1.6803034712831786e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 0}

