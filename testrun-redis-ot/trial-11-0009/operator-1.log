MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680308707950949e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
1.6803087080713136e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi0rifOhWzf2LgI0qSFnu4ciMMbUuCJKkSw51NYw9N8XlD/iBNk0hz1sepI4fDOceW843AA69Zl8UNZAAehcyNocBHxTpoIC5oxMq6jnxCCgIcYKGaHYABpjGVlZE9LSU6XC0LrAnkjjMgxVCsg+EogXdwOjkZQwFHggdQxMHjoBGpek+6Do3LP9gSasyO9DLgJxdAteuxRoH0OAtzoZduBOgMHm+VGPodJmcNgn04cdWEce2aZN+7chX9KKPBlJAYovzzjb1vZShVmbL4kx0SmtYW+1Jg9F4uRAcJn8rg+Jv5AnCIgqQa/OT0dXFxIHZ6NzOTir8tXg8oxocLK6rE4uRvnZ1fgUuodOQHAkt6I4rSQGKE4FBNIkU03FBhpkWX/8z3lOR5NvlaS71/hmapxGpj6Td9pSRywnbVEZ8tvmINP2352Us2k5v5nfT++up4vp3YffPk4nIKBFHWlfTCcO6HI6uZkvPkwm5RGoz6vIMm0l6toGLs5PL66O3ebT8vO0XNx+mkyP/B4JOALe/zn7V9yDANXg12T7HnE9VDbbEZxtc2jPhyfDMexgs6j1zGol11DAzerO8sxTIJNGhVYtGQph5u2yF5p+7NlqGkyt/wWWGGoQkMXgs6UyWU2ouZY1yW/DUEPq5BUqHT3d155CbXUFxViAMooV6glpXM9JWlMFKPKxAEde2eqJiVVDNvLBNv7ZMPCElfq/Zu4p2Oj7MbQBrRrF/Z90EQrIR3nTD+nG+qRIfnJ5q6D3+h4pvAHaCWitjg3d2mh4285N+p0h11BA1t/UVwlM8+eXvgMD+uGsZ/JFPhy95SbsTn3qDD/VcvR2LV+Edt1D0jO6Cpnm7JHp6xqKzUHja42qud+N4p3W73QYv96Rj5MapaQQbm3V1wslYfWXV0yfUqIPzyQ5Zjqw9dueyP94ek+qZPxdaQrrwNT0pzFyTG7d9jHeLwFbVBqXmsrDuzwSR4/0qOv+CQAA//9QSwcID+wPY/ECAACQCQAAUEsBAhQAFAAIAAgAAAAAAA/sD2PxAgAAkAkAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAACcDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397","uid":"65f6f46d-cdd1-471a-b74d-e2d283c8188c"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803087080770204e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680308708170278e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803087081740615e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803087081769185e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803087081806703e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803087081807177e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
1.68030870818572e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVd9v2zgM/l/4rMRxf9dvu8Z3KLB2gdPbPQxFwMjMLEyWNInyFgT+3w9yfiwtete+HHDbU2LqI0V+H0ltAJ36SD4oa6AAdC5kXQ4CvihTQwFzRqZV1HNiENASY42MUGwAjbGMrKwJ6dNTrcLYusCeSOMyjFUKyD4SiBdPA6ORlDAUeCR1DEweegEal6SHoOjcs/PRymptv5HfB10E4ugWvHYp1D6KAG91MhzgvQCD7fPrjsOl4+BwSGkIPbKOPLJNh/abIV/RijwZSQGKT8+Y21b4Up1Zly+JMZEqrWFvtSYPRWLmQHOV/G4Oyb+QKQiIKkGvL04n15cSR2eTCzk6q/PV6OqMaHSyuqpPLif52fX5KfSPvYDgSG6lcVpJDFCcCgikSaaaig20yLJ5/5+wna4n3ylJ9//OOlPrNDIN+fzE7XXEd1IZlSG/bRMy3fC7E3VWVvPb+UN5f1Muyvt3v70vpyCgQx1pX1AvDuiqnN7OF++m0+oINGRWZJm2EnVjAxcXp5fXx27zsvpYVou7D9PyyO8HCUfAhz9n/4h7FKBa/JxsXyOux8pmO5KzbQ7dxfhkfA472CxqPbNayTUUcLu6tzzzFMik1aFVR4ZCmHm7HMSm73u22hbTEHyCJYYGBGQx+GypTNYQam5kQ/LLODSQenqFSkdPD42n0FhdQ3EuQBnFCvWUNK7nJK2pAxT5uQBHXtn6iYlVSzbywXb++mLwhLX6v+buKdjoh5W0Aa1axcM/6SIUkE/ydljbrfVJk/zk6k7B4PU1UngDtBfQWR1burPR8Lah2/R3htxAAdkwr69QmLbRLz0HI/rurGfyRT6evGUadrc+dYZX1Zy8Xc0XoX3/mBSNrkamOXtk+ryGYnNQ+Uajah92K3mn9k+8lF/ryx87G6WkEO5sPVQNFWH9l1dMH1K6j8+EOeY7sPXbzsj/eDovdTL+rjSFdWBqh9sYOSa3fvtA7z8BO1Qal5qqw1s9EUcP96Tv/w4AAP//UEsHCA0fHwXyAgAAqgkAAFBLAQIUABQACAAIAAAAAAANHx8F8gIAAKoJAAAIAAAAAAAAAAAAAAAAAAAAAABvcmlnaW5hbFBLBQYAAAAAAQABADYAAAAoAwAAAAA=","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":1,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1402","uid":"2704f3a7-cb5d-43bc-8cbc-8829d56b1be2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803087083703146e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"exec\":{\"command\":[\"ACTOKEY\",\"ACTOKEY\",\"ACTOKEY\",\"ACTOKEY\"]},\"failureThreshold\":4,\"httpGet\":{\"host\":\"ACTOKEY\",\"httpHeaders\":[{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"},{\"name\":\"ACTOKEY\",\"value\":\"ACTOKEY\"}],\"path\":\"ACTOKEY\",\"port\":\"ACTOKEY\",\"scheme\":\"ACTOKEY\"},\"initialDelaySeconds\":1,\"periodSeconds\":2,\"successThreshold\":4,\"tcpSocket\":{\"host\":\"ACTOKEY\",\"port\":\"ACTOKEY\"},\"terminationGracePeriodSeconds\":4,\"timeoutSeconds\":2},\"name\":\"test-cluster-follower\"}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1402"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1402", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 22, 47, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"963097ca-406c-4d1f-84ee-2f8d27014953", Controller:(*bool)(0xc000b8a084), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 22, 47, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000736540), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 23, 22, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000736570), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000b8a080), Selector:(*v1.LabelSelector)(0xc000ca29c0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc000551940), ReadinessProbe:(*v1.Probe)(0xc0005a3d00), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000a8b850), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803087086706164e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803087086757104e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803087087696462e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803087087746432e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680308708777881e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.68030870878138e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680308708781415e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803087087857962e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803087087894506e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680308708789488e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803087087935922e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.680308708869581e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "a6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 0 0 connected\n"}
1.6803087088696554e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "1"}
1.6803087088760335e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803087088766344e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "a6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 0 0 connected\n"}
1.6803087088766751e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "1", "Type": "leader"}
1.6803087088766859e+09	INFO	controllers.RedisCluster	Not all leader are part of the cluster...	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 1, "Instance.Size": 3}
1.6803087088813467e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803087088845067e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-1", "ip": "10.244.2.6"}
1.680308708971915e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-2", "ip": "10.244.1.5"}
1.6803087089719846e+09	INFO	controller_redis	Redis cluster creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "create", "10.244.3.9:6379", "10.244.2.6:6379", "10.244.1.5:6379", "--cluster-yes"]}
1.6803087089782324e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.6803087135833414e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "create", "10.244.3.9:6379", "10.244.2.6:6379", "10.244.1.5:6379", "--cluster-yes"], "Output": ">>> Performing hash slots allocation on 3 nodes...\nMaster[0] -> Slots 0 - 5460\nMaster[1] -> Slots 5461 - 10922\nMaster[2] -> Slots 10923 - 16383\nM: a6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379\n   slots:[0-5460] (5461 slots) master\nM: 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\nM: 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379\n   slots:[10923-16383] (5461 slots) master\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n...\n>>> Performing Cluster Check (using node 10.244.3.9:6379)\nM: a6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379\n   slots:[0-5460] (5461 slots) master\nM: 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\nM: 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379\n   slots:[10923-16383] (5461 slots) master\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n"}
1.6803087135834675e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
1.6803087135835502e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803087135949044e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi0rifOhWzf2LgI0qSFnu4ciMMbUuCJKkSw51NYw9N8XlD/iBNk0hz1sepI4fDOceW843AA69Zl8UNZAAehcyNocBHxTpoIC5oxMq6jnxCCgIcYKGaHYABpjGVlZE9LSU6XC0LrAnkjjMgxVCsg+EogXdwOjkZQwFHggdQxMHjoBGpek+6Do3LP9gSasyO9DLgJxdAteuxRoH0OAtzoZduBOgMHm+VGPodJmcNgn04cdWEce2aZN+7chX9KKPBlJAYovzzjb1vZShVmbL4kx0SmtYW+1Jg9F4uRAcJn8rg+Jv5AnCIgqQa/OT0dXFxIHZ6NzOTir8tXg8oxocLK6rE4uRvnZ1fgUuodOQHAkt6I4rSQGKE4FBNIkU03FBhpkWX/8z3lOR5NvlaS71/hmapxGpj6Td9pSRywnbVEZ8tvmINP2352Us2k5v5nfT++up4vp3YffPk4nIKBFHWlfTCcO6HI6uZkvPkwm5RGoz6vIMm0l6toGLs5PL66O3ebT8vO0XNx+mkyP/B4JOALe/zn7V9yDANXg12T7HnE9VDbbEZxtc2jPhyfDMexgs6j1zGol11DAzerO8sxTIJNGhVYtGQph5u2yF5p+7NlqGkyt/wWWGGoQkMXgs6UyWU2ouZY1yW/DUEPq5BUqHT3d155CbXUFxViAMooV6glpXM9JWlMFKPKxAEde2eqJiVVDNvLBNv7ZMPCElfq/Zu4p2Oj7MbQBrRrF/Z90EQrIR3nTD+nG+qRIfnJ5q6D3+h4pvAHaCWitjg3d2mh4285N+p0h11BA1t/UVwlM8+eXvgMD+uGsZ/JFPhy95SbsTn3qDD/VcvR2LV+Edt1D0jO6Cpnm7JHp6xqKzUHja42qud+N4p3W73QYv96Rj5MapaQQbm3V1wslYfWXV0yfUqIPzyQ5Zjqw9dueyP94ek+qZPxdaQrrwNT0pzFyTG7d9jHeLwFbVBqXmsrDuzwSR4/0qOv+CQAA//9QSwcID+wPY/ECAACQCQAAUEsBAhQAFAAIAAgAAAAAAA/sD2PxAgAAkAkAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAACcDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397","uid":"65f6f46d-cdd1-471a-b74d-e2d283c8188c"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803087136764934e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803087136812935e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803087137709458e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680308713775664e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803087137784646e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803087137816234e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803087137816525e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803087137851715e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"terminationGracePeriodSeconds":4},"name":"test-cluster-follower"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1500","uid":"2704f3a7-cb5d-43bc-8cbc-8829d56b1be2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803087141745675e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"terminationGracePeriodSeconds\":4},\"name\":\"test-cluster-follower\"}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1500"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1402"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1500", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 22, 47, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"963097ca-406c-4d1f-84ee-2f8d27014953", Controller:(*bool)(0xc000b8ba24), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000a93f68), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000a93f98), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000b8ba20), Selector:(*v1.LabelSelector)(0xc0008bdc00), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc0001aca00), ReadinessProbe:(*v1.Probe)(0xc000824480), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000c82d80), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.680308714269843e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803087142791557e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803087142805417e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803087142831686e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680308714284914e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803087143749063e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680308714374978e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803087146703436e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803087146757174e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680308714675765e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803087147741523e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803087147746487e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680308714690 2 connected 5461-10922\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680308714590 3 connected 10923-16383\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680308714000 1 connected 0-5460\n"}
1.6803087147748048e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3"}
1.6803087147780588e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803087147786796e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680308714690 2 connected 5461-10922\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680308714590 3 connected 10923-16383\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680308714000 1 connected 0-5460\n"}
1.6803087147787826e+09	INFO	controller_redis	Number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "3", "Type": "leader"}
1.6803087147787905e+09	INFO	controllers.RedisCluster	All leader are part of the cluster, adding follower/replicas	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Count": 3, "Instance.Size": 3, "Follower.Replicas": 3}
1.6803087148711424e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.680308714872094e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680308714690 2 connected 5461-10922\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680308714590 3 connected 10923-16383\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680308714000 1 connected 0-5460\n"}
1.6803087148783839e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-0", "ip": "10.244.3.8"}
1.6803087148784547e+09	INFO	controller_redis	Checking if Node is in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node": "10.244.3.8"}
1.6803087148784778e+09	INFO	controller_redis	Adding node to cluster.	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node.IP": "10.244.3.8", "Follower.Pod": {"PodName":"test-cluster-follower-0","Namespace":"redis-operator"}}
1.6803087149699323e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-0", "ip": "10.244.3.8"}
1.6803087149766176e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803087149766939e+09	INFO	controller_redis	Redis replication creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.3.8:6379", "10.244.3.9:6379", "--cluster-slave"]}
1.6803087149814048e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.6803087161823437e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.3.8:6379", "10.244.3.9:6379", "--cluster-slave"], "Output": ">>> Adding node 10.244.3.8:6379 to cluster 10.244.3.9:6379\n>>> Performing Cluster Check (using node 10.244.3.9:6379)\nM: a6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379\n   slots:[0-5460] (5461 slots) master\nM: 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\nM: 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379\n   slots:[10923-16383] (5461 slots) master\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nAutomatically selected master 10.244.3.9:6379\n>>> Send CLUSTER MEET to node 10.244.3.8:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 10.244.3.9:6379.\n[OK] New node added correctly.\n"}
1.6803087161893084e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-1", "ip": "10.244.2.5"}
1.680308716189347e+09	INFO	controller_redis	Checking if Node is in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node": "10.244.2.5"}
1.680308716189357e+09	INFO	controller_redis	Adding node to cluster.	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node.IP": "10.244.2.5", "Follower.Pod": {"PodName":"test-cluster-follower-1","Namespace":"redis-operator"}}
1.6803087161926131e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-1", "ip": "10.244.2.5"}
1.6803087161955512e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-1", "ip": "10.244.2.6"}
1.680308716195578e+09	INFO	controller_redis	Redis replication creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.2.5:6379", "10.244.2.6:6379", "--cluster-slave"]}
1.6803087162700183e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.6803087174847162e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.2.5:6379", "10.244.2.6:6379", "--cluster-slave"], "Output": ">>> Adding node 10.244.2.5:6379 to cluster 10.244.2.6:6379\n>>> Performing Cluster Check (using node 10.244.2.6:6379)\nM: 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\nS: 3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379\n   slots: (0 slots) slave\n   replicates a6a189cea1c1a688c57b4a92d9338ddd08d5b704\nM: 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379\n   slots:[10923-16383] (5461 slots) master\nM: a6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nAutomatically selected master 10.244.2.6:6379\n>>> Send CLUSTER MEET to node 10.244.2.5:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 10.244.2.6:6379.\n[OK] New node added correctly.\n"}
1.6803087174939606e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-2", "ip": "10.244.1.4"}
1.6803087174940157e+09	INFO	controller_redis	Checking if Node is in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node": "10.244.1.4"}
1.6803087174940276e+09	INFO	controller_redis	Adding node to cluster.	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Node.IP": "10.244.1.4", "Follower.Pod": {"PodName":"test-cluster-follower-2","Namespace":"redis-operator"}}
1.680308717497852e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-follower-2", "ip": "10.244.1.4"}
1.6803087175019522e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-2", "ip": "10.244.1.5"}
1.6803087175019858e+09	INFO	controller_redis	Redis replication creation command is	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.1.4:6379", "10.244.1.5:6379", "--cluster-slave"]}
1.6803087175761735e+09	INFO	controller_redis	Pod Counted successfully	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Count": 0, "Container Name": "test-cluster-leader"}
1.6803087186890516e+09	INFO	controller_redis	Successfully executed the command	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Command": ["redis-cli", "--cluster", "add-node", "10.244.1.4:6379", "10.244.1.5:6379", "--cluster-slave"], "Output": ">>> Adding node 10.244.1.4:6379 to cluster 10.244.1.5:6379\n>>> Performing Cluster Check (using node 10.244.1.5:6379)\nM: 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379\n   slots:[10923-16383] (5461 slots) master\nM: a6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: 3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379\n   slots: (0 slots) slave\n   replicates a6a189cea1c1a688c57b4a92d9338ddd08d5b704\nM: 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379\n   slots:[5461-10922] (5462 slots) master\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nAutomatically selected master 10.244.1.5:6379\n>>> Send CLUSTER MEET to node 10.244.1.4:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 10.244.1.5:6379.\n[OK] New node added correctly.\n"}
1.6803087186891067e+09	INFO	controllers.RedisCluster	Will reconcile redis cluster operator in again 10 seconds	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.680308723584036e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
MATT IS HERE: patchStatefulSet
1.6803087235906448e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi0rifOhWzf2LgI0qSFnu4ciMMbUuCJKkSw51NYw9N8XlD/iBNk0hz1sepI4fDOceW843AA69Zl8UNZAAehcyNocBHxTpoIC5oxMq6jnxCCgIcYKGaHYABpjGVlZE9LSU6XC0LrAnkjjMgxVCsg+EogXdwOjkZQwFHggdQxMHjoBGpek+6Do3LP9gSasyO9DLgJxdAteuxRoH0OAtzoZduBOgMHm+VGPodJmcNgn04cdWEce2aZN+7chX9KKPBlJAYovzzjb1vZShVmbL4kx0SmtYW+1Jg9F4uRAcJn8rg+Jv5AnCIgqQa/OT0dXFxIHZ6NzOTir8tXg8oxocLK6rE4uRvnZ1fgUuodOQHAkt6I4rSQGKE4FBNIkU03FBhpkWX/8z3lOR5NvlaS71/hmapxGpj6Td9pSRywnbVEZ8tvmINP2352Us2k5v5nfT++up4vp3YffPk4nIKBFHWlfTCcO6HI6uZkvPkwm5RGoz6vIMm0l6toGLs5PL66O3ebT8vO0XNx+mkyP/B4JOALe/zn7V9yDANXg12T7HnE9VDbbEZxtc2jPhyfDMexgs6j1zGol11DAzerO8sxTIJNGhVYtGQph5u2yF5p+7NlqGkyt/wWWGGoQkMXgs6UyWU2ouZY1yW/DUEPq5BUqHT3d155CbXUFxViAMooV6glpXM9JWlMFKPKxAEde2eqJiVVDNvLBNv7ZMPCElfq/Zu4p2Oj7MbQBrRrF/Z90EQrIR3nTD+nG+qRIfnJ5q6D3+h4pvAHaCWitjg3d2mh4285N+p0h11BA1t/UVwlM8+eXvgMD+uGsZ/JFPhy95SbsTn3qDD/VcvR2LV+Edt1D0jO6Cpnm7JHp6xqKzUHja42qud+N4p3W73QYv96Rj5MapaQQbm3V1wslYfWXV0yfUqIPzyQ5Zjqw9dueyP94ek+qZPxdaQrrwNT0pzFyTG7d9jHeLwFbVBqXmsrDuzwSR4/0qOv+CQAA//9QSwcID+wPY/ECAACQCQAAUEsBAhQAFAAIAAgAAAAAAA/sD2PxAgAAkAkAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAACcDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397","uid":"65f6f46d-cdd1-471a-b74d-e2d283c8188c"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803087237727892e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680308723870071e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803087238727202e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680308723877467e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803087239702034e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803087239742568e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803087239743035e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680308723977964e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"terminationGracePeriodSeconds":4},"name":"test-cluster-follower"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1514","uid":"2704f3a7-cb5d-43bc-8cbc-8829d56b1be2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803087240732937e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"terminationGracePeriodSeconds\":4},\"name\":\"test-cluster-follower\"}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1514"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1500"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1514", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 22, 47, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"963097ca-406c-4d1f-84ee-2f8d27014953", Controller:(*bool)(0xc000f8ccdc), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc0008b7530), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc0008b7560), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000f8ccd8), Selector:(*v1.LabelSelector)(0xc000ca27e0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc000bc8740), ReadinessProbe:(*v1.Probe)(0xc0007b70c0), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000d45550), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.680308724470438e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803087244829288e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680308724484806e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803087244886136e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803087244922605e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680308724496511e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803087244965572e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803087245023894e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803087245762534e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803087245763052e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "3"}
1.6803087245821075e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803087245831125e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680308723094 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680308722000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 0 1680308723799 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680308723597 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680308723000 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680308723000 2 connected\n"}
1.68030872458316e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803087245831678e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803087246711633e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.680308724672301e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680308723094 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680308722000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 0 1680308723799 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680308723597 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680308723000 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680308723000 2 connected\n"}
1.68030872467235e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 0}
1.6803088446728048e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.680308844682131e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi0rifOhWzf2LgI0qSFnu4ciMMbUuCJKkSw51NYw9N8XlD/iBNk0hz1sepI4fDOceW843AA69Zl8UNZAAehcyNocBHxTpoIC5oxMq6jnxCCgIcYKGaHYABpjGVlZE9LSU6XC0LrAnkjjMgxVCsg+EogXdwOjkZQwFHggdQxMHjoBGpek+6Do3LP9gSasyO9DLgJxdAteuxRoH0OAtzoZduBOgMHm+VGPodJmcNgn04cdWEce2aZN+7chX9KKPBlJAYovzzjb1vZShVmbL4kx0SmtYW+1Jg9F4uRAcJn8rg+Jv5AnCIgqQa/OT0dXFxIHZ6NzOTir8tXg8oxocLK6rE4uRvnZ1fgUuodOQHAkt6I4rSQGKE4FBNIkU03FBhpkWX/8z3lOR5NvlaS71/hmapxGpj6Td9pSRywnbVEZ8tvmINP2352Us2k5v5nfT++up4vp3YffPk4nIKBFHWlfTCcO6HI6uZkvPkwm5RGoz6vIMm0l6toGLs5PL66O3ebT8vO0XNx+mkyP/B4JOALe/zn7V9yDANXg12T7HnE9VDbbEZxtc2jPhyfDMexgs6j1zGol11DAzerO8sxTIJNGhVYtGQph5u2yF5p+7NlqGkyt/wWWGGoQkMXgs6UyWU2ouZY1yW/DUEPq5BUqHT3d155CbXUFxViAMooV6glpXM9JWlMFKPKxAEde2eqJiVVDNvLBNv7ZMPCElfq/Zu4p2Oj7MbQBrRrF/Z90EQrIR3nTD+nG+qRIfnJ5q6D3+h4pvAHaCWitjg3d2mh4285N+p0h11BA1t/UVwlM8+eXvgMD+uGsZ/JFPhy95SbsTn3qDD/VcvR2LV+Edt1D0jO6Cpnm7JHp6xqKzUHja42qud+N4p3W73QYv96Rj5MapaQQbm3V1wslYfWXV0yfUqIPzyQ5Zjqw9dueyP94ek+qZPxdaQrrwNT0pzFyTG7d9jHeLwFbVBqXmsrDuzwSR4/0qOv+CQAA//9QSwcID+wPY/ECAACQCQAAUEsBAhQAFAAIAAgAAAAAAA/sD2PxAgAAkAkAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAACcDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397","uid":"65f6f46d-cdd1-471a-b74d-e2d283c8188c"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803088449720492e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803088449794922e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803088450713415e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803088450775816e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803088450799327e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803088450830977e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.680308845083143e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803088451706388e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"terminationGracePeriodSeconds":4},"name":"test-cluster-follower"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1586","uid":"2704f3a7-cb5d-43bc-8cbc-8829d56b1be2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1586"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1514"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803088455744815e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"terminationGracePeriodSeconds\":4},\"name\":\"test-cluster-follower\"}]}}}}"}
MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1586", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 22, 47, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"963097ca-406c-4d1f-84ee-2f8d27014953", Controller:(*bool)(0xc000cdc284), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000ce4138), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000ce4168), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc000cdc280), Selector:(*v1.LabelSelector)(0xc000b220c0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc000bc85c0), ReadinessProbe:(*v1.Probe)(0xc000824600), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000b0a2b0), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803088457710786e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680308845776901e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803088457798276e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.680308845783607e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803088458704927e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803088458759508e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803088458760376e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803088458816986e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803088459712667e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803088459713354e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "2"}
1.6803088462702625e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.680308846271244e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680308844000 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680308844000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave,fail 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 1680308739568 1680308737000 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680308845048 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680308844546 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680308845350 2 connected\n"}
1.6803088462713048e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803088462713149e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803088462776735e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803088462785738e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680308844000 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680308844000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave,fail 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 1680308739568 1680308737000 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680308845048 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680308844546 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680308845350 2 connected\n"}
1.6803088462786477e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 1}
1.680308966278988e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803089662865796e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi0rifOhWzf2LgI0qSFnu4ciMMbUuCJKkSw51NYw9N8XlD/iBNk0hz1sepI4fDOceW843AA69Zl8UNZAAehcyNocBHxTpoIC5oxMq6jnxCCgIcYKGaHYABpjGVlZE9LSU6XC0LrAnkjjMgxVCsg+EogXdwOjkZQwFHggdQxMHjoBGpek+6Do3LP9gSasyO9DLgJxdAteuxRoH0OAtzoZduBOgMHm+VGPodJmcNgn04cdWEce2aZN+7chX9KKPBlJAYovzzjb1vZShVmbL4kx0SmtYW+1Jg9F4uRAcJn8rg+Jv5AnCIgqQa/OT0dXFxIHZ6NzOTir8tXg8oxocLK6rE4uRvnZ1fgUuodOQHAkt6I4rSQGKE4FBNIkU03FBhpkWX/8z3lOR5NvlaS71/hmapxGpj6Td9pSRywnbVEZ8tvmINP2352Us2k5v5nfT++up4vp3YffPk4nIKBFHWlfTCcO6HI6uZkvPkwm5RGoz6vIMm0l6toGLs5PL66O3ebT8vO0XNx+mkyP/B4JOALe/zn7V9yDANXg12T7HnE9VDbbEZxtc2jPhyfDMexgs6j1zGol11DAzerO8sxTIJNGhVYtGQph5u2yF5p+7NlqGkyt/wWWGGoQkMXgs6UyWU2ouZY1yW/DUEPq5BUqHT3d155CbXUFxViAMooV6glpXM9JWlMFKPKxAEde2eqJiVVDNvLBNv7ZMPCElfq/Zu4p2Oj7MbQBrRrF/Z90EQrIR3nTD+nG+qRIfnJ5q6D3+h4pvAHaCWitjg3d2mh4285N+p0h11BA1t/UVwlM8+eXvgMD+uGsZ/JFPhy95SbsTn3qDD/VcvR2LV+Edt1D0jO6Cpnm7JHp6xqKzUHja42qud+N4p3W73QYv96Rj5MapaQQbm3V1wslYfWXV0yfUqIPzyQ5Zjqw9dueyP94ek+qZPxdaQrrwNT0pzFyTG7d9jHeLwFbVBqXmsrDuzwSR4/0qOv+CQAA//9QSwcID+wPY/ECAACQCQAAUEsBAhQAFAAIAAgAAAAAAA/sD2PxAgAAkAkAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAACcDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397","uid":"65f6f46d-cdd1-471a-b74d-e2d283c8188c"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803089665711174e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803089665777977e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803089666723137e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803089666770186e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803089666796365e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803089666831346e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803089666831577e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.680308966769999e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"terminationGracePeriodSeconds":4},"name":"test-cluster-follower"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1870","uid":"2704f3a7-cb5d-43bc-8cbc-8829d56b1be2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1870"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1586"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.680308966775805e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"terminationGracePeriodSeconds\":4},\"name\":\"test-cluster-follower\"}]}}}}"}
MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"1870", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 22, 47, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"963097ca-406c-4d1f-84ee-2f8d27014953", Controller:(*bool)(0xc0011200b4), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000283698), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc0002836c8), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc0011200b0), Selector:(*v1.LabelSelector)(0xc0007ca4c0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc0008b4680), ReadinessProbe:(*v1.Probe)(0xc001036cc0), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc00098fb10), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.680308967083826e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680308967088608e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803089671701078e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803089671743934e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803089671768236e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803089671796541e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680308967179693e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.680308967183976e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803089672702458e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803089672702856e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "2"}
1.6803089672763355e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803089672772653e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680308966000 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680308963000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave,fail 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 1680308739568 1680308737000 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680308965850 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680308965048 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680308966854 2 connected\n"}
1.6803089672773619e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803089672773814e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803089673713906e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803089673721569e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680308966000 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680308963000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave,fail 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 1680308739568 1680308737000 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680308965850 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680308965048 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680308966854 2 connected\n"}
1.680308967372222e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 1}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
MATT IS HERE: CreateRedisClusterSetup
1.6803090873734784e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: CreateOrUpdateStateFul
1.680309087384087e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi0rifOhWzf2LgI0qSFnu4ciMMbUuCJKkSw51NYw9N8XlD/iBNk0hz1sepI4fDOceW843AA69Zl8UNZAAehcyNocBHxTpoIC5oxMq6jnxCCgIcYKGaHYABpjGVlZE9LSU6XC0LrAnkjjMgxVCsg+EogXdwOjkZQwFHggdQxMHjoBGpek+6Do3LP9gSasyO9DLgJxdAteuxRoH0OAtzoZduBOgMHm+VGPodJmcNgn04cdWEce2aZN+7chX9KKPBlJAYovzzjb1vZShVmbL4kx0SmtYW+1Jg9F4uRAcJn8rg+Jv5AnCIgqQa/OT0dXFxIHZ6NzOTir8tXg8oxocLK6rE4uRvnZ1fgUuodOQHAkt6I4rSQGKE4FBNIkU03FBhpkWX/8z3lOR5NvlaS71/hmapxGpj6Td9pSRywnbVEZ8tvmINP2352Us2k5v5nfT++up4vp3YffPk4nIKBFHWlfTCcO6HI6uZkvPkwm5RGoz6vIMm0l6toGLs5PL66O3ebT8vO0XNx+mkyP/B4JOALe/zn7V9yDANXg12T7HnE9VDbbEZxtc2jPhyfDMexgs6j1zGol11DAzerO8sxTIJNGhVYtGQph5u2yF5p+7NlqGkyt/wWWGGoQkMXgs6UyWU2ouZY1yW/DUEPq5BUqHT3d155CbXUFxViAMooV6glpXM9JWlMFKPKxAEde2eqJiVVDNvLBNv7ZMPCElfq/Zu4p2Oj7MbQBrRrF/Z90EQrIR3nTD+nG+qRIfnJ5q6D3+h4pvAHaCWitjg3d2mh4285N+p0h11BA1t/UVwlM8+eXvgMD+uGsZ/JFPhy95SbsTn3qDD/VcvR2LV+Edt1D0jO6Cpnm7JHp6xqKzUHja42qud+N4p3W73QYv96Rj5MapaQQbm3V1wslYfWXV0yfUqIPzyQ5Zjqw9dueyP94ek+qZPxdaQrrwNT0pzFyTG7d9jHeLwFbVBqXmsrDuzwSR4/0qOv+CQAA//9QSwcID+wPY/ECAACQCQAAUEsBAhQAFAAIAAgAAAAAAA/sD2PxAgAAkAkAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAACcDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397","uid":"65f6f46d-cdd1-471a-b74d-e2d283c8188c"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803090877755694e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803090877794092e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803090878709226e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.680309087876581e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803090879721687e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803090879769928e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803090879770281e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803090879813688e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"terminationGracePeriodSeconds":4},"name":"test-cluster-follower"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"2173","uid":"2704f3a7-cb5d-43bc-8cbc-8829d56b1be2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803090880703979e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"terminationGracePeriodSeconds\":4},\"name\":\"test-cluster-follower\"}]}}}}"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"2173"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1870"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"2173", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 22, 47, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"963097ca-406c-4d1f-84ee-2f8d27014953", Controller:(*bool)(0xc0007a0a14), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000a92108), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000a92150), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc0007a0a10), Selector:(*v1.LabelSelector)(0xc000b9f1e0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc000bc9b40), ReadinessProbe:(*v1.Probe)(0xc0008b4ec0), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc000da4e80), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803090883820837e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803090884745777e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803090884775712e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803090884820063e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.680309088572171e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803090885765784e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803090885766144e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803090885813873e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803090886709006e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.680309088670964e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "2"}
1.6803090886767087e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803090886777954e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680309087409 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680309086000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave,fail 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 1680308739568 1680308737000 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680309088414 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680309087410 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680309088112 2 connected\n"}
1.6803090886778777e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.6803090886778855e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.6803090886831715e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803090886840856e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680309087409 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680309086000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave,fail 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 1680308739568 1680308737000 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680309088414 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680309087410 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680309088112 2 connected\n"}
1.6803090886841502e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 1}
MATT IS HERE: Reconcile
MATT IS HERE: CreateRedisLeader
1.680309208684446e+09	INFO	controllers.RedisCluster	Reconciling opstree redis Cluster controller	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803092086936848e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() true, patchResult 
Patch: {} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"UEsDBBQACAAIAAAAAAAAAAAAAAAAAAAAAAAIAAAAb3JpZ2luYWzcVU1v2zgQ/S9zpi0rifOhWzf2LgI0qSFnu4ciMMbUuCJKkSw51NYw9N8XlD/iBNk0hz1sepI4fDOceW843AA69Zl8UNZAAehcyNocBHxTpoIC5oxMq6jnxCCgIcYKGaHYABpjGVlZE9LSU6XC0LrAnkjjMgxVCsg+EogXdwOjkZQwFHggdQxMHjoBGpek+6Do3LP9gSasyO9DLgJxdAteuxRoH0OAtzoZduBOgMHm+VGPodJmcNgn04cdWEce2aZN+7chX9KKPBlJAYovzzjb1vZShVmbL4kx0SmtYW+1Jg9F4uRAcJn8rg+Jv5AnCIgqQa/OT0dXFxIHZ6NzOTir8tXg8oxocLK6rE4uRvnZ1fgUuodOQHAkt6I4rSQGKE4FBNIkU03FBhpkWX/8z3lOR5NvlaS71/hmapxGpj6Td9pSRywnbVEZ8tvmINP2352Us2k5v5nfT++up4vp3YffPk4nIKBFHWlfTCcO6HI6uZkvPkwm5RGoz6vIMm0l6toGLs5PL66O3ebT8vO0XNx+mkyP/B4JOALe/zn7V9yDANXg12T7HnE9VDbbEZxtc2jPhyfDMexgs6j1zGol11DAzerO8sxTIJNGhVYtGQph5u2yF5p+7NlqGkyt/wWWGGoQkMXgs6UyWU2ouZY1yW/DUEPq5BUqHT3d155CbXUFxViAMooV6glpXM9JWlMFKPKxAEde2eqJiVVDNvLBNv7ZMPCElfq/Zu4p2Oj7MbQBrRrF/Z90EQrIR3nTD+nG+qRIfnJ5q6D3+h4pvAHaCWitjg3d2mh4285N+p0h11BA1t/UVwlM8+eXvgMD+uGsZ/JFPhy95SbsTn3qDD/VcvR2LV+Edt1D0jO6Cpnm7JHp6xqKzUHja42qud+N4p3W73QYv96Rj5MapaQQbm3V1wslYfWXV0yfUqIPzyQ5Zjqw9dueyP94ek+qZPxdaQrrwNT0pzFyTG7d9jHeLwFbVBqXmsrDuzwSR4/0qOv+CQAA//9QSwcID+wPY/ECAACQCQAAUEsBAhQAFAAIAAgAAAAAAA/sD2PxAgAAkAkAAAgAAAAAAAAAAAAAAAAAAAAAAG9yaWdpbmFsUEsFBgAAAAABAAEANgAAACcDAAAAAA==","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":1,"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397","uid":"65f6f46d-cdd1-471a-b74d-e2d283c8188c"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
1.6803092089750276e+09	INFO	controller_redis	Reconciliation Complete, no Changes required.	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-leader\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:22:47Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:23:22Z"}],"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"1397"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}]},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"serviceName":"test-cluster-leader","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"name":"test-cluster-leader","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-leader"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-leader","redis_setup_type":"cluster","role":"leader"},"name":"test-cluster-leader"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803092090702016e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803092090730197e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader-headless"}
1.6803092090772738e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
1.6803092091713598e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-leader"}
MATT IS HERE: CreateRedisFollower
MATT IS HERE: CreateRedisClusterSetup
MATT IS HERE: CreateOrUpdateStateFul
1.6803092091758204e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803092091758676e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-leader"}
1.6803092091806316e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
MATT IS HERE: patchStatefulSet
MATT IS HERE: patchResult.IsEmpty() false, patchResult 
Patch: {"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"test-cluster-follower"},{"name":"redis-exporter"}],"containers":[{"livenessProbe":{"terminationGracePeriodSeconds":4},"name":"test-cluster-follower"}]}}}} 
Current: {"metadata":{"annotations":{"banzaicloud.com/last-applied":"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","redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","generation":2,"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"2476","uid":"2704f3a7-cb5d-43bc-8cbc-8829d56b1be2"},"spec":{"podManagementPolicy":"OrderedReady","replicas":3,"revisionHistoryLimit":10,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File"}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"terminationGracePeriodSeconds":30}},"updateStrategy":{"rollingUpdate":{"partition":0},"type":"RollingUpdate"},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Modified: {"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"2476"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]}}
Original: {"apiVersion":"apps/v1","kind":"StatefulSet","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"creationTimestamp":"2023-04-01T00:22:47Z","labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:banzaicloud.com/last-applied":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}},"f:ownerReferences":{".":{},"k:{\"uid\":\"963097ca-406c-4d1f-84ee-2f8d27014953\"}":{}}},"f:spec":{"f:podManagementPolicy":{},"f:replicas":{},"f:revisionHistoryLimit":{},"f:selector":{},"f:serviceName":{},"f:template":{"f:metadata":{"f:annotations":{".":{},"f:redis.opstreelabs.in":{},"f:redis.opstreelabs.instance":{}},"f:labels":{".":{},"f:app":{},"f:redis_setup_type":{},"f:role":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"redis-exporter\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:name":{},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{}},"k:{\"name\":\"test-cluster-follower\"}":{".":{},"f:env":{".":{},"k:{\"name\":\"PERSISTENCE_ENABLED\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"REDIS_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVER_MODE\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SETUP_MODE\"}":{".":{},"f:name":{},"f:value":{}}},"f:image":{},"f:imagePullPolicy":{},"f:livenessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:httpGet":{".":{},"f:host":{},"f:httpHeaders":{},"f:path":{},"f:port":{},"f:scheme":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:tcpSocket":{".":{},"f:host":{},"f:port":{}},"f:terminationGracePeriodSeconds":{},"f:timeoutSeconds":{}},"f:name":{},"f:readinessProbe":{".":{},"f:exec":{".":{},"f:command":{}},"f:failureThreshold":{},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:successThreshold":{},"f:timeoutSeconds":{}},"f:resources":{".":{},"f:limits":{".":{},"f:cpu":{},"f:memory":{}},"f:requests":{".":{},"f:cpu":{},"f:memory":{}}},"f:terminationMessagePath":{},"f:terminationMessagePolicy":{},"f:volumeMounts":{".":{},"k:{\"mountPath\":\"/data\"}":{".":{},"f:mountPath":{},"f:name":{}}}}},"f:dnsPolicy":{},"f:restartPolicy":{},"f:schedulerName":{},"f:securityContext":{},"f:terminationGracePeriodSeconds":{}}},"f:updateStrategy":{"f:rollingUpdate":{".":{},"f:partition":{}},"f:type":{}},"f:volumeClaimTemplates":{}}},"manager":"Go-http-client","operation":"Update","time":"2023-04-01T00:25:08Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:availableReplicas":{},"f:collisionCount":{},"f:currentReplicas":{},"f:currentRevision":{},"f:observedGeneration":{},"f:readyReplicas":{},"f:replicas":{},"f:updateRevision":{}}},"manager":"kube-controller-manager","operation":"Update","subresource":"status","time":"2023-04-01T00:25:08Z"}],"name":"test-cluster-follower","namespace":"redis-operator","ownerReferences":[{"apiVersion":"redis.redis.opstreelabs.in/v1beta1","controller":true,"kind":"RedisCluster","name":"test-cluster","uid":"963097ca-406c-4d1f-84ee-2f8d27014953"}],"resourceVersion":"2173"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"serviceName":"test-cluster-follower","template":{"metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"}},"spec":{"containers":[{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis:v6.2.5","imagePullPolicy":"IfNotPresent","livenessProbe":{"exec":{"command":["ACTOKEY","ACTOKEY","ACTOKEY","ACTOKEY"]},"failureThreshold":4,"httpGet":{"host":"ACTOKEY","httpHeaders":[{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"},{"name":"ACTOKEY","value":"ACTOKEY"}],"path":"ACTOKEY","port":"ACTOKEY","scheme":"ACTOKEY"},"initialDelaySeconds":1,"periodSeconds":2,"successThreshold":4,"tcpSocket":{"host":"ACTOKEY","port":"ACTOKEY"},"terminationGracePeriodSeconds":4,"timeoutSeconds":2},"name":"test-cluster-follower","readinessProbe":{"exec":{"command":["bash","/usr/bin/healthcheck.sh"]},"failureThreshold":5,"initialDelaySeconds":15,"periodSeconds":15,"timeoutSeconds":5},"resources":{"limits":{"cpu":"101m","memory":"128Mi"},"requests":{"cpu":"101m","memory":"128Mi"}},"volumeMounts":[{"mountPath":"/data","name":"test-cluster-follower"}]},{"env":[{"name":"PERSISTENCE_ENABLED","value":"true"},{"name":"REDIS_ADDR","value":"redis://localhost:6379"},{"name":"SERVER_MODE","value":"cluster"},{"name":"SETUP_MODE","value":"cluster"}],"image":"quay.io/opstree/redis-exporter:1.0","imagePullPolicy":"IfNotPresent","name":"redis-exporter","resources":{"limits":{"cpu":"100m","memory":"128Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}}]}},"updateStrategy":{},"volumeClaimTemplates":[{"apiVersion":"v1","kind":"PersistentVolumeClaim","metadata":{"annotations":{"redis.opstreelabs.in":"true","redis.opstreelabs.instance":"test-cluster"},"labels":{"app":"test-cluster-follower","redis_setup_type":"cluster","role":"follower"},"name":"test-cluster-follower"},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}},"volumeMode":"Filesystem"},"status":{"phase":"Pending"}}]},"status":{"availableReplicas":0,"replicas":0}}

1.6803092096735334e+09	INFO	controller_redis	Changes in statefulset Detected, Updating...	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower", "patch": "{\"spec\":{\"template\":{\"spec\":{\"$setElementOrder/containers\":[{\"name\":\"test-cluster-follower\"},{\"name\":\"redis-exporter\"}],\"containers\":[{\"livenessProbe\":{\"terminationGracePeriodSeconds\":4},\"name\":\"test-cluster-follower\"}]}}}}"}
MATT IS HERE: updateStatefulSet &v1.StatefulSet{TypeMeta:v1.TypeMeta{Kind:"StatefulSet", APIVersion:"apps/v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"redis-operator", SelfLink:"", UID:"", ResourceVersion:"2476", Generation:0, CreationTimestamp:time.Date(2023, time.April, 1, 0, 22, 47, 0, time.Local), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"banzaicloud.com/last-applied":"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", "redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference{v1.OwnerReference{APIVersion:"redis.redis.opstreelabs.in/v1beta1", Kind:"RedisCluster", Name:"test-cluster", UID:"963097ca-406c-4d1f-84ee-2f8d27014953", Controller:(*bool)(0xc00053a884), BlockOwnerDeletion:(*bool)(nil)}}, Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry{v1.ManagedFieldsEntry{Manager:"Go-http-client", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000ce4150), Subresource:""}, v1.ManagedFieldsEntry{Manager:"kube-controller-manager", Operation:"Update", APIVersion:"apps/v1", Time:time.Date(2023, time.April, 1, 0, 25, 8, 0, time.Local), FieldsType:"FieldsV1", FieldsV1:(*v1.FieldsV1)(0xc000ce4180), Subresource:"status"}}}, Spec:v1.StatefulSetSpec{Replicas:(*int32)(0xc00053a880), Selector:(*v1.LabelSelector)(0xc000b220c0), Template:v1.PodTemplateSpec{ObjectMeta:v1.ObjectMeta{Name:"", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PodSpec{Volumes:[]v1.Volume(nil), InitContainers:[]v1.Container(nil), Containers:[]v1.Container{v1.Container{Name:"test-cluster-follower", Image:"quay.io/opstree/redis:v6.2.5", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:101, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"101m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount{v1.VolumeMount{Name:"test-cluster-follower", ReadOnly:false, MountPath:"/data", SubPath:"", MountPropagation:(*v1.MountPropagationMode)(nil), SubPathExpr:""}}, VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(0xc000ad1f80), ReadinessProbe:(*v1.Probe)(0xc000138b00), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}, v1.Container{Name:"redis-exporter", Image:"quay.io/opstree/redis-exporter:1.0", Command:[]string(nil), Args:[]string(nil), WorkingDir:"", Ports:[]v1.ContainerPort(nil), EnvFrom:[]v1.EnvFromSource(nil), Env:[]v1.EnvVar{v1.EnvVar{Name:"PERSISTENCE_ENABLED", Value:"true", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"REDIS_ADDR", Value:"redis://localhost:6379", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SERVER_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}, v1.EnvVar{Name:"SETUP_MODE", Value:"cluster", ValueFrom:(*v1.EnvVarSource)(nil)}}, Resources:v1.ResourceRequirements{Limits:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}, Requests:v1.ResourceList{"cpu":resource.Quantity{i:resource.int64Amount{value:100, scale:-3}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"100m", Format:"DecimalSI"}, "memory":resource.Quantity{i:resource.int64Amount{value:134217728, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"", Format:"BinarySI"}}}, VolumeMounts:[]v1.VolumeMount(nil), VolumeDevices:[]v1.VolumeDevice(nil), LivenessProbe:(*v1.Probe)(nil), ReadinessProbe:(*v1.Probe)(nil), StartupProbe:(*v1.Probe)(nil), Lifecycle:(*v1.Lifecycle)(nil), TerminationMessagePath:"", TerminationMessagePolicy:"", ImagePullPolicy:"IfNotPresent", SecurityContext:(*v1.SecurityContext)(nil), Stdin:false, StdinOnce:false, TTY:false}}, EphemeralContainers:[]v1.EphemeralContainer(nil), RestartPolicy:"", TerminationGracePeriodSeconds:(*int64)(nil), ActiveDeadlineSeconds:(*int64)(nil), DNSPolicy:"", NodeSelector:map[string]string(nil), ServiceAccountName:"", DeprecatedServiceAccount:"", AutomountServiceAccountToken:(*bool)(nil), NodeName:"", HostNetwork:false, HostPID:false, HostIPC:false, ShareProcessNamespace:(*bool)(nil), SecurityContext:(*v1.PodSecurityContext)(nil), ImagePullSecrets:[]v1.LocalObjectReference(nil), Hostname:"", Subdomain:"", Affinity:(*v1.Affinity)(nil), SchedulerName:"", Tolerations:[]v1.Toleration(nil), HostAliases:[]v1.HostAlias(nil), PriorityClassName:"", Priority:(*int32)(nil), DNSConfig:(*v1.PodDNSConfig)(nil), ReadinessGates:[]v1.PodReadinessGate(nil), RuntimeClassName:(*string)(nil), EnableServiceLinks:(*bool)(nil), PreemptionPolicy:(*v1.PreemptionPolicy)(nil), Overhead:v1.ResourceList(nil), TopologySpreadConstraints:[]v1.TopologySpreadConstraint(nil), SetHostnameAsFQDN:(*bool)(nil), OS:(*v1.PodOS)(nil)}}, VolumeClaimTemplates:[]v1.PersistentVolumeClaim{v1.PersistentVolumeClaim{TypeMeta:v1.TypeMeta{Kind:"PersistentVolumeClaim", APIVersion:"v1"}, ObjectMeta:v1.ObjectMeta{Name:"test-cluster-follower", GenerateName:"", Namespace:"", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string{"app":"test-cluster-follower", "redis_setup_type":"cluster", "role":"follower"}, Annotations:map[string]string{"redis.opstreelabs.in":"true", "redis.opstreelabs.instance":"test-cluster"}, OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ClusterName:"", ManagedFields:[]v1.ManagedFieldsEntry(nil)}, Spec:v1.PersistentVolumeClaimSpec{AccessModes:[]v1.PersistentVolumeAccessMode{"ReadWriteOnce"}, Selector:(*v1.LabelSelector)(nil), Resources:v1.ResourceRequirements{Limits:v1.ResourceList(nil), Requests:v1.ResourceList{"storage":resource.Quantity{i:resource.int64Amount{value:1073741824, scale:0}, d:resource.infDecAmount{Dec:(*inf.Dec)(nil)}, s:"1Gi", Format:"BinarySI"}}}, VolumeName:"", StorageClassName:(*string)(nil), VolumeMode:(*v1.PersistentVolumeMode)(0xc0010842b0), DataSource:(*v1.TypedLocalObjectReference)(nil), DataSourceRef:(*v1.TypedLocalObjectReference)(nil)}, Status:v1.PersistentVolumeClaimStatus{Phase:"Pending", AccessModes:[]v1.PersistentVolumeAccessMode(nil), Capacity:v1.ResourceList(nil), Conditions:[]v1.PersistentVolumeClaimCondition(nil), AllocatedResources:v1.ResourceList(nil), ResizeStatus:(*v1.PersistentVolumeClaimResizeStatus)(nil)}}}, ServiceName:"test-cluster-follower", PodManagementPolicy:"", UpdateStrategy:v1.StatefulSetUpdateStrategy{Type:"", RollingUpdate:(*v1.RollingUpdateStatefulSetStrategy)(nil)}, RevisionHistoryLimit:(*int32)(nil), MinReadySeconds:0, PersistentVolumeClaimRetentionPolicy:(*v1.StatefulSetPersistentVolumeClaimRetentionPolicy)(nil)}, Status:v1.StatefulSetStatus{ObservedGeneration:0, Replicas:0, ReadyReplicas:0, CurrentReplicas:0, UpdatedReplicas:0, CurrentRevision:"", UpdateRevision:"", CollisionCount:(*int32)(nil), Conditions:[]v1.StatefulSetCondition(nil), AvailableReplicas:0}}
1.6803092097839265e+09	INFO	controller_redis	Redis stateful successfully updated 	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803092097874017e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803092097892685e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower-headless"}
1.6803092098699613e+09	INFO	controller_redis	Redis service get action is successful	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803092100702617e+09	INFO	controller_redis	Redis service is already in-sync	{"Request.Service.Namespace": "redis-operator", "Request.Service.Name": "test-cluster-follower"}
1.6803092100773048e+09	INFO	controller_redis	Redis PodDisruptionBudget get action failed	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803092100773704e+09	INFO	controller_redis	Reconciliation Successful, no PodDisruptionBudget Found.	{"Request.PodDisruptionBudget.Namespace": "redis-operator", "Request.PodDisruptionBudget.Name": "test-cluster-follower"}
1.6803092101697264e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-leader"}
1.6803092101759984e+09	INFO	controller_redis	Redis statefulset get action was successful	{"Request.StatefulSet.Namespace": "redis-operator", "Request.StatefulSet.Name": "test-cluster-follower"}
1.6803092101760435e+09	INFO	controllers.RedisCluster	Creating redis cluster by executing cluster creation commands	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster", "Leaders.Ready": "3", "Followers.Ready": "2"}
1.6803092101811047e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.6803092101819198e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680309209000 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680309210000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave,fail 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 1680308739568 1680308737000 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680309210101 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680309210101 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680309209096 2 connected\n"}
1.6803092101820028e+09	INFO	controller_redis	Total number of redis nodes are	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Nodes": "6"}
1.680309210182028e+09	INFO	controllers.RedisCluster	Redis leader count is desired	{"Request.Namespace": "redis-operator", "Request.Name": "test-cluster"}
1.680309210275992e+09	INFO	controller_redis	Successfully got the ip for redis	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster-leader-0", "ip": "10.244.3.9"}
1.680309210276787e+09	INFO	controller_redis	Redis cluster nodes are listed	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Output": "45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 10.244.2.6:6379@16379 master - 0 1680309209000 2 connected 5461-10922\na6a189cea1c1a688c57b4a92d9338ddd08d5b704 10.244.3.9:6379@16379 myself,master - 0 1680309210000 1 connected 0-5460\neb761603e6419797aa36639df6a6ace81df20ca7 10.244.1.4:6379@16379 slave,fail 1ac2687f1902f66241fcaef5c32dd7a1d65248b8 1680308739568 1680308737000 3 connected\n3702db0d6632fdacaccd7d3ea9f6d1f5bd3ca399 10.244.3.8:6379@16379 slave a6a189cea1c1a688c57b4a92d9338ddd08d5b704 0 1680309210101 1 connected\n1ac2687f1902f66241fcaef5c32dd7a1d65248b8 10.244.1.5:6379@16379 master - 0 1680309210101 3 connected 10923-16383\n802c0d7dc1ce432749d1b111c8aa0f439fbaf5da 10.244.2.5:6379@16379 slave 45b9f491c00ebd9fa45213d7d5c5d7f3c21625fe 0 1680309209096 2 connected\n"}
1.6803092102768755e+09	INFO	controller_redis	Number of failed nodes in cluster	{"Request.RedisManager.Namespace": "redis-operator", "Request.RedisManager.Name": "test-cluster", "Failed Node Count": 1}

